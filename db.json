{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/next_8.8/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_100.jpg","path":"images/avatar_100.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_200.jpg","path":"images/avatar_200.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_300.jpg","path":"images/avatar_300.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_500.jpg","path":"images/avatar_500.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_80.jpg","path":"images/avatar_80.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/ye_16.ico","path":"images/ye_16.ico","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/ye_32.ico","path":"images/ye_32.ico","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/rating.js","path":"js/third-party/rating.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"55c55444033af34e797e2d3cb1c1b4cf7889b3db","modified":1647420734724},{"_id":"source/_posts/Algorithm.md","hash":"f8968cdcbc15c7ffc4ef9c09b1db380849e42285","modified":1648731901967},{"_id":"source/_posts/Construct-Your-Blog-with-Hexo-and-Github.md","hash":"294cabd5a5d7ece70c5bbbfeaa380867fab6ee67","modified":1647420734742},{"_id":"source/_posts/Config-Vim.md","hash":"3396d8bd3980b8136a768449bf5076df8af8fd3c","modified":1647420734738},{"_id":"source/_posts/First-Step-to-RL.md","hash":"1bffaa1e58098e82c8bc014e82690c0e6ac524d2","modified":1647420734751},{"_id":"source/_posts/An-Introduction-to-Git.md","hash":"180538af97530ac1df0de9200e87a3a9f6db0922","modified":1647420734728},{"_id":"source/_posts/Foundation-for-Topological-Data-Analysis.md","hash":"c6a8f658f8e0195e4c2dff516c014dd89844ec04","modified":1647420734762},{"_id":"source/_posts/Experiments.md","hash":"4ebc470b4e205051bacff945d720fdb46ebef582","modified":1647420734746},{"_id":"source/_posts/Shorcut-on-Linux.md","hash":"7573076fb293efa48694f9c6e7e82fd02ea2d783","modified":1647420734774},{"_id":"source/_posts/Personal-Thought.md","hash":"16a7b4ab87f88a826c506fff8c68e8bd123df18b","modified":1647420734770},{"_id":"source/_posts/Tips-in-Papers.md","hash":"26a8b0336d659b37689a154dc6c17800832268bf","modified":1647431102694},{"_id":"source/_posts/How-to-Blance-Losses-in-Multi-Task-Training.md","hash":"83c620b3c1d6fc20a921f8219beca341bf79ba98","modified":1647430122497},{"_id":"source/categories/index.md","hash":"408ea9b07f3b1a1339731fe7b364d88bc5644aff","modified":1647420734823},{"_id":"source/tags/index.md","hash":"3207ebf9794561395cf0c54633880ab070040ade","modified":1647420734826},{"_id":"source/_posts/First-Step-to-RL/policy_network.py","hash":"b3e8f06360cad0084a0656edaed4539f1b01e327","modified":1647420734760},{"_id":"source/_posts/First-Step-to-RL/q_learning.py","hash":"3a68ec1153d26f2c18c9d34ee5deb5e495b8dca9","modified":1647420734761},{"_id":"source/_posts/Tips-in-Papers/ADCM.jpg","hash":"ee5b75f3a063e07624c5f03111f98902d885cd8e","modified":1647420734784},{"_id":"source/_posts/Transformer-and-BERT.md","hash":"9b91961c25864f2d2849ebb5421700af045308b3","modified":1647420734815},{"_id":"source/about/index.md","hash":"9aab11db0791297a1fa5e1b1767eb3a05bfb42ef","modified":1647420734819},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq2.jpg","hash":"cf5832e89b29e39275d2fa4a2e39592e97f9a39e","modified":1647420734800},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq1.jpg","hash":"2ea2a74f960377a6a9d0bc98ecfadd8ba09cd316","modified":1647420734797},{"_id":"source/_posts/Tips-in-Papers/Saccader_gl.jpg","hash":"fb8050f8b71a7c667cfa85672b505b3340d2231b","modified":1647420734808},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq3.jpg","hash":"8fa845242bb6f737736d91485ca237e7132e19b5","modified":1647420734804},{"_id":"source/_posts/Tips-in-Papers/Saccader_Cell.jpg","hash":"b17e79bf86bb3422527bf51d200ceceeb53ce936","modified":1647420734788},{"_id":"source/_posts/Tips-in-Papers/Saccader_Over.jpg","hash":"deaccd942ffca9e163a9f2c9bdfb69251d1004cb","modified":1647420734793},{"_id":"source/_posts/Tips-in-Papers/Tnet_over.jpg","hash":"ed04ca4049c6f909b0bf51ea57ffa9a2b445e1c8","modified":1647420734812},{"_id":"source/_posts/An-Introduction-to-Git/git.jpg","hash":"db9ed8bb86df7e73d5be3bcae4cc8656e4a7a0ed","modified":1647420734734},{"_id":"themes/next_8.8/.gitignore","hash":"417520c4dbbeab9c7e3ab10d944da0886366a0ee","modified":1647420755148},{"_id":"themes/next_8.8/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1647420755046},{"_id":"themes/next_8.8/.eslintrc.json","hash":"9c0762486f24a8c5e60f8b6c875e4c4728942649","modified":1647420755047},{"_id":"themes/next_8.8/.gitattributes","hash":"ec43734985e1cafd53d88ded3020103f7416123c","modified":1647420755051},{"_id":"themes/next_8.8/_vendors.yml","hash":"c88f3a82361ddb32cf62846a2ae1b7192b7e3af2","modified":1647420755176},{"_id":"themes/next_8.8/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1647420755157},{"_id":"themes/next_8.8/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1647420755180},{"_id":"themes/next_8.8/README.md","hash":"fab15a85d9d8d90ecd8879525b9b74fb1c197978","modified":1647420755165},{"_id":"themes/next_8.8/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1647420755155},{"_id":"themes/next_8.8/package.json","hash":"cc9a8e5bd83dd293552ed7cc1d0d2304a6b448ba","modified":1647420755604},{"_id":"themes/next_8.8/_config.yml","hash":"e53c78069ba516084547dae15db29012f80f5336","modified":1647420813470},{"_id":"themes/next_8.8/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1647420755610},{"_id":"themes/next_8.8/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1647420755101},{"_id":"themes/next_8.8/.githooks/install.js","hash":"4d77dbddf2eac1f3fc78f151d12ed22208ed655b","modified":1647420755055},{"_id":"themes/next_8.8/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1647420755056},{"_id":"themes/next_8.8/.github/CODE_OF_CONDUCT.md","hash":"21cbff565a0445d3a880fff1ee417e309740a9ab","modified":1647420755060},{"_id":"themes/next_8.8/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1647420755066},{"_id":"themes/next_8.8/.github/PULL_REQUEST_TEMPLATE.md","hash":"3e9fbb78e3dee0ca1dc886d0c28b0148ba0ca499","modified":1647420755094},{"_id":"themes/next_8.8/.github/labeler.yml","hash":"5c4bc2bd561e6d9b33ee118cc12218c5de46f72d","modified":1647420755112},{"_id":"themes/next_8.8/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1647420755223},{"_id":"themes/next_8.8/.github/release-drafter.yml","hash":"423275ec021104b263cd88776936a8c8d6872b66","modified":1647420755116},{"_id":"themes/next_8.8/languages/de.yml","hash":"4be7b8b76c81bf1853eb36d2e874b17546a0e792","modified":1647420755231},{"_id":"themes/next_8.8/.github/label-commenter-config.yml","hash":"1097fc47beeacfc1edb0248c27b17bf64bde3565","modified":1647420755108},{"_id":"themes/next_8.8/languages/ar.yml","hash":"bca66db21c015dbd32970d8708b898518a773e1e","modified":1647420755227},{"_id":"themes/next_8.8/languages/en.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1647420755237},{"_id":"themes/next_8.8/languages/fa.yml","hash":"6456d40dd42f44101d9d6e7054e9884e9163f948","modified":1647420755244},{"_id":"themes/next_8.8/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1647420755107},{"_id":"themes/next_8.8/languages/es.yml","hash":"651e3b33d86a7cdb9fd7895ca28279f8b1a24faa","modified":1647420755240},{"_id":"themes/next_8.8/languages/fr.yml","hash":"b15dc05afdc94de02e5d3fee4f8d3dc5594dd37e","modified":1647420755248},{"_id":"themes/next_8.8/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1647420755235},{"_id":"themes/next_8.8/languages/id.yml","hash":"14e794db4eca36b257994d81eb513e61d1edcbd6","modified":1647420755252},{"_id":"themes/next_8.8/languages/ja.yml","hash":"d48c4157e0e02e847aac7b513580d3364c81948c","modified":1647420755259},{"_id":"themes/next_8.8/languages/nl.yml","hash":"ecb8e39c6225f3c068a5fdd569ee7dafd5c41a1f","modified":1647420755267},{"_id":"themes/next_8.8/languages/it.yml","hash":"c1eeab4992c76bfd436bb205ce58b1cfeef55ee6","modified":1647420755256},{"_id":"themes/next_8.8/languages/pt.yml","hash":"63a3e1e728ba5e6e22150de7331bb8a654f34960","modified":1647420755275},{"_id":"themes/next_8.8/languages/si.yml","hash":"615d18d044f44df476d6bfbf73f7b0edc2632168","modified":1647420755283},{"_id":"themes/next_8.8/languages/pt-BR.yml","hash":"a1f27b3a592fc58f17d247f5563ff4a90a3da5f2","modified":1647420755271},{"_id":"themes/next_8.8/languages/uk.yml","hash":"7dd24580c0865c5a7bc4d391855045366a598936","modified":1647420755291},{"_id":"themes/next_8.8/languages/zh-CN.yml","hash":"5a3ab21210304efef736e96bad254f789f42c567","modified":1647420755299},{"_id":"themes/next_8.8/languages/ko.yml","hash":"6387357ac2dd498e8b8d630d27050a59180d7e8f","modified":1647420755263},{"_id":"themes/next_8.8/languages/ru.yml","hash":"e9af1afe529ca747a04b801401d394b2ad696fde","modified":1647420755279},{"_id":"themes/next_8.8/languages/tr.yml","hash":"0bebba73d6f06c7dad61f80c0d7ad5f6f1791a01","modified":1647420755287},{"_id":"themes/next_8.8/languages/zh-HK.yml","hash":"f195bb0502ffe66e850077a1af1033455ea65f93","modified":1647420755304},{"_id":"themes/next_8.8/languages/vi.yml","hash":"c669c34da544a563ceae3e196addc9df6a78e024","modified":1647420755295},{"_id":"themes/next_8.8/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1647420755192},{"_id":"themes/next_8.8/languages/zh-TW.yml","hash":"92256b90028de9a1e79c6bc0e5885b93e7fb4b17","modified":1647420755308},{"_id":"themes/next_8.8/layout/_layout.njk","hash":"20e4160cd0deb4fa272cc3aed0f43520b3cf4a9c","modified":1647420755312},{"_id":"themes/next_8.8/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1647420755186},{"_id":"themes/next_8.8/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1647420755583},{"_id":"themes/next_8.8/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":1647420755594},{"_id":"themes/next_8.8/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1647420755579},{"_id":"themes/next_8.8/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1647420755182},{"_id":"themes/next_8.8/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1647420755587},{"_id":"themes/next_8.8/test/index.js","hash":"6bf0289846538be3e9a63809af98f00e1fbdd90b","modified":1647420756509},{"_id":"themes/next_8.8/layout/page.njk","hash":"6c40aa438c658eb7f0cd0f6a759f18b43e7e8f93","modified":1647420755590},{"_id":"themes/next_8.8/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1647420755599},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1647420755079},{"_id":"themes/next_8.8/.github/workflows/label-commenter.yml","hash":"44405477660289d4ed9beba1d054b15bb67bba06","modified":1647420755122},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/other.md","hash":"8cc5b5c116f6a052865a324512362f145d699202","modified":1647420755089},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/bug-report.md","hash":"fc4dce84ed9a5d21d3a8833ff6d776c46f876115","modified":1647420755073},{"_id":"themes/next_8.8/.github/workflows/labeler.yml","hash":"8b73c439dc796be141d521a4546bcfb7a5485534","modified":1647420755126},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/feature-request.md","hash":"4ecac91716eac59d7c2bc53cf6e95612d44da97b","modified":1647420755083},{"_id":"themes/next_8.8/.github/workflows/linter.yml","hash":"276a91c7179926f410c784c99fa635dc0a016c2d","modified":1647420755129},{"_id":"themes/next_8.8/.github/workflows/stale.yml","hash":"0feb3e1afd1b2dca9dbc7811ce4cf5520e2d186c","modified":1647420755141},{"_id":"themes/next_8.8/.github/workflows/lock.yml","hash":"e48d1ced9a673d3f0911a700d3e68c0f4ca79263","modified":1647420755133},{"_id":"themes/next_8.8/.github/workflows/tester.yml","hash":"22aaaa3eba1a7ebcf0f78417fd9a7113ee7b6c6c","modified":1647420755144},{"_id":"themes/next_8.8/.github/workflows/release-drafter.yml","hash":"4f3af81009cb922be91f718a67425377515ea69d","modified":1647420755137},{"_id":"themes/next_8.8/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1647420755205},{"_id":"themes/next_8.8/docs/ru/README.md","hash":"87edab5a3eb7577a409c01df3f1631de40f8956f","modified":1647420755199},{"_id":"themes/next_8.8/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1647420755316},{"_id":"themes/next_8.8/layout/_macro/post.njk","hash":"d0ed41b9b05254e19d051b5f91fdcaa125ee7ca6","modified":1647420755320},{"_id":"themes/next_8.8/layout/_macro/sidebar.njk","hash":"a1575da8a34d7b7b8cf37e23ffb5d0ed2edee0fe","modified":1647420755325},{"_id":"themes/next_8.8/layout/_partials/comments.njk","hash":"c12f8a7497596441503f2541d2f746f2ee7dd594","modified":1647420755333},{"_id":"themes/next_8.8/docs/zh-CN/README.md","hash":"02bafc6ee86263790603861e356596f0c916e392","modified":1647420755218},{"_id":"themes/next_8.8/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1647420755211},{"_id":"themes/next_8.8/layout/_partials/footer.njk","hash":"a6197cc0d418d87919f929905a5e90e21b969ffa","modified":1647420755337},{"_id":"themes/next_8.8/layout/_macro/sidebar.njk_backup","hash":"eb786e8b35e354287cda345c524cd35ec955f692","modified":1647420755329},{"_id":"themes/next_8.8/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1647420755376},{"_id":"themes/next_8.8/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1647420755445},{"_id":"themes/next_8.8/layout/_partials/widgets.njk","hash":"852a750524decf1efa587cd52b09e387ed8315de","modified":1647420755441},{"_id":"themes/next_8.8/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1647420755449},{"_id":"themes/next_8.8/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1647420755398},{"_id":"themes/next_8.8/layout/_third-party/rating.njk","hash":"1bcdbc7fde26d6d9ef4e7fa43ffcff5a9506b20e","modified":1647420755545},{"_id":"themes/next_8.8/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1647420755537},{"_id":"themes/next_8.8/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1647420755704},{"_id":"themes/next_8.8/scripts/filters/locals.js","hash":"0cd7da6755459d60779f0a7ccf311e26e184d55d","modified":1647420755710},{"_id":"themes/next_8.8/scripts/filters/post.js","hash":"ab8bb12e4d55640b1ac4252514468ce37ebcb0b0","modified":1647420755723},{"_id":"themes/next_8.8/layout/_third-party/index.njk","hash":"d41eeb262978e34de4679d8971a9e7ac5d90ecbc","modified":1647420755522},{"_id":"themes/next_8.8/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1647420755518},{"_id":"themes/next_8.8/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1647420755541},{"_id":"themes/next_8.8/scripts/events/index.js","hash":"1ce12eda88fa5df7e76ec7b78b8463fc6618410c","modified":1647420755614},{"_id":"themes/next_8.8/scripts/filters/minify.js","hash":"0af64049db8188d5f8cc226b353e0d7909819feb","modified":1647420755716},{"_id":"themes/next_8.8/scripts/helpers/engine.js","hash":"b9785bc737470e9b8e910e7da9e8c45c2ead58fa","modified":1647420755729},{"_id":"themes/next_8.8/scripts/helpers/next-config.js","hash":"9a07f2d979fc8fe0c5e07d48304187b9b03ea7ff","modified":1647420755742},{"_id":"themes/next_8.8/scripts/filters/number.js","hash":"63735cb9d02921e25b2606490340a70db89abbec","modified":1647420755722},{"_id":"themes/next_8.8/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1647420755736},{"_id":"themes/next_8.8/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1647420755764},{"_id":"themes/next_8.8/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1647420755771},{"_id":"themes/next_8.8/scripts/helpers/next-url.js","hash":"a11b71ba0c5012e2cdcab31c15439156b215563e","modified":1647420755749},{"_id":"themes/next_8.8/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1647420755784},{"_id":"themes/next_8.8/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1647420755758},{"_id":"themes/next_8.8/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1647420755778},{"_id":"themes/next_8.8/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1647420755791},{"_id":"themes/next_8.8/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1647420755797},{"_id":"themes/next_8.8/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1647420755816},{"_id":"themes/next_8.8/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1647420755811},{"_id":"themes/next_8.8/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1647420755822},{"_id":"themes/next_8.8/source/css/main.styl","hash":"78ce791cc4ac95386cf6839ca72f5f7b51f86ee9","modified":1647420756263},{"_id":"themes/next_8.8/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1647420755828},{"_id":"themes/next_8.8/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1647420755805},{"_id":"themes/next_8.8/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1647420755835},{"_id":"themes/next_8.8/source/css/_mixins.styl","hash":"acef5acc728f24cb657be8d7010d836b4d556b0e","modified":1647420756132},{"_id":"themes/next_8.8/source/css/noscript.styl","hash":"76bba5d7916e9930e68215a0fce3a7d81c44510f","modified":1647420756268},{"_id":"themes/next_8.8/source/css/_colors.styl","hash":"3c6798c10cc220d83481cb3f3782e78558cee789","modified":1647420755841},{"_id":"themes/next_8.8/source/images/avatar_100.jpg","hash":"a0f0a00c9326c57a5cc181aeb80dfda8e947920a","modified":1647420756279},{"_id":"themes/next_8.8/source/images/avatar_200.jpg","hash":"4a76d1527e511350c9112e899046a34be59ad278","modified":1647420756282},{"_id":"themes/next_8.8/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1647420756272},{"_id":"themes/next_8.8/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1647420756273},{"_id":"themes/next_8.8/source/images/avatar_80.jpg","hash":"465e53598964df3852f08794cb73c5e459855e92","modified":1647420756293},{"_id":"themes/next_8.8/source/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1647420756298},{"_id":"themes/next_8.8/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1647420756296},{"_id":"themes/next_8.8/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1647420756297},{"_id":"themes/next_8.8/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1647420756304},{"_id":"themes/next_8.8/source/images/ye_16.ico","hash":"b8fb01b5361da89831d232a831a1532e9822bd72","modified":1647420756302},{"_id":"themes/next_8.8/source/images/ye_32.ico","hash":"375c99cd785d93dd989c36604ffbd10ada71322a","modified":1647420756303},{"_id":"themes/next_8.8/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1647420756298},{"_id":"themes/next_8.8/source/js/motion.js","hash":"9c4c861dfb080b6244d4d9eba33ac686735754f3","modified":1647420756329},{"_id":"themes/next_8.8/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1647420756316},{"_id":"themes/next_8.8/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1647420756322},{"_id":"themes/next_8.8/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1647420756310},{"_id":"themes/next_8.8/source/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1647420756341},{"_id":"themes/next_8.8/source/js/schedule.js","hash":"2b43e2d576a308289880befc27580dbb2aa34439","modified":1647420756347},{"_id":"themes/next_8.8/source/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1647420756335},{"_id":"themes/next_8.8/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1647420756501},{"_id":"themes/next_8.8/source/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1647420756487},{"_id":"themes/next_8.8/test/helpers/font.js","hash":"342ef3c6fd2dcca2a8802a516ed6d7f389fd2ca2","modified":1647420756495},{"_id":"themes/next_8.8/test/tags/caniuse.js","hash":"aa5e728445caeaf7c2ccd0f3fcb2cad0c93ca6d1","modified":1647420756520},{"_id":"themes/next_8.8/test/helpers/next-url.js","hash":"a91d880cb75e0a8e65a7be4c7362b2c8ebfb7c4f","modified":1647420756502},{"_id":"themes/next_8.8/test/tags/button.js","hash":"48f2aa4c513e9e24bd6a811410520b74cd7ea88b","modified":1647420756514},{"_id":"themes/next_8.8/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1647420756538},{"_id":"themes/next_8.8/test/tags/mermaid.js","hash":"ab77be5f3c6d9a57c7b9dda6decf1906a736fef9","modified":1647420756554},{"_id":"themes/next_8.8/test/tags/group-pictures.js","hash":"5c68ae0184f9da6e00ba199f2554d503d8e6da71","modified":1647420756532},{"_id":"themes/next_8.8/test/tags/center-quote.js","hash":"7667342fd1a1417eaf6a254012b84ae40e8d13dd","modified":1647420756526},{"_id":"themes/next_8.8/test/tags/link-grid.js","hash":"43d298fafb7c45a874b766d443843bd26346e689","modified":1647420756548},{"_id":"themes/next_8.8/test/tags/label.js","hash":"4ebf3698c258ca978b997acbdd0dece44069c09d","modified":1647420756543},{"_id":"themes/next_8.8/test/tags/note.js","hash":"3dcfcd65bf9f326972ea7571fdb1444200f5d07e","modified":1647420756559},{"_id":"themes/next_8.8/test/tags/pdf.js","hash":"fd6ea5123560a90f7e7c1eface23dbe1455db25f","modified":1647420756565},{"_id":"themes/next_8.8/layout/_partials/head/head-unique.njk","hash":"9167e429a459686c9fc140790124a46d677e6b15","modified":1647420755346},{"_id":"themes/next_8.8/test/validate/index.js","hash":"5a95ccc8598667535bd022e988055c0e019f3670","modified":1647420756582},{"_id":"themes/next_8.8/layout/_partials/head/head.njk","hash":"d3c094aaef1431fbc9df333529a7b1789ccd134c","modified":1647420755350},{"_id":"themes/next_8.8/test/tags/video.js","hash":"b796fc4dceb20a30e730c322bb5474c0162464cc","modified":1647420756577},{"_id":"themes/next_8.8/test/tags/tabs.js","hash":"d63722919f9da2e44d6b952801e10a2915ea9c12","modified":1647420756571},{"_id":"themes/next_8.8/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1647420755384},{"_id":"themes/next_8.8/layout/_partials/page/breadcrumb.njk","hash":"edb3bb6d644b7407673c5ef3a426a244e98fcf89","modified":1647420755380},{"_id":"themes/next_8.8/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1647420755387},{"_id":"themes/next_8.8/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1647420755395},{"_id":"themes/next_8.8/layout/_partials/page/schedule.njk","hash":"ca2ccf3cf1874c45712f192ad45dea96fbd9920d","modified":1647420755391},{"_id":"themes/next_8.8/layout/_partials/header/brand.njk","hash":"aff4613756456be26415febc668860fdab8d33c5","modified":1647420755354},{"_id":"themes/next_8.8/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1647420755358},{"_id":"themes/next_8.8/layout/_partials/header/menu-item.njk","hash":"b46f412c0b4f775fd329d50357f722f5d7c1a3ba","modified":1647420755361},{"_id":"themes/next_8.8/layout/_partials/header/menu.njk","hash":"8561e4125b227e5134cb058e2a76fb2e5233ca29","modified":1647420755366},{"_id":"themes/next_8.8/layout/_partials/header/sub-menu.njk","hash":"75a158a5b54a3a76ee6590f5e0e2dd4a9f0be869","modified":1647420755370},{"_id":"themes/next_8.8/layout/_partials/post/post-footer.njk","hash":"bde2c7356d9362972bde41cc206d5816f8ed714d","modified":1647420755408},{"_id":"themes/next_8.8/layout/_partials/post/post-followme.njk","hash":"154df0bb323c332d8c25343f258ee865e5553423","modified":1647420755403},{"_id":"themes/next_8.8/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1647420755399},{"_id":"themes/next_8.8/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1647420755411},{"_id":"themes/next_8.8/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1647420755425},{"_id":"themes/next_8.8/layout/_partials/post/post-related.njk","hash":"7384e6390067ef2a84e7310d6adb3f6104ed62e2","modified":1647420755416},{"_id":"themes/next_8.8/layout/_partials/post/post-reward.njk","hash":"002b51d0cae3f2e2e008bdc58be90c728282de5b","modified":1647420755420},{"_id":"themes/next_8.8/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1647420755432},{"_id":"themes/next_8.8/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1647420755428},{"_id":"themes/next_8.8/layout/_partials/sidebar/site-overview.njk","hash":"3d8591bb92df77ceb9d5b07bc76da1ca89e5bd76","modified":1647420755436},{"_id":"themes/next_8.8/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1647420755466},{"_id":"themes/next_8.8/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1647420755453},{"_id":"themes/next_8.8/layout/_third-party/analytics/cloudflare.njk","hash":"c978e9efd472c4825f93b83524b11f1c4f7efaab","modified":1647420755460},{"_id":"themes/next_8.8/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1647420755463},{"_id":"themes/next_8.8/layout/_third-party/analytics/index.njk","hash":"2d36a481a70d5f450f1f166dc556ac1218b18537","modified":1647420755471},{"_id":"themes/next_8.8/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1647420755474},{"_id":"themes/next_8.8/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1647420755477},{"_id":"themes/next_8.8/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1647420755492},{"_id":"themes/next_8.8/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1647420755482},{"_id":"themes/next_8.8/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1647420755487},{"_id":"themes/next_8.8/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1647420755497},{"_id":"themes/next_8.8/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1647420755500},{"_id":"themes/next_8.8/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1647420755510},{"_id":"themes/next_8.8/layout/_third-party/math/katex.njk","hash":"d82c24136bbd3443b85f07f5579845833b594684","modified":1647420755530},{"_id":"themes/next_8.8/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1647420755506},{"_id":"themes/next_8.8/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1647420755549},{"_id":"themes/next_8.8/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1647420755526},{"_id":"themes/next_8.8/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1647420755534},{"_id":"themes/next_8.8/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1647420755513},{"_id":"themes/next_8.8/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1647420755556},{"_id":"themes/next_8.8/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1647420755564},{"_id":"themes/next_8.8/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1647420755552},{"_id":"themes/next_8.8/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1647420755568},{"_id":"themes/next_8.8/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1647420755561},{"_id":"themes/next_8.8/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1647420755575},{"_id":"themes/next_8.8/scripts/events/lib/config.js","hash":"b0ced2583fdd505da3ef27a9db9c55cc7b936732","modified":1647420755621},{"_id":"themes/next_8.8/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1647420755572},{"_id":"themes/next_8.8/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1647420755627},{"_id":"themes/next_8.8/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1647420755632},{"_id":"themes/next_8.8/scripts/events/lib/vendors.js","hash":"08dac57e15c9f06c7cf54884b045f2362595f9d2","modified":1647420755647},{"_id":"themes/next_8.8/scripts/events/lib/utils.js","hash":"b281be775b693f9bf32766c8f6ef703c72ac9b00","modified":1647420755639},{"_id":"themes/next_8.8/scripts/filters/comment/changyan.js","hash":"aa05e6b3d613a756178b8ba06832ad27499d4c14","modified":1647420755654},{"_id":"themes/next_8.8/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1647420755666},{"_id":"themes/next_8.8/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1647420755659},{"_id":"themes/next_8.8/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1647420755660},{"_id":"themes/next_8.8/scripts/filters/comment/disqusjs.js","hash":"135b87d151055eefdbc711d9e704b112b3214a84","modified":1647420755674},{"_id":"themes/next_8.8/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1647420755686},{"_id":"themes/next_8.8/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1647420755680},{"_id":"themes/next_8.8/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1647420755693},{"_id":"themes/next_8.8/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1647420756234},{"_id":"themes/next_8.8/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1647420755698},{"_id":"themes/next_8.8/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1647420756245},{"_id":"themes/next_8.8/source/css/_variables/Mist.styl","hash":"e1fbf169b9b6a194b518240cbd06ec3c48b83d61","modified":1647420756239},{"_id":"themes/next_8.8/source/css/_variables/base.styl","hash":"163c7441d777bee87042d475e6ce0fde199add28","modified":1647420756255},{"_id":"themes/next_8.8/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":1647420756250},{"_id":"themes/next_8.8/source/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1647420756354},{"_id":"themes/next_8.8/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1647420756435},{"_id":"themes/next_8.8/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1647420756420},{"_id":"themes/next_8.8/source/js/third-party/quicklink.js","hash":"6f58cd7aa8f6f1ab92d5a96551add293f4e55312","modified":1647420756441},{"_id":"themes/next_8.8/source/css/_common/components/back-to-top.styl","hash":"bab653bcf226311381e8411a0492202f1bf1fce9","modified":1647420755846},{"_id":"themes/next_8.8/source/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1647420756447},{"_id":"themes/next_8.8/source/css/_common/components/index.styl","hash":"fe1868f47681e00a33a96199302be85377282f63","modified":1647420755849},{"_id":"themes/next_8.8/source/css/_common/scaffolding/base.styl","hash":"0805d7db96b6c83b31e8d023d1ae88f6d2969133","modified":1647420756048},{"_id":"themes/next_8.8/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1647420755924},{"_id":"themes/next_8.8/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1647420756059},{"_id":"themes/next_8.8/source/css/_common/scaffolding/base.styl_backup","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1647420756054},{"_id":"themes/next_8.8/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1647420756063},{"_id":"themes/next_8.8/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1647420756076},{"_id":"themes/next_8.8/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1647420756075},{"_id":"themes/next_8.8/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":1647420756128},{"_id":"themes/next_8.8/source/css/_common/scaffolding/pagination.styl","hash":"b5c7782368889fa9fd93807d28ff2daf270e3703","modified":1647420756077},{"_id":"themes/next_8.8/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1647420755993},{"_id":"themes/next_8.8/source/css/_schemes/Gemini/index.styl","hash":"fd49b521d67eaccc629f77b4e095cb7310327565","modified":1647420756139},{"_id":"themes/next_8.8/source/css/_common/outline/mobile.styl","hash":"64775c729512b30b144ab5ae9dc4a4dfd4e13f35","modified":1647420755997},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1647420756080},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":1647420756152},{"_id":"themes/next_8.8/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1647420756176},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":1647420756182},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_posts-expand.styl","hash":"b332868d76d9f1651efd65abfc0d3c9d699b1a45","modified":1647420756170},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_header.styl","hash":"4817e77577896ab5c0da434549917ee703a3f4cf","modified":1647420756145},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":1647420756186},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1647420756200},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_menu.styl","hash":"357b899ac0f0dfbbbebf1ea972030c7cefa463ce","modified":1647420756164},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_menu.styl","hash":"8a70d51d8f7cd113e5fbc9f0e70c46a072f282c8","modified":1647420756193},{"_id":"themes/next_8.8/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1647420756201},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_sidebar.styl","hash":"d9141e6e14a56b5952488101e9a8388c2170e270","modified":1647420756219},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_sidebar.styl","hash":"944364893bd7160d954c10ba931af641c91515a4","modified":1647420756196},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_header.styl","hash":"b741ab96e73370711c63a6581159f2ea8b5bfa1b","modified":1647420756205},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1647420756225},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1647420756228},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1647420756215},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":1647420756208},{"_id":"themes/next_8.8/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1647420756364},{"_id":"themes/next_8.8/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1647420756370},{"_id":"themes/next_8.8/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1647420756374},{"_id":"themes/next_8.8/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1647420756360},{"_id":"themes/next_8.8/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1647420756382},{"_id":"themes/next_8.8/source/js/third-party/comments/changyan.js","hash":"8c8ebec444c727b704ea41ad88b0b96ed2e4b8d4","modified":1647420756388},{"_id":"themes/next_8.8/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1647420756380},{"_id":"themes/next_8.8/source/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1647420756399},{"_id":"themes/next_8.8/source/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1647420756394},{"_id":"themes/next_8.8/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1647420756400},{"_id":"themes/next_8.8/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1647420756410},{"_id":"themes/next_8.8/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1647420756426},{"_id":"themes/next_8.8/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1647420756415},{"_id":"themes/next_8.8/source/js/third-party/search/algolia-search.js","hash":"ac401e3736d56a3c9cb85ab885744cce0b813c55","modified":1647420756452},{"_id":"themes/next_8.8/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1647420756406},{"_id":"themes/next_8.8/source/js/third-party/tags/mermaid.js","hash":"3dc4628efa6debd6490fc0ebddff2424a7b319d8","modified":1647420756478},{"_id":"themes/next_8.8/source/js/third-party/statistics/firestore.js","hash":"0960f16107ed61452fb0dffc6ed22dc143de34ef","modified":1647420756465},{"_id":"themes/next_8.8/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1647420756430},{"_id":"themes/next_8.8/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1647420756483},{"_id":"themes/next_8.8/source/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1647420756459},{"_id":"themes/next_8.8/source/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1647420756471},{"_id":"themes/next_8.8/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1647420755862},{"_id":"themes/next_8.8/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1647420755863},{"_id":"themes/next_8.8/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1647420755858},{"_id":"themes/next_8.8/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1647420755854},{"_id":"themes/next_8.8/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1647420755867},{"_id":"themes/next_8.8/source/css/_common/components/post/index.styl","hash":"d0805a763176b3c0003967401644f41dfe3bc9e8","modified":1647420755871},{"_id":"themes/next_8.8/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1647420755896},{"_id":"themes/next_8.8/source/css/_common/components/post/post-followme.styl","hash":"fc1a7bac6493f24aa50665574f37f3dd954f210c","modified":1647420755887},{"_id":"themes/next_8.8/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1647420755881},{"_id":"themes/next_8.8/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1647420755902},{"_id":"themes/next_8.8/source/css/_common/components/post/post-body.styl","hash":"ea351936d71e0b6259febac3d7d56d1be6927bf9","modified":1647420755875},{"_id":"themes/next_8.8/source/css/_common/components/post/post-footer.styl","hash":"1d284f3ea03ba9b4feb76b375e539a8e0bccf1c3","modified":1647420755891},{"_id":"themes/next_8.8/source/css/_common/components/post/post-reward.styl","hash":"07cff69f2d57e6321595f64c16d8b763dc88df6a","modified":1647420755913},{"_id":"themes/next_8.8/source/css/_common/components/third-party/index.styl","hash":"fb0b9eaca498be8af0bc430171a17becf87f8554","modified":1647420755935},{"_id":"themes/next_8.8/source/css/_common/components/third-party/gitalk.styl","hash":"070737d101e7cd58e997e8c7af09958268c43a21","modified":1647420755932},{"_id":"themes/next_8.8/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1647420755908},{"_id":"themes/next_8.8/source/css/_common/components/third-party/disqusjs.styl","hash":"c2326ee3e8b724d99c24a818ddee32813ea5bf89","modified":1647420755928},{"_id":"themes/next_8.8/source/css/_common/components/third-party/related-posts.styl","hash":"41ed817e1eb64078074e245e771446ee041e5790","modified":1647420755945},{"_id":"themes/next_8.8/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1647420755949},{"_id":"themes/next_8.8/source/css/_common/components/post/post-widgets.styl","hash":"b6677dc2a2368084ab82bb4f145ac79e5966c150","modified":1647420755919},{"_id":"themes/next_8.8/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1647420755941},{"_id":"themes/next_8.8/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1647420755955},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1647420756084},{"_id":"themes/next_8.8/source/css/_common/scaffolding/highlight/index.styl","hash":"0b3e2696eca39781c3524b2c5a2555ebc616e6e8","modified":1647420756071},{"_id":"themes/next_8.8/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":1647420756067},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/index.styl","hash":"3f76c73a891bbc10679753e702feba9e8a5ffdd2","modified":1647420756094},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1647420756090},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1647420756097},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1647420756109},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/note.styl","hash":"d27fbf7799695295dd5860a161a13ac4d90c5ba4","modified":1647420756113},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1647420756101},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/tabs.styl","hash":"9b34143aec49e390e18f380026a45096f7477722","modified":1647420756121},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1647420756117},{"_id":"themes/next_8.8/source/css/_common/outline/footer/index.styl","hash":"8b9407e5cfd0571ef8de7df19022b268f962fa2f","modified":1647420755959},{"_id":"themes/next_8.8/source/css/_common/outline/header/site-meta.styl","hash":"759e582d34d08e3386c55d87a835a9523608619f","modified":1647420755986},{"_id":"themes/next_8.8/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1647420755969},{"_id":"themes/next_8.8/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1647420755965},{"_id":"themes/next_8.8/source/css/_common/outline/header/menu.styl","hash":"392fd53a8dd4e3f33a853ebb24290a622300e0ff","modified":1647420755980},{"_id":"themes/next_8.8/source/css/_common/outline/header/index.styl","hash":"650ed4ad6df1b6ff04647e7b6d568304e4d3ed2e","modified":1647420755974},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/index.styl","hash":"cee43480eba028c37d51cb620c2d81486aa24e01","modified":1647420756003},{"_id":"themes/next_8.8/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1647420755989},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1647420756009},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"fbdb63c6a8887d19b7137325ba7d6806f728139c","modified":1647420756026},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1647420756013},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"021a37cf178440cc341940a299d3bca359996c6b","modified":1647420756035},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1647420756021},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"ee94a1a27090ad24e3ed579093088d97ff96d77d","modified":1647420756029},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"9950c3188a28e1c63b5498b7bdcd14b12ace3e28","modified":1647420756016},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"3103b81fc76b59e1e2c161e2c484625c770ed66f","modified":1647420756039},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1647420756042},{"_id":"themes/next_8.8/source/images/avatar.jpg","hash":"ed5dde31684ebfd99e9965da1140fb919496f1d3","modified":1647420756275},{"_id":"themes/next_8.8/source/images/avatar_300.jpg","hash":"13b3ca4593cd3c96d4f973b26ec9dbe51e28ed29","modified":1647420756286},{"_id":"themes/next_8.8/source/images/avatar_500.jpg","hash":"fa083b4b1260c2ee43810fc4819e958196ff7d49","modified":1647420756289},{"_id":"public/sitemap.xml","hash":"adee9cf4417a6315e9123778fcc9ac8eee6282b8","modified":1648731920417},{"_id":"public/about/index.html","hash":"f68b2303f2d5130200890d70ebb4a8dcbfe18e4d","modified":1647430033229},{"_id":"public/categories/index.html","hash":"b9c6a322275c9a8dd6823c910e74447d02c608e1","modified":1647430033229},{"_id":"public/tags/index.html","hash":"ad529d720c24b3860f70f5cd70c56dbc120310a8","modified":1647430033229},{"_id":"public/2021/12/18/Transformer-and-BERT/index.html","hash":"d398f7b4062e68b1a5f2059a2e115ed4b7b7ca9c","modified":1647430033229},{"_id":"public/2021/12/17/Algorithm/index.html","hash":"288f675e2b5be7e0f6a495a32b07faa0def55cdd","modified":1648731920417},{"_id":"public/2021/12/10/An-Introduction-to-Git/index.html","hash":"371dbbd3a16ec278ccc5848ef5f5ff45ff8e6b83","modified":1647430033229},{"_id":"public/page/2/index.html","hash":"92e83c196214c4f16d116c3b22e1030fbed3d7e0","modified":1648539568676},{"_id":"public/categories/Programming/index.html","hash":"738530c5ec9c09f6533532263a1b7d2f38eeb731","modified":1647430033229},{"_id":"public/categories/Little-Things/index.html","hash":"6f116908e11b9edf7f274183d6a228cd5935e401","modified":1647430033229},{"_id":"public/categories/Experiments/index.html","hash":"68594a29c2b738da5879a4aeed375b35a8bca9b2","modified":1647430033229},{"_id":"public/categories/Reinforcement-Learning/index.html","hash":"82762621563ef1e3cdc030def98539be6ee8fe82","modified":1647430033229},{"_id":"public/categories/Little-Things/Git/index.html","hash":"155dd2521ee73376d9999894abccbeb2908699d8","modified":1647430033229},{"_id":"public/categories/Topological-Data-Analysis/index.html","hash":"d6afae5544181b9ffa809343eff9ed825c25ed40","modified":1647430033229},{"_id":"public/categories/About-Papers/index.html","hash":"a0c5a08c58ca3493f2b92904257a8f4a63b8d213","modified":1647430033229},{"_id":"public/categories/Little-Things/Linux/index.html","hash":"1b5a398ef612b3a9477a2f9ad8451f90dcaf8356","modified":1647430033229},{"_id":"public/categories/Natural-Language-Processing/index.html","hash":"b1c3ad5bdf7e1ea4d5b7898dff8be39cd2135e57","modified":1647430033229},{"_id":"public/tags/Algorithm/index.html","hash":"0774322c7790d4111f83ff5c63b0e84b23693147","modified":1647430033229},{"_id":"public/tags/Programming/index.html","hash":"2885110652999c6e564c3cb42de285aad10051b3","modified":1647430033229},{"_id":"public/tags/Git/index.html","hash":"15d2be0a7738a8ec995fb295f71ffede7f34e539","modified":1647430033229},{"_id":"public/tags/vim/index.html","hash":"ee0473af338808a2844fba49feb15485913e86f4","modified":1647430033229},{"_id":"public/tags/markdown/index.html","hash":"43650c08812cb66c8097c41451152ed11462090f","modified":1647430033229},{"_id":"public/tags/vimtex/index.html","hash":"7f0153d6924bc17df03eeedd11c818141499a15c","modified":1647430033229},{"_id":"public/tags/Personal-Thought/index.html","hash":"185ad5eeb04fa84c3109ad5e32d011dfad24a395","modified":1647430033229},{"_id":"public/tags/Experiments/index.html","hash":"a933d234ce9ae04ab6907c46e5b98cadc3111209","modified":1647430033229},{"_id":"public/tags/private/index.html","hash":"3678d789a3bf4d8db181f46cc9124a0db9dca6fe","modified":1647430033229},{"_id":"public/tags/Reinforcement-Learning/index.html","hash":"59ca289fe2cf332dec0abb4959c9279c93ed616b","modified":1647430033229},{"_id":"public/tags/Topological-Data-Analysis/index.html","hash":"bdf6ca1cd19b32b69474e218587b9db092778d65","modified":1647430033229},{"_id":"public/tags/Multi-Task-Training/index.html","hash":"86cd77006c90e328034160feddcd73f94e76aec0","modified":1647430033229},{"_id":"public/tags/Papers/index.html","hash":"a03b73d893e34cfcfd899fc032bb6acbb1479c3a","modified":1647430033229},{"_id":"public/tags/Linux/index.html","hash":"81c25bea75593bd282aeefaf702971adfd3eeefa","modified":1647430033229},{"_id":"public/tags/Natural-Language-Processing/index.html","hash":"bc5351f63e41300c38f0e815691dbce98fb58499","modified":1647430033229},{"_id":"public/tags/Transformer/index.html","hash":"948299464b67a467231fd3ab21bf869830b44b6c","modified":1647430033229},{"_id":"public/tags/BERT/index.html","hash":"223cdb9d348c27936321b1c2ca183b5b8d48eda1","modified":1647430033229},{"_id":"public/archives/index.html","hash":"f87962a370b28b7a9af1d6f45f5ca886030ca35c","modified":1647430033229},{"_id":"public/archives/page/2/index.html","hash":"a65f67ab88f669fb588ea7649b25ae89a838c846","modified":1647430033229},{"_id":"public/archives/2021/index.html","hash":"a0465c7b34e65c9d47f329ec07b6baef65cc4eb7","modified":1647430033229},{"_id":"public/archives/2021/12/index.html","hash":"380487f43045ac831326e8158ea87fe5a790780e","modified":1647430033229},{"_id":"public/archives/2022/index.html","hash":"df6023a0ce34b86191d37de353e0a55357942f4a","modified":1647430033229},{"_id":"public/archives/2022/01/index.html","hash":"6910c47aceb9d2443cbebe241854b65bc30ac52d","modified":1647430033229},{"_id":"public/archives/2022/02/index.html","hash":"dc1cb38380d63941fb482564a5565cedb0065ff5","modified":1647430033229},{"_id":"public/2022/02/10/Shorcut-on-Linux/index.html","hash":"6b1df86b664b9be639ea68ef5f2b1ae209aac516","modified":1647430033229},{"_id":"public/2022/01/10/How-to-Blance-Losses-in-Multi-Task-Training/index.html","hash":"a789e4aa5e58c46887d794226eb67494201aa68c","modified":1647430128734},{"_id":"public/2022/01/20/Config-Vim/index.html","hash":"7c53e5bb68b8ffff4dcb5525f4247c8610932dc7","modified":1647430033229},{"_id":"public/2021/12/30/Foundation-for-Topological-Data-Analysis/index.html","hash":"b7c679f1471b6893e942bc38ef5a32d8eb971a62","modified":1647430033229},{"_id":"public/2021/12/17/Experiments/index.html","hash":"cf94463ab7304271f87498f194c6f97a64258009","modified":1647430033229},{"_id":"public/2021/12/15/Personal-Thought/index.html","hash":"f57afe6d758998442f84c052ec0d75368aea98d5","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/index.html","hash":"89cc3d119b6b851f8315b6662445e5b91404f081","modified":1647431151818},{"_id":"public/2021/12/03/First-Step-to-RL/index.html","hash":"ea9da394d94393cad86972253dd522f233e256b9","modified":1647430033229},{"_id":"public/2021/11/24/Construct-Your-Blog-with-Hexo-and-Github/index.html","hash":"be61e7f1a7e64ebc2ee635e90fe136757a5b9257","modified":1647430033229},{"_id":"public/index.html","hash":"fb2feaf70bb1298f80b2f8ad93a030c91de37a51","modified":1648731920417},{"_id":"public/CNAME","hash":"55c55444033af34e797e2d3cb1c1b4cf7889b3db","modified":1647430033229},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1647430033229},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1647430033229},{"_id":"public/images/avatar_100.jpg","hash":"a0f0a00c9326c57a5cc181aeb80dfda8e947920a","modified":1647430033229},{"_id":"public/images/avatar_200.jpg","hash":"4a76d1527e511350c9112e899046a34be59ad278","modified":1647430033229},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1647430033229},{"_id":"public/images/avatar_80.jpg","hash":"465e53598964df3852f08794cb73c5e459855e92","modified":1647430033229},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1647430033229},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1647430033229},{"_id":"public/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1647430033229},{"_id":"public/images/ye_16.ico","hash":"b8fb01b5361da89831d232a831a1532e9822bd72","modified":1647430033229},{"_id":"public/images/ye_32.ico","hash":"375c99cd785d93dd989c36604ffbd10ada71322a","modified":1647430033229},{"_id":"public/2021/12/03/First-Step-to-RL/policy_network.py","hash":"b3e8f06360cad0084a0656edaed4539f1b01e327","modified":1647430033229},{"_id":"public/2021/12/03/First-Step-to-RL/q_learning.py","hash":"3a68ec1153d26f2c18c9d34ee5deb5e495b8dca9","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/ADCM.jpg","hash":"ee5b75f3a063e07624c5f03111f98902d885cd8e","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_eq2.jpg","hash":"cf5832e89b29e39275d2fa4a2e39592e97f9a39e","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_eq1.jpg","hash":"2ea2a74f960377a6a9d0bc98ecfadd8ba09cd316","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_gl.jpg","hash":"fb8050f8b71a7c667cfa85672b505b3340d2231b","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_eq3.jpg","hash":"8fa845242bb6f737736d91485ca237e7132e19b5","modified":1647430033229},{"_id":"public/css/hbe.style.css","hash":"b0a0077cb588c0941823905fcc383aa7509ade73","modified":1647430033229},{"_id":"public/lib/hbe.js","hash":"136dba00826bdd086153bf0acb5473aea7183ad1","modified":1647430033229},{"_id":"public/css/noscript.css","hash":"54d14cd43dc297950a4a8d39ec9644dd5fc3499f","modified":1647430033229},{"_id":"public/js/motion.js","hash":"9c4c861dfb080b6244d4d9eba33ac686735754f3","modified":1647430033229},{"_id":"public/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1647430033229},{"_id":"public/js/schedule.js","hash":"2b43e2d576a308289880befc27580dbb2aa34439","modified":1647430033229},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1647430033229},{"_id":"public/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1647430033229},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1647430033229},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1647430033229},{"_id":"public/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1647430033229},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1647430033229},{"_id":"public/js/third-party/quicklink.js","hash":"6f58cd7aa8f6f1ab92d5a96551add293f4e55312","modified":1647430033229},{"_id":"public/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1647430033229},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1647430033229},{"_id":"public/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1647430033229},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1647430033229},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1647430033229},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1647430033229},{"_id":"public/js/third-party/comments/changyan.js","hash":"8c8ebec444c727b704ea41ad88b0b96ed2e4b8d4","modified":1647430033229},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1647430033229},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1647430033229},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1647430033229},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1647430033229},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1647430033229},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1647430033229},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1647430033229},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1647430033229},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1647430033229},{"_id":"public/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1647430033229},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1647430033229},{"_id":"public/css/main.css","hash":"2b9e134ea77c81001b2471bf42117e5cacdd104c","modified":1647430033229},{"_id":"public/images/avatar_300.jpg","hash":"13b3ca4593cd3c96d4f973b26ec9dbe51e28ed29","modified":1647430033229},{"_id":"public/images/avatar.jpg","hash":"ed5dde31684ebfd99e9965da1140fb919496f1d3","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_Cell.jpg","hash":"b17e79bf86bb3422527bf51d200ceceeb53ce936","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Saccader_Over.jpg","hash":"deaccd942ffca9e163a9f2c9bdfb69251d1004cb","modified":1647430033229},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1647430033229},{"_id":"public/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1647430033229},{"_id":"public/js/third-party/statistics/firestore.js","hash":"0960f16107ed61452fb0dffc6ed22dc143de34ef","modified":1647430033229},{"_id":"public/js/third-party/tags/mermaid.js","hash":"3dc4628efa6debd6490fc0ebddff2424a7b319d8","modified":1647430033229},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1647430033229},{"_id":"public/js/third-party/search/algolia-search.js","hash":"ac401e3736d56a3c9cb85ab885744cce0b813c55","modified":1647430033229},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1647430033229},{"_id":"public/images/avatar_500.jpg","hash":"fa083b4b1260c2ee43810fc4819e958196ff7d49","modified":1647430033229},{"_id":"public/2021/12/14/Tips-in-Papers/Tnet_over.jpg","hash":"ed04ca4049c6f909b0bf51ea57ffa9a2b445e1c8","modified":1647430033229},{"_id":"public/2021/12/10/An-Introduction-to-Git/git.jpg","hash":"db9ed8bb86df7e73d5be3bcae4cc8656e4a7a0ed","modified":1647430033229}],"Category":[{"name":"Programming","_id":"cl0thb1hs0004gqulbpvqfwm0"},{"name":"Little Things","_id":"cl0thb1hx000agqul4h2j8yl1"},{"name":"Experiments","_id":"cl0thb1i6000rgqulfmb69b84"},{"name":"Reinforcement Learning","_id":"cl0thb1i7000wgqulbykt89t7"},{"name":"Git","parent":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1i8000zgqul0ndr2k3p"},{"name":"Topological Data Analysis","_id":"cl0thb1i90012gqulgc8s0484"},{"name":"Hexo","parent":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1ia0016gqulenq1dwuo"},{"name":"About Papers","_id":"cl0thb1ia001cgqulhij4h0me"},{"name":"Linux","parent":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1ib001fgqul6oeu9tnu"},{"name":"Natural Language Processing","_id":"cl0thb1id001ogqulfkkq3pr6"}],"Data":[],"Page":[{"title":"about","date":"2021-12-12T13:52:49.000Z","_content":"\n\n\n<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n\n<!-- I am also interested in high performance computing. -->\n\n<br/>\n\n<br/>\n\n---\n\n<br/>\n\n<br/>\n\n> ​     *There is a pleasure in the pathless woods;*\n> ​     *there is a rapture on the lonely shore;*\n> ​     *there is society, where none intrudes,*\n> ​     *by the deep sea, and music in its roar;*\n> ​     *I love not man the less, but nature more...*\n> ​                          *by George Gordon Byron* \n\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2021-12-12 21:52:49\n---\n\n\n\n<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n\n<!-- I am also interested in high performance computing. -->\n\n<br/>\n\n<br/>\n\n---\n\n<br/>\n\n<br/>\n\n> ​     *There is a pleasure in the pathless woods;*\n> ​     *there is a rapture on the lonely shore;*\n> ​     *there is society, where none intrudes,*\n> ​     *by the deep sea, and music in its roar;*\n> ​     *I love not man the less, but nature more...*\n> ​                          *by George Gordon Byron* \n\n","updated":"2022-03-16T08:52:14.819Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl0thb1hk0000gqulhlzre7o2","content":"<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. --><!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. --><!-- I am also interested in high performance computing. --><html><head></head><body><br>\n<br>\n<hr>\n<br>\n<br>\n<blockquote>\n<p>​     <em>There is a pleasure in the pathless woods;</em>\n​     <em>there is a rapture on the lonely shore;</em>\n​     <em>there is society, where none intrudes,</em>\n​     <em>by the deep sea, and music in its roar;</em>\n​     <em>I love not man the less, but nature more…</em>\n​                          <em>by George Gordon Byron</em></p>\n</blockquote>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n<!-- I am also interested in high performance computing. -->\n<br/>\n<br/>\n<hr />\n<br/>\n<br/>\n<blockquote>\n<p>​     <em>There is a pleasure in the pathless woods;</em>\n​     <em>there is a rapture on the lonely shore;</em>\n​     <em>there is society, where none intrudes,</em>\n​     <em>by the deep sea, and music in its roar;</em>\n​     <em>I love not man the less, but nature more…</em>\n​                          <em>by George Gordon Byron</em></p>\n</blockquote>\n"},{"title":"categories","date":"2021-11-24T11:46:36.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2021-11-24 19:46:36\ntype: \"categories\"\n---\n","updated":"2022-03-16T08:52:14.823Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl0thb1hp0002gqulezj77qop","content":"<html><head></head><body></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":""},{"title":"tags","date":"2021-12-08T06:48:06.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2021-12-08 14:48:06\ntype: \"tags\"\n---\n","updated":"2022-03-16T08:52:14.826Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl0thb1ht0006gqulgu7p1t5x","content":"<html><head></head><body></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":""}],"Post":[{"title":"Algorithm","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-17T08:26:10.000Z","password":null,"summary":null,"description":"遇到过精巧的算法设计","_content":"\n# Depth First Search\n\n## Longest Increasing Path in a Matrix\n\nGiven an $m \\times n$ integers matrix, return the length of the longest\nincreasing path in matrix.\n\nMove direction: left, right, up, or down.\n\n```python\nclass Solution:\n\n    DIRS = [(-1, 0), (1, 0), (0, -1), (0, 1)]\n\n    def longestIncreasingPath(self, matrix: List[List[int]]) -> int:\n        if not matrix:\n            return 0\n\n        @lru_cache(None) # save  the storage\n        def find_max(i, j):\n        # find the next value and try the four directions\n        # return the longest direction.\n            max_ = 1\n            for dr in Solution.DIRS:\n                try_i = i + dr[0]\n                try_j = j + dr[1]\n                # the direction will be discarded if do not meet the condition\n                # and a direction meet the condition will be searched for the next\n                # value first.\n                if 0 <= try_i and try_i < n and 0<= try_j and try_j < m and \\\n                matrix[i][j] < matrix[try_i][try_j]:\n                    max_ = max(max_, find_max(try_i, try_j) + 1)\n                    # The value is increasing, so by setting `matrix[i][j] \\\n                    # < matrix[try_i][try_j]`, a searched position will never\n                    # be searched again.\n            return max_\n\n        n, m = len(matrix), len(matrix[0])\n        res = 0\n        for i in range(n):\n            for j in  range(m):\n                res = max(res, find_max(i, j))\n        return res\n\n```\n\n## Keyboard\n\nA keyboard only have 26 keys, `a~z`. Each key can be only typed `k` times at\nmost.\n\nHow many possible content there is, when the keyboard is typed `n` times?\n\n### Method 1: dfs\n\n```python\n class Solution:\n    # depth first search: from the first letter to the last letter\n    # fill the n positions.\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n\n        # c is the number of remain letters\n        # n is the number of letters needed to type in\n        # k is the max number that each letter can type\n        @lru_cache(None)\n        def dfs(c, n, k):\n            if n == 0:\n                # no letters is needed any more\n                # only 1 way: type nothing\n                # pick 0 letters\n                return 1\n            if c <= 0:\n                # no letter remained but n is not 0\n                # this is a failed type scheme\n                return 0\n            res = 0\n            for i in range(0, min(n, k) + 1):\n            # there are math.comb(n, i) ways to put i letters\n            # into n position.\n                res += math.comb(n, i) * dfs(c-1, n - i, k) % MOD\n            return res % MOD\n        ans = dfs(26, n, k)\n        return ans % MOD\n```\n\n### Method 2: dynamic programming\n\n```python\nclass Solution:\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n        res = [[0 for _ in range(27)] for _ in range(n + 1)]\n        # res[i][j] is the number of possibilities when first j letters\n        # is used to fill i positions.\n        # when the position is 0, no matter how many letters are used.\n        # there is only one possibility, i.e., filling nothing.\n        # thus, res[0][i] are all 1.\n        res[0][0] = 1\n        for i in range(27):\n            res[0][i] = 1\n\n        # res[i][j] can be divided into several possibilities.\n        # When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]\n        # when 1 letter is filled for the j-th letter, res[i-1][j-1]\n        # * C_i^1\n        # when 2 letters are filled for the j-th letter, res[i-2][j-1]\n        # * C_i^2\n        # C_i^m represent how many possibilities there are filling m of\n        # the same letters into i positions.\n        # m can be 0, but can not be larger than k or i.\n        for i in range(1, n + 1):\n            for j in range(1, 27):\n                for m in range(min(i + 1, k + 1)):\n                    res[i][j] += res[i - m][j - 1] * math.comb(i, m)\n                    res[i][j] %= MOD\n\n        return res[-1][-1] % MOD\n```\n\n# Other\n\n## The Gas Station\n\nThere are `n` stations along a circular route, where the amount of gas at the\n$i^{th}$ station is gas[i].\n\nA car costs cost[i] of gas to travel from the $i^{th}$ station to its next\n$(i + 1)^{th}$ station.\n\nCan the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int\n        n = len(gas)\n        res = [0] * n\n        # a car pass station i, it can get gas[i] and cost\n        # cost[i]. Thus gets gas[i] - cost[i].\n\n        # if in station i, gas[i] - cost[i] >= 0, it can\n        # arrive the next station.\n        # after arrive the next station, and gets the station\n        # if the remain >= 0 it can gets the next next station.\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        # second represents the station the car already getting.\n        # first represents the starting station.\n        # sum_ represents if the car can get the next staion.\n        # if sum_ >= 0, it can, else, it can not.\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n                sum_ -= res[first]\n                first += 1\n                # from 0 to n, first do not find an answer, return -1.\n                if first == n:\n                    return -1\n                else:\n                    if first > second:\n                        second += 1\n                        sum_ += res[second\n```\n\nConsider this, if y is the first station that the car can not arrive from x.\nThat is to say $\\sum_{i = y}^x res[i] < 0$. For a station z between x and y. It\ncan arrive z from x, which means the sum $> 0$. Then from z to y, the sum is\ndefinitely $< 0$. It can not arrive y from z.\n\nThus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int:\n        n = len(gas)\n        res = [0] * n\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n            # if can not arrive second + 1, then\n            # starting from second + 1\n                second += 1\n                first = second\n                # if the new starting point equal or bigger than\n                # n, first move from 0 to n fails to find.\n                # if key is True, second + 1 is actually larger than\n                # n, first move from 0 to n fails to find.\n                if first == n or key:\n                    return -1\n                sum_ = res[first]\n```\n","source":"_posts/Algorithm.md","raw":"---\ntitle: Algorithm\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-17 16:26:10\npassword:\nsummary:\ndescription: 遇到过精巧的算法设计\ncategories:\n  - Programming\ntags:\n  - Algorithm\n  - Programming\n---\n\n# Depth First Search\n\n## Longest Increasing Path in a Matrix\n\nGiven an $m \\times n$ integers matrix, return the length of the longest\nincreasing path in matrix.\n\nMove direction: left, right, up, or down.\n\n```python\nclass Solution:\n\n    DIRS = [(-1, 0), (1, 0), (0, -1), (0, 1)]\n\n    def longestIncreasingPath(self, matrix: List[List[int]]) -> int:\n        if not matrix:\n            return 0\n\n        @lru_cache(None) # save  the storage\n        def find_max(i, j):\n        # find the next value and try the four directions\n        # return the longest direction.\n            max_ = 1\n            for dr in Solution.DIRS:\n                try_i = i + dr[0]\n                try_j = j + dr[1]\n                # the direction will be discarded if do not meet the condition\n                # and a direction meet the condition will be searched for the next\n                # value first.\n                if 0 <= try_i and try_i < n and 0<= try_j and try_j < m and \\\n                matrix[i][j] < matrix[try_i][try_j]:\n                    max_ = max(max_, find_max(try_i, try_j) + 1)\n                    # The value is increasing, so by setting `matrix[i][j] \\\n                    # < matrix[try_i][try_j]`, a searched position will never\n                    # be searched again.\n            return max_\n\n        n, m = len(matrix), len(matrix[0])\n        res = 0\n        for i in range(n):\n            for j in  range(m):\n                res = max(res, find_max(i, j))\n        return res\n\n```\n\n## Keyboard\n\nA keyboard only have 26 keys, `a~z`. Each key can be only typed `k` times at\nmost.\n\nHow many possible content there is, when the keyboard is typed `n` times?\n\n### Method 1: dfs\n\n```python\n class Solution:\n    # depth first search: from the first letter to the last letter\n    # fill the n positions.\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n\n        # c is the number of remain letters\n        # n is the number of letters needed to type in\n        # k is the max number that each letter can type\n        @lru_cache(None)\n        def dfs(c, n, k):\n            if n == 0:\n                # no letters is needed any more\n                # only 1 way: type nothing\n                # pick 0 letters\n                return 1\n            if c <= 0:\n                # no letter remained but n is not 0\n                # this is a failed type scheme\n                return 0\n            res = 0\n            for i in range(0, min(n, k) + 1):\n            # there are math.comb(n, i) ways to put i letters\n            # into n position.\n                res += math.comb(n, i) * dfs(c-1, n - i, k) % MOD\n            return res % MOD\n        ans = dfs(26, n, k)\n        return ans % MOD\n```\n\n### Method 2: dynamic programming\n\n```python\nclass Solution:\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n        res = [[0 for _ in range(27)] for _ in range(n + 1)]\n        # res[i][j] is the number of possibilities when first j letters\n        # is used to fill i positions.\n        # when the position is 0, no matter how many letters are used.\n        # there is only one possibility, i.e., filling nothing.\n        # thus, res[0][i] are all 1.\n        res[0][0] = 1\n        for i in range(27):\n            res[0][i] = 1\n\n        # res[i][j] can be divided into several possibilities.\n        # When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]\n        # when 1 letter is filled for the j-th letter, res[i-1][j-1]\n        # * C_i^1\n        # when 2 letters are filled for the j-th letter, res[i-2][j-1]\n        # * C_i^2\n        # C_i^m represent how many possibilities there are filling m of\n        # the same letters into i positions.\n        # m can be 0, but can not be larger than k or i.\n        for i in range(1, n + 1):\n            for j in range(1, 27):\n                for m in range(min(i + 1, k + 1)):\n                    res[i][j] += res[i - m][j - 1] * math.comb(i, m)\n                    res[i][j] %= MOD\n\n        return res[-1][-1] % MOD\n```\n\n# Other\n\n## The Gas Station\n\nThere are `n` stations along a circular route, where the amount of gas at the\n$i^{th}$ station is gas[i].\n\nA car costs cost[i] of gas to travel from the $i^{th}$ station to its next\n$(i + 1)^{th}$ station.\n\nCan the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int\n        n = len(gas)\n        res = [0] * n\n        # a car pass station i, it can get gas[i] and cost\n        # cost[i]. Thus gets gas[i] - cost[i].\n\n        # if in station i, gas[i] - cost[i] >= 0, it can\n        # arrive the next station.\n        # after arrive the next station, and gets the station\n        # if the remain >= 0 it can gets the next next station.\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        # second represents the station the car already getting.\n        # first represents the starting station.\n        # sum_ represents if the car can get the next staion.\n        # if sum_ >= 0, it can, else, it can not.\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n                sum_ -= res[first]\n                first += 1\n                # from 0 to n, first do not find an answer, return -1.\n                if first == n:\n                    return -1\n                else:\n                    if first > second:\n                        second += 1\n                        sum_ += res[second\n```\n\nConsider this, if y is the first station that the car can not arrive from x.\nThat is to say $\\sum_{i = y}^x res[i] < 0$. For a station z between x and y. It\ncan arrive z from x, which means the sum $> 0$. Then from z to y, the sum is\ndefinitely $< 0$. It can not arrive y from z.\n\nThus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int:\n        n = len(gas)\n        res = [0] * n\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n            # if can not arrive second + 1, then\n            # starting from second + 1\n                second += 1\n                first = second\n                # if the new starting point equal or bigger than\n                # n, first move from 0 to n fails to find.\n                # if key is True, second + 1 is actually larger than\n                # n, first move from 0 to n fails to find.\n                if first == n or key:\n                    return -1\n                sum_ = res[first]\n```\n","slug":"Algorithm","published":1,"updated":"2022-03-31T13:05:01.967Z","_id":"cl0thb1hm0001gqul0l6oda4w","comments":1,"layout":"post","photos":[],"link":"","content":"<html><head></head><body><h1 id=\"depth-first-search\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#depth-first-search\"></a> Depth First Search</h1>\n<h2 id=\"longest-increasing-path-in-a-matrix\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#longest-increasing-path-in-a-matrix\"></a> Longest Increasing Path in a Matrix</h2>\n<p>Given an <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m \\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> integers matrix, return the length of the longest\nincreasing path in matrix.</p>\n<p>Move direction: left, right, up, or down.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DIRS = [(-<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">0</span>, -<span class=\"number\">1</span>), (<span class=\"number\">0</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestIncreasingPath</span>(<span class=\"params\">self, matrix: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> matrix:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>) </span><span class=\"comment\"># save  the storage</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_max</span>(<span class=\"params\">i, j</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># find the next value and try the four directions</span></span><br><span class=\"line\">        <span class=\"comment\"># return the longest direction.</span></span><br><span class=\"line\">            max_ = <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dr <span class=\"keyword\">in</span> Solution.DIRS:</span><br><span class=\"line\">                try_i = i + dr[<span class=\"number\">0</span>]</span><br><span class=\"line\">                try_j = j + dr[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"comment\"># the direction will be discarded if do not meet the condition</span></span><br><span class=\"line\">                <span class=\"comment\"># and a direction meet the condition will be searched for the next</span></span><br><span class=\"line\">                <span class=\"comment\"># value first.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= try_i <span class=\"keyword\">and</span> try_i &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span>&lt;= try_j <span class=\"keyword\">and</span> try_j &lt; m <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                matrix[i][j] &lt; matrix[try_i][try_j]:</span><br><span class=\"line\">                    max_ = <span class=\"built_in\">max</span>(max_, find_max(try_i, try_j) + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># The value is increasing, so by setting `matrix[i][j] \\</span></span><br><span class=\"line\">                    <span class=\"comment\"># &lt; matrix[try_i][try_j]`, a searched position will never</span></span><br><span class=\"line\">                    <span class=\"comment\"># be searched again.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> max_</span><br><span class=\"line\"></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(matrix), <span class=\"built_in\">len</span>(matrix[<span class=\"number\">0</span>])</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span>  <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">                res = <span class=\"built_in\">max</span>(res, find_max(i, j))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"keyboard\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#keyboard\"></a> Keyboard</h2>\n<p>A keyboard only have 26 keys, <code>a~z</code>. Each key can be only typed <code>k</code> times at\nmost.</p>\n<p>How many possible content there is, when the keyboard is typed <code>n</code> times?</p>\n<h3 id=\"method-1-dfs\"><span class=\"post-title-index\">1.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#method-1-dfs\"></a> Method 1: dfs</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">   <span class=\"comment\"># depth first search: from the first letter to the last letter</span></span><br><span class=\"line\">   <span class=\"comment\"># fill the n positions.</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">       MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\"># c is the number of remain letters</span></span><br><span class=\"line\">       <span class=\"comment\"># n is the number of letters needed to type in</span></span><br><span class=\"line\">       <span class=\"comment\"># k is the max number that each letter can type</span></span><br><span class=\"line\"><span class=\"meta\">       @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>)</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dfs</span>(<span class=\"params\">c, n, k</span>):</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> n == <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letters is needed any more</span></span><br><span class=\"line\">               <span class=\"comment\"># only 1 way: type nothing</span></span><br><span class=\"line\">               <span class=\"comment\"># pick 0 letters</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> c &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letter remained but n is not 0</span></span><br><span class=\"line\">               <span class=\"comment\"># this is a failed type scheme</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">           res = <span class=\"number\">0</span></span><br><span class=\"line\">           <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">min</span>(n, k) + <span class=\"number\">1</span>):</span><br><span class=\"line\">           <span class=\"comment\"># there are math.comb(n, i) ways to put i letters</span></span><br><span class=\"line\">           <span class=\"comment\"># into n position.</span></span><br><span class=\"line\">               res += math.comb(n, i) * dfs(c-<span class=\"number\">1</span>, n - i, k) % MOD</span><br><span class=\"line\">           <span class=\"keyword\">return</span> res % MOD</span><br><span class=\"line\">       ans = dfs(<span class=\"number\">26</span>, n, k)</span><br><span class=\"line\">       <span class=\"keyword\">return</span> ans % MOD</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"method-2-dynamic-programming\"><span class=\"post-title-index\">1.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#method-2-dynamic-programming\"></a> Method 2: dynamic programming</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\">        res = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n + <span class=\"number\">1</span>)]</span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] is the number of possibilities when first j letters</span></span><br><span class=\"line\">        <span class=\"comment\"># is used to fill i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># when the position is 0, no matter how many letters are used.</span></span><br><span class=\"line\">        <span class=\"comment\"># there is only one possibility, i.e., filling nothing.</span></span><br><span class=\"line\">        <span class=\"comment\"># thus, res[0][i] are all 1.</span></span><br><span class=\"line\">        res[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] can be divided into several possibilities.</span></span><br><span class=\"line\">        <span class=\"comment\"># When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># when 1 letter is filled for the j-th letter, res[i-1][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^1</span></span><br><span class=\"line\">        <span class=\"comment\"># when 2 letters are filled for the j-th letter, res[i-2][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^2</span></span><br><span class=\"line\">        <span class=\"comment\"># C_i^m represent how many possibilities there are filling m of</span></span><br><span class=\"line\">        <span class=\"comment\"># the same letters into i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># m can be 0, but can not be larger than k or i.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">27</span>):</span><br><span class=\"line\">                <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">min</span>(i + <span class=\"number\">1</span>, k + <span class=\"number\">1</span>)):</span><br><span class=\"line\">                    res[i][j] += res[i - m][j - <span class=\"number\">1</span>] * math.comb(i, m)</span><br><span class=\"line\">                    res[i][j] %= MOD</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] % MOD</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"other\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#other\"></a> Other</h1>\n<h2 id=\"the-gas-station\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#the-gas-station\"></a> The Gas Station</h2>\n<p>There are <code>n</code> stations along a circular route, where the amount of gas at the\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station is gas[i].</p>\n<p>A car costs cost[i] of gas to travel from the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station to its next\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">(i + 1)^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station.</p>\n<p>Can the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span></span></span><br><span class=\"line\"><span class=\"function\">        n = <span class=\"built_in\">len</span>(gas)</span></span><br><span class=\"line\"><span class=\"function\">        res = [0] * n</span></span><br><span class=\"line\"><span class=\"function\">        # a car <span class=\"keyword\">pass</span> station i, it can get gas[i] <span class=\"keyword\">and</span> cost</span></span><br><span class=\"line\"><span class=\"function\">        # cost[i]. Thus gets gas[i] - cost[i].</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> <span class=\"keyword\">in</span> station i, gas[i] - cost[i] &gt;= 0, it can</span></span><br><span class=\"line\"><span class=\"function\">        # arrive the <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        # after arrive the <span class=\"built_in\">next</span> station, <span class=\"keyword\">and</span> gets the station</span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> the remain &gt;= 0 it can gets the <span class=\"built_in\">next</span> <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span></span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"comment\"># second represents the station the car already getting.</span></span><br><span class=\"line\">        <span class=\"comment\"># first represents the starting station.</span></span><br><span class=\"line\">        <span class=\"comment\"># sum_ represents if the car can get the next staion.</span></span><br><span class=\"line\">        <span class=\"comment\"># if sum_ &gt;= 0, it can, else, it can not.</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                sum_ -= res[first]</span><br><span class=\"line\">                first += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"comment\"># from 0 to n, first do not find an answer, return -1.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> first &gt; second:</span><br><span class=\"line\">                        second += <span class=\"number\">1</span></span><br><span class=\"line\">                        sum_ += res[second</span><br></pre></td></tr></tbody></table></figure>\n<p>Consider this, if y is the first station that the car can not arrive from x.\nThat is to say <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>y</mi></mrow><mi>x</mi></msubsup><mi>r</mi><mi>e</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\sum_{i = y}^x res[i] &lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24011em;vertical-align:-0.43581800000000004em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. For a station z between x and y. It\ncan arrive z from x, which means the sum <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. Then from z to y, the sum is\ndefinitely <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. It can not arrive y from z.</p>\n<p>Thus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(gas)</span><br><span class=\"line\">        res = [<span class=\"number\">0</span>] * n</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># if can not arrive second + 1, then</span></span><br><span class=\"line\">            <span class=\"comment\"># starting from second + 1</span></span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                first = second</span><br><span class=\"line\">                <span class=\"comment\"># if the new starting point equal or bigger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"comment\"># if key is True, second + 1 is actually larger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n <span class=\"keyword\">or</span> key:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                sum_ = res[first]</span><br></pre></td></tr></tbody></table></figure>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"depth-first-search\"><a class=\"markdownIt-Anchor\" href=\"#depth-first-search\"></a> Depth First Search</h1>\n<h2 id=\"longest-increasing-path-in-a-matrix\"><a class=\"markdownIt-Anchor\" href=\"#longest-increasing-path-in-a-matrix\"></a> Longest Increasing Path in a Matrix</h2>\n<p>Given an <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m \\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> integers matrix, return the length of the longest\nincreasing path in matrix.</p>\n<p>Move direction: left, right, up, or down.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DIRS = [(-<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">0</span>, -<span class=\"number\">1</span>), (<span class=\"number\">0</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestIncreasingPath</span>(<span class=\"params\">self, matrix: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> matrix:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>) </span><span class=\"comment\"># save  the storage</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_max</span>(<span class=\"params\">i, j</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># find the next value and try the four directions</span></span><br><span class=\"line\">        <span class=\"comment\"># return the longest direction.</span></span><br><span class=\"line\">            max_ = <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dr <span class=\"keyword\">in</span> Solution.DIRS:</span><br><span class=\"line\">                try_i = i + dr[<span class=\"number\">0</span>]</span><br><span class=\"line\">                try_j = j + dr[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"comment\"># the direction will be discarded if do not meet the condition</span></span><br><span class=\"line\">                <span class=\"comment\"># and a direction meet the condition will be searched for the next</span></span><br><span class=\"line\">                <span class=\"comment\"># value first.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= try_i <span class=\"keyword\">and</span> try_i &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span>&lt;= try_j <span class=\"keyword\">and</span> try_j &lt; m <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                matrix[i][j] &lt; matrix[try_i][try_j]:</span><br><span class=\"line\">                    max_ = <span class=\"built_in\">max</span>(max_, find_max(try_i, try_j) + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># The value is increasing, so by setting `matrix[i][j] \\</span></span><br><span class=\"line\">                    <span class=\"comment\"># &lt; matrix[try_i][try_j]`, a searched position will never</span></span><br><span class=\"line\">                    <span class=\"comment\"># be searched again.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> max_</span><br><span class=\"line\"></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(matrix), <span class=\"built_in\">len</span>(matrix[<span class=\"number\">0</span>])</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span>  <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">                res = <span class=\"built_in\">max</span>(res, find_max(i, j))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"keyboard\"><a class=\"markdownIt-Anchor\" href=\"#keyboard\"></a> Keyboard</h2>\n<p>A keyboard only have 26 keys, <code>a~z</code>. Each key can be only typed <code>k</code> times at\nmost.</p>\n<p>How many possible content there is, when the keyboard is typed <code>n</code> times?</p>\n<h3 id=\"method-1-dfs\"><a class=\"markdownIt-Anchor\" href=\"#method-1-dfs\"></a> Method 1: dfs</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">   <span class=\"comment\"># depth first search: from the first letter to the last letter</span></span><br><span class=\"line\">   <span class=\"comment\"># fill the n positions.</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">       MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\"># c is the number of remain letters</span></span><br><span class=\"line\">       <span class=\"comment\"># n is the number of letters needed to type in</span></span><br><span class=\"line\">       <span class=\"comment\"># k is the max number that each letter can type</span></span><br><span class=\"line\"><span class=\"meta\">       @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>)</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dfs</span>(<span class=\"params\">c, n, k</span>):</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> n == <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letters is needed any more</span></span><br><span class=\"line\">               <span class=\"comment\"># only 1 way: type nothing</span></span><br><span class=\"line\">               <span class=\"comment\"># pick 0 letters</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> c &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letter remained but n is not 0</span></span><br><span class=\"line\">               <span class=\"comment\"># this is a failed type scheme</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">           res = <span class=\"number\">0</span></span><br><span class=\"line\">           <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">min</span>(n, k) + <span class=\"number\">1</span>):</span><br><span class=\"line\">           <span class=\"comment\"># there are math.comb(n, i) ways to put i letters</span></span><br><span class=\"line\">           <span class=\"comment\"># into n position.</span></span><br><span class=\"line\">               res += math.comb(n, i) * dfs(c-<span class=\"number\">1</span>, n - i, k) % MOD</span><br><span class=\"line\">           <span class=\"keyword\">return</span> res % MOD</span><br><span class=\"line\">       ans = dfs(<span class=\"number\">26</span>, n, k)</span><br><span class=\"line\">       <span class=\"keyword\">return</span> ans % MOD</span><br></pre></td></tr></table></figure>\n<h3 id=\"method-2-dynamic-programming\"><a class=\"markdownIt-Anchor\" href=\"#method-2-dynamic-programming\"></a> Method 2: dynamic programming</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\">        res = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n + <span class=\"number\">1</span>)]</span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] is the number of possibilities when first j letters</span></span><br><span class=\"line\">        <span class=\"comment\"># is used to fill i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># when the position is 0, no matter how many letters are used.</span></span><br><span class=\"line\">        <span class=\"comment\"># there is only one possibility, i.e., filling nothing.</span></span><br><span class=\"line\">        <span class=\"comment\"># thus, res[0][i] are all 1.</span></span><br><span class=\"line\">        res[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] can be divided into several possibilities.</span></span><br><span class=\"line\">        <span class=\"comment\"># When 0 letter is filled for the $j^&#123;th&#125;$ letter, res[i][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># when 1 letter is filled for the j-th letter, res[i-1][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^1</span></span><br><span class=\"line\">        <span class=\"comment\"># when 2 letters are filled for the j-th letter, res[i-2][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^2</span></span><br><span class=\"line\">        <span class=\"comment\"># C_i^m represent how many possibilities there are filling m of</span></span><br><span class=\"line\">        <span class=\"comment\"># the same letters into i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># m can be 0, but can not be larger than k or i.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">27</span>):</span><br><span class=\"line\">                <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">min</span>(i + <span class=\"number\">1</span>, k + <span class=\"number\">1</span>)):</span><br><span class=\"line\">                    res[i][j] += res[i - m][j - <span class=\"number\">1</span>] * math.comb(i, m)</span><br><span class=\"line\">                    res[i][j] %= MOD</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] % MOD</span><br></pre></td></tr></table></figure>\n<h1 id=\"other\"><a class=\"markdownIt-Anchor\" href=\"#other\"></a> Other</h1>\n<h2 id=\"the-gas-station\"><a class=\"markdownIt-Anchor\" href=\"#the-gas-station\"></a> The Gas Station</h2>\n<p>There are <code>n</code> stations along a circular route, where the amount of gas at the\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station is gas[i].</p>\n<p>A car costs cost[i] of gas to travel from the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station to its next\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">(i + 1)^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station.</p>\n<p>Can the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span></span></span><br><span class=\"line\"><span class=\"function\">        n = <span class=\"built_in\">len</span>(gas)</span></span><br><span class=\"line\"><span class=\"function\">        res = [0] * n</span></span><br><span class=\"line\"><span class=\"function\">        # a car <span class=\"keyword\">pass</span> station i, it can get gas[i] <span class=\"keyword\">and</span> cost</span></span><br><span class=\"line\"><span class=\"function\">        # cost[i]. Thus gets gas[i] - cost[i].</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> <span class=\"keyword\">in</span> station i, gas[i] - cost[i] &gt;= 0, it can</span></span><br><span class=\"line\"><span class=\"function\">        # arrive the <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        # after arrive the <span class=\"built_in\">next</span> station, <span class=\"keyword\">and</span> gets the station</span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> the remain &gt;= 0 it can gets the <span class=\"built_in\">next</span> <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span></span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"comment\"># second represents the station the car already getting.</span></span><br><span class=\"line\">        <span class=\"comment\"># first represents the starting station.</span></span><br><span class=\"line\">        <span class=\"comment\"># sum_ represents if the car can get the next staion.</span></span><br><span class=\"line\">        <span class=\"comment\"># if sum_ &gt;= 0, it can, else, it can not.</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                sum_ -= res[first]</span><br><span class=\"line\">                first += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"comment\"># from 0 to n, first do not find an answer, return -1.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> first &gt; second:</span><br><span class=\"line\">                        second += <span class=\"number\">1</span></span><br><span class=\"line\">                        sum_ += res[second</span><br></pre></td></tr></table></figure>\n<p>Consider this, if y is the first station that the car can not arrive from x.\nThat is to say <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>y</mi></mrow><mi>x</mi></msubsup><mi>r</mi><mi>e</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\sum_{i = y}^x res[i] &lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24011em;vertical-align:-0.43581800000000004em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. For a station z between x and y. It\ncan arrive z from x, which means the sum <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. Then from z to y, the sum is\ndefinitely <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. It can not arrive y from z.</p>\n<p>Thus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(gas)</span><br><span class=\"line\">        res = [<span class=\"number\">0</span>] * n</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># if can not arrive second + 1, then</span></span><br><span class=\"line\">            <span class=\"comment\"># starting from second + 1</span></span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                first = second</span><br><span class=\"line\">                <span class=\"comment\"># if the new starting point equal or bigger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"comment\"># if key is True, second + 1 is actually larger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n <span class=\"keyword\">or</span> key:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                sum_ = res[first]</span><br></pre></td></tr></table></figure>\n"},{"title":"An Introduction to Git","date":"2021-12-10T13:55:33.000Z","description":"介绍git里面的一些基本概念，了解git运行的基本原理。","summary":null,"_content":"\n\n![The Structure of Git](git.jpg)\n\ngit checkout用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重写工作区。\n\ngit ls-files查看缓存区中文件信息，它的参数有，括号里面是简写\n\n--cached (-c) 查看缓存区中所有文件\n\n--midified (-m)查看修改过的文件\n\n--delete (-d)查看删除过的文件\n\n--other (-o)查看没有被git跟踪的文件\n\n","source":"_posts/An-Introduction-to-Git.md","raw":"---\ntitle: An Introduction to Git\ndate: 2021-12-10 21:55:33\ndescription: 介绍git里面的一些基本概念，了解git运行的基本原理。\nsummary:\ncategories:\n- Little Things\n- Git\ntags:\n- Git\n---\n\n\n![The Structure of Git](git.jpg)\n\ngit checkout用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重写工作区。\n\ngit ls-files查看缓存区中文件信息，它的参数有，括号里面是简写\n\n--cached (-c) 查看缓存区中所有文件\n\n--midified (-m)查看修改过的文件\n\n--delete (-d)查看删除过的文件\n\n--other (-o)查看没有被git跟踪的文件\n\n","slug":"An-Introduction-to-Git","published":1,"updated":"2022-03-16T08:52:14.728Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hq0003gquleqzn8k7j","content":"<html><head></head><body><p><img src=\"git.jpg\" alt=\"The Structure of Git\"></p>\n<p>git checkout用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重写工作区。</p>\n<p>git ls-files查看缓存区中文件信息，它的参数有，括号里面是简写</p>\n<p>–cached (-c) 查看缓存区中所有文件</p>\n<p>–midified (-m)查看修改过的文件</p>\n<p>–delete (-d)查看删除过的文件</p>\n<p>–other (-o)查看没有被git跟踪的文件</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p><img src=\"git.jpg\" alt=\"The Structure of Git\" /></p>\n<p>git checkout用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重写工作区。</p>\n<p>git ls-files查看缓存区中文件信息，它的参数有，括号里面是简写</p>\n<p>–cached (-c) 查看缓存区中所有文件</p>\n<p>–midified (-m)查看修改过的文件</p>\n<p>–delete (-d)查看删除过的文件</p>\n<p>–other (-o)查看没有被git跟踪的文件</p>\n"},{"title":"Construct Your Blog with Hexo and Github","date":"2021-11-24T08:20:43.000Z","hidden":true,"description":"Hexo, Next等的使用和介绍。","_content":"\n\n# 主要参考博客\n\nhttps://segmentfault.com/a/1190000017986794\n\nhttps://godweiyang.com/2018/04/13/hexo-blog/\n\nhttps://blog.guaoxiaohei.com/posts/Hexo-Level/\n\nhttps://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\n\nhttps://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\n\ntypora标题和大纲编号\n\nhttps://zhuanlan.zhihu.com/p/110257979\n\n# 实现的时候也遇到了一些问题\n\n## 本地显示没问题，hexo d之后 在GitHub无法显示主题样式\n\n更改主目录下面的_config.yml文件\n\n\n\nurl: github远程仓库的地址, 如 https://xyegithub.github.io/myBlog/\n\nroot: url的最后一段，如/myBlog/\n\n更改保存之后，hexo clean; hexo g; hexo d\n\n##  git在推送的时候很容易出现网络错误\n\n参考博客\n\nhttps://juejin.cn/post/6844904193170341896\n\n刷新dns管理员cmd下运行 ipconfig /flushdns\n\n但是这个方法不是很管用\n\n### 更好的方法\n\n可以不用代理，将hexo _config.yml里的git地址由`https://github.com/xxx`修改为ssh `git@github.com:xxx/xxx`也可以\n\n## 将github page 设置为谷歌可搜索\n\n参考博客\n\nhttps://mizeri.github.io/2021/04/18/hexo-sitemap-google/\n\n## 绑定自己的域名\n\n1. 用freenom申请一个免费的域名，如yexiang.ml\n2. 用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程\n\n","source":"_posts/Construct-Your-Blog-with-Hexo-and-Github.md","raw":"---\ntitle: Construct Your Blog with Hexo and Github\ndate: 2021-11-24 16:20:43\nhidden: true\ndescription:  Hexo, Next等的使用和介绍。\ntags: \n- Hexo\ncategories:\n- Little Things\n- Hexo\n---\n\n\n# 主要参考博客\n\nhttps://segmentfault.com/a/1190000017986794\n\nhttps://godweiyang.com/2018/04/13/hexo-blog/\n\nhttps://blog.guaoxiaohei.com/posts/Hexo-Level/\n\nhttps://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\n\nhttps://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\n\ntypora标题和大纲编号\n\nhttps://zhuanlan.zhihu.com/p/110257979\n\n# 实现的时候也遇到了一些问题\n\n## 本地显示没问题，hexo d之后 在GitHub无法显示主题样式\n\n更改主目录下面的_config.yml文件\n\n\n\nurl: github远程仓库的地址, 如 https://xyegithub.github.io/myBlog/\n\nroot: url的最后一段，如/myBlog/\n\n更改保存之后，hexo clean; hexo g; hexo d\n\n##  git在推送的时候很容易出现网络错误\n\n参考博客\n\nhttps://juejin.cn/post/6844904193170341896\n\n刷新dns管理员cmd下运行 ipconfig /flushdns\n\n但是这个方法不是很管用\n\n### 更好的方法\n\n可以不用代理，将hexo _config.yml里的git地址由`https://github.com/xxx`修改为ssh `git@github.com:xxx/xxx`也可以\n\n## 将github page 设置为谷歌可搜索\n\n参考博客\n\nhttps://mizeri.github.io/2021/04/18/hexo-sitemap-google/\n\n## 绑定自己的域名\n\n1. 用freenom申请一个免费的域名，如yexiang.ml\n2. 用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程\n\n","slug":"Construct-Your-Blog-with-Hexo-and-Github","published":1,"updated":"2022-03-16T08:52:14.742Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hu0007gqul2ljs4cm9","content":"<html><head></head><body><h1 id=\"主要参考博客\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#主要参考博客\"></a> 主要参考博客</h1>\n<p><a href=\"https://segmentfault.com/a/1190000017986794\">https://segmentfault.com/a/1190000017986794</a></p>\n<p><a href=\"https://godweiyang.com/2018/04/13/hexo-blog/\">https://godweiyang.com/2018/04/13/hexo-blog/</a></p>\n<p><a href=\"https://blog.guaoxiaohei.com/posts/Hexo-Level/\">https://blog.guaoxiaohei.com/posts/Hexo-Level/</a></p>\n<p><a href=\"https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\">https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/</a></p>\n<p><a href=\"https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\">https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/</a></p>\n<p>typora标题和大纲编号</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/110257979\">https://zhuanlan.zhihu.com/p/110257979</a></p>\n<h1 id=\"实现的时候也遇到了一些问题\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#实现的时候也遇到了一些问题\"></a> 实现的时候也遇到了一些问题</h1>\n<h2 id=\"本地显示没问题hexo-d之后-在github无法显示主题样式\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#本地显示没问题hexo-d之后-在github无法显示主题样式\"></a> 本地显示没问题，hexo d之后 在GitHub无法显示主题样式</h2>\n<p>更改主目录下面的_config.yml文件</p>\n<p>url: github远程仓库的地址, 如 <a href=\"https://xyegithub.github.io/myBlog/\">https://xyegithub.github.io/myBlog/</a></p>\n<p>root: url的最后一段，如/myBlog/</p>\n<p>更改保存之后，hexo clean; hexo g; hexo d</p>\n<h2 id=\"git在推送的时候很容易出现网络错误\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#git在推送的时候很容易出现网络错误\"></a> git在推送的时候很容易出现网络错误</h2>\n<p>参考博客</p>\n<p><a href=\"https://juejin.cn/post/6844904193170341896\">https://juejin.cn/post/6844904193170341896</a></p>\n<p>刷新dns管理员cmd下运行 ipconfig /flushdns</p>\n<p>但是这个方法不是很管用</p>\n<h3 id=\"更好的方法\"><span class=\"post-title-index\">2.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#更好的方法\"></a> 更好的方法</h3>\n<p>可以不用代理，将hexo _config.yml里的git地址由<code>https://github.com/xxx</code>修改为ssh <code>git@github.com:xxx/xxx</code>也可以</p>\n<h2 id=\"将github-page-设置为谷歌可搜索\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#将github-page-设置为谷歌可搜索\"></a> 将github page 设置为谷歌可搜索</h2>\n<p>参考博客</p>\n<p><a href=\"https://mizeri.github.io/2021/04/18/hexo-sitemap-google/\">https://mizeri.github.io/2021/04/18/hexo-sitemap-google/</a></p>\n<h2 id=\"绑定自己的域名\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#绑定自己的域名\"></a> 绑定自己的域名</h2>\n<ol>\n<li>用freenom申请一个免费的域名，<a href=\"http://xn--yexiang-i22m.ml\">如yexiang.ml</a></li>\n<li>用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程</li>\n</ol>\n<!-- flag of hidden posts --></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"主要参考博客\"><a class=\"markdownIt-Anchor\" href=\"#主要参考博客\"></a> 主要参考博客</h1>\n<p><a href=\"https://segmentfault.com/a/1190000017986794\">https://segmentfault.com/a/1190000017986794</a></p>\n<p><a href=\"https://godweiyang.com/2018/04/13/hexo-blog/\">https://godweiyang.com/2018/04/13/hexo-blog/</a></p>\n<p><a href=\"https://blog.guaoxiaohei.com/posts/Hexo-Level/\">https://blog.guaoxiaohei.com/posts/Hexo-Level/</a></p>\n<p><a href=\"https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\">https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/</a></p>\n<p><a href=\"https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\">https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/</a></p>\n<p>typora标题和大纲编号</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/110257979\">https://zhuanlan.zhihu.com/p/110257979</a></p>\n<h1 id=\"实现的时候也遇到了一些问题\"><a class=\"markdownIt-Anchor\" href=\"#实现的时候也遇到了一些问题\"></a> 实现的时候也遇到了一些问题</h1>\n<h2 id=\"本地显示没问题hexo-d之后-在github无法显示主题样式\"><a class=\"markdownIt-Anchor\" href=\"#本地显示没问题hexo-d之后-在github无法显示主题样式\"></a> 本地显示没问题，hexo d之后 在GitHub无法显示主题样式</h2>\n<p>更改主目录下面的_config.yml文件</p>\n<p>url: github远程仓库的地址, 如 <a href=\"https://xyegithub.github.io/myBlog/\">https://xyegithub.github.io/myBlog/</a></p>\n<p>root: url的最后一段，如/myBlog/</p>\n<p>更改保存之后，hexo clean; hexo g; hexo d</p>\n<h2 id=\"git在推送的时候很容易出现网络错误\"><a class=\"markdownIt-Anchor\" href=\"#git在推送的时候很容易出现网络错误\"></a> git在推送的时候很容易出现网络错误</h2>\n<p>参考博客</p>\n<p><a href=\"https://juejin.cn/post/6844904193170341896\">https://juejin.cn/post/6844904193170341896</a></p>\n<p>刷新dns管理员cmd下运行 ipconfig /flushdns</p>\n<p>但是这个方法不是很管用</p>\n<h3 id=\"更好的方法\"><a class=\"markdownIt-Anchor\" href=\"#更好的方法\"></a> 更好的方法</h3>\n<p>可以不用代理，将hexo _config.yml里的git地址由<code>https://github.com/xxx</code>修改为ssh <code>git@github.com:xxx/xxx</code>也可以</p>\n<h2 id=\"将github-page-设置为谷歌可搜索\"><a class=\"markdownIt-Anchor\" href=\"#将github-page-设置为谷歌可搜索\"></a> 将github page 设置为谷歌可搜索</h2>\n<p>参考博客</p>\n<p><a href=\"https://mizeri.github.io/2021/04/18/hexo-sitemap-google/\">https://mizeri.github.io/2021/04/18/hexo-sitemap-google/</a></p>\n<h2 id=\"绑定自己的域名\"><a class=\"markdownIt-Anchor\" href=\"#绑定自己的域名\"></a> 绑定自己的域名</h2>\n<ol>\n<li>用freenom申请一个免费的域名，<a href=\"http://xn--yexiang-i22m.ml\">如yexiang.ml</a></li>\n<li>用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程</li>\n</ol>\n"},{"title":"Config Vim","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2022-01-20T02:24:34.000Z","password":null,"summary":null,"description":"vim的配置，包括markdown, vimtex的支持等","_content":"\n# 安装anaconda\n本来安装anaconda应该问题不大，但是却发现了一个问题。\n`./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error`\n这个错，是因为直用./Anaconda.sh启动安装默认用的是sh\n改成了bash Anaconda.sh就不会报错了.\n\n# 一些碎的Linux知识\n\n## 查找包的安装位置\n一些软件用apt install了，但是不知道安装位置在哪里\n`dpkg -L xxx`显示包的安装位置．\n\n## 编译错误定位\n编译的时候,打印一些log但是并不详细\n一般会有更加详细的编译log文件，在里面可以更精确的定位错误发生的原因．\n\n## linux 的环境变量可能是两个\n`LIBRARY_PATH`编译的时候用到的库的搜索路径\n`LD_LIBRARY_PATH`程序加载时库的搜索路径\n\n## 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到\nokular: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n用strip处理完之后解决\nsudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n# 编译vim\napt安装的vim不能随意的控制vim的特性，比如在latex反向搜索的时候需要的+clietservice。\napt-cache search libc-dev\nln -s libXtst.so.6 libXtst.so\n综合两篇博客。\nhttps://www.jianshu.com/p/aa5ea81bbc72\nhttps://toutiao.io/posts/runvgs/preview\n尽量多的保留特性，最终得到的config 命令是\n\n```python\n./configure --with-features=huge \\\n    --enable-multibyte \\\n    --enable-rubyinterp=yes \\\n    --enable-python3interp=yes \\\n    --enable-perlinterp=yes \\\n    --enable-cscope \\\n    --enable-fontset \\\n    --enable-largefile \\\n    --enable-fail-if-missing \\\n    --prefix=/path-to-install\n```\n\n`--enable-fail-if-missing` 用于显示错误信息。\n\n## 有点搞笑的是编译了很久没有成功，最后apt安装解决了\n\n编译的时候feature 用了hug，但是还是没有增加+clientserver。\n我估计是缺少库。查src/auto/cofig.log也没有发现很相关的信息。\n最后`sudo apt-get install vim-gtk`成功安装了+clientserver的vim。\n\n","source":"_posts/Config-Vim.md","raw":"---\ntitle: Config Vim\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2022-01-20 10:24:34\npassword:\nsummary:\ndescription:  vim的配置，包括markdown, vimtex的支持等\ncategories:\n- Little Things\ntags:\n- vim\n- markdown\n- vimtex\n---\n\n# 安装anaconda\n本来安装anaconda应该问题不大，但是却发现了一个问题。\n`./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error`\n这个错，是因为直用./Anaconda.sh启动安装默认用的是sh\n改成了bash Anaconda.sh就不会报错了.\n\n# 一些碎的Linux知识\n\n## 查找包的安装位置\n一些软件用apt install了，但是不知道安装位置在哪里\n`dpkg -L xxx`显示包的安装位置．\n\n## 编译错误定位\n编译的时候,打印一些log但是并不详细\n一般会有更加详细的编译log文件，在里面可以更精确的定位错误发生的原因．\n\n## linux 的环境变量可能是两个\n`LIBRARY_PATH`编译的时候用到的库的搜索路径\n`LD_LIBRARY_PATH`程序加载时库的搜索路径\n\n## 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到\nokular: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n用strip处理完之后解决\nsudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n# 编译vim\napt安装的vim不能随意的控制vim的特性，比如在latex反向搜索的时候需要的+clietservice。\napt-cache search libc-dev\nln -s libXtst.so.6 libXtst.so\n综合两篇博客。\nhttps://www.jianshu.com/p/aa5ea81bbc72\nhttps://toutiao.io/posts/runvgs/preview\n尽量多的保留特性，最终得到的config 命令是\n\n```python\n./configure --with-features=huge \\\n    --enable-multibyte \\\n    --enable-rubyinterp=yes \\\n    --enable-python3interp=yes \\\n    --enable-perlinterp=yes \\\n    --enable-cscope \\\n    --enable-fontset \\\n    --enable-largefile \\\n    --enable-fail-if-missing \\\n    --prefix=/path-to-install\n```\n\n`--enable-fail-if-missing` 用于显示错误信息。\n\n## 有点搞笑的是编译了很久没有成功，最后apt安装解决了\n\n编译的时候feature 用了hug，但是还是没有增加+clientserver。\n我估计是缺少库。查src/auto/cofig.log也没有发现很相关的信息。\n最后`sudo apt-get install vim-gtk`成功安装了+clientserver的vim。\n\n","slug":"Config-Vim","published":1,"updated":"2022-03-16T08:52:14.738Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hv0008gqul493vbdhl","content":"<html><head></head><body><h1 id=\"安装anaconda\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#安装anaconda\"></a> 安装anaconda</h1>\n<p>本来安装anaconda应该问题不大，但是却发现了一个问题。\n<code>./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error</code>\n这个错，是因为直用./Anaconda.sh启动安装默认用的是sh\n改成了bash Anaconda.sh就不会报错了.</p>\n<h1 id=\"一些碎的linux知识\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#一些碎的linux知识\"></a> 一些碎的Linux知识</h1>\n<h2 id=\"查找包的安装位置\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#查找包的安装位置\"></a> 查找包的安装位置</h2>\n<p>一些软件用apt install了，但是不知道安装位置在哪里\n<code>dpkg -L xxx</code>显示包的安装位置．</p>\n<h2 id=\"编译错误定位\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#编译错误定位\"></a> 编译错误定位</h2>\n<p>编译的时候,打印一些log但是并不详细\n一般会有更加详细的编译log文件，在里面可以更精确的定位错误发生的原因．</p>\n<h2 id=\"linux-的环境变量可能是两个\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#linux-的环境变量可能是两个\"></a> linux 的环境变量可能是两个</h2>\n<p><code>LIBRARY_PATH</code>编译的时候用到的库的搜索路径\n<code>LD_LIBRARY_PATH</code>程序加载时库的搜索路径</p>\n<h2 id=\"遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"></a> 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到</h2>\n<p>okular: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n用strip处理完之后解决\nsudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5</p>\n<h1 id=\"编译vim\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#编译vim\"></a> 编译vim</h1>\n<p>apt安装的vim不能随意的控制vim的特性，比如在latex反向搜索的时候需要的+clietservice。\napt-cache search libc-dev\nln -s libXtst.so.6 <a href=\"http://libXtst.so\">libXtst.so</a>\n综合两篇博客。\n<a href=\"https://www.jianshu.com/p/aa5ea81bbc72\">https://www.jianshu.com/p/aa5ea81bbc72</a>\n<a href=\"https://toutiao.io/posts/runvgs/preview\">https://toutiao.io/posts/runvgs/preview</a>\n尽量多的保留特性，最终得到的config 命令是</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --<span class=\"keyword\">with</span>-features=huge \\</span><br><span class=\"line\">    --enable-multibyte \\</span><br><span class=\"line\">    --enable-rubyinterp=yes \\</span><br><span class=\"line\">    --enable-python3interp=yes \\</span><br><span class=\"line\">    --enable-perlinterp=yes \\</span><br><span class=\"line\">    --enable-cscope \\</span><br><span class=\"line\">    --enable-fontset \\</span><br><span class=\"line\">    --enable-largefile \\</span><br><span class=\"line\">    --enable-fail-<span class=\"keyword\">if</span>-missing \\</span><br><span class=\"line\">    --prefix=/path-to-install</span><br></pre></td></tr></tbody></table></figure>\n<p><code>--enable-fail-if-missing</code> 用于显示错误信息。</p>\n<h2 id=\"有点搞笑的是编译了很久没有成功最后apt安装解决了\"><span class=\"post-title-index\">3.1. </span><a class=\"markdownIt-Anchor\" href=\"#有点搞笑的是编译了很久没有成功最后apt安装解决了\"></a> 有点搞笑的是编译了很久没有成功，最后apt安装解决了</h2>\n<p>编译的时候feature 用了hug，但是还是没有增加+clientserver。\n我估计是缺少库。查src/auto/cofig.log也没有发现很相关的信息。\n最后<code>sudo apt-get install vim-gtk</code>成功安装了+clientserver的vim。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"安装anaconda\"><a class=\"markdownIt-Anchor\" href=\"#安装anaconda\"></a> 安装anaconda</h1>\n<p>本来安装anaconda应该问题不大，但是却发现了一个问题。\n<code>./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error</code>\n这个错，是因为直用./Anaconda.sh启动安装默认用的是sh\n改成了bash Anaconda.sh就不会报错了.</p>\n<h1 id=\"一些碎的linux知识\"><a class=\"markdownIt-Anchor\" href=\"#一些碎的linux知识\"></a> 一些碎的Linux知识</h1>\n<h2 id=\"查找包的安装位置\"><a class=\"markdownIt-Anchor\" href=\"#查找包的安装位置\"></a> 查找包的安装位置</h2>\n<p>一些软件用apt install了，但是不知道安装位置在哪里\n<code>dpkg -L xxx</code>显示包的安装位置．</p>\n<h2 id=\"编译错误定位\"><a class=\"markdownIt-Anchor\" href=\"#编译错误定位\"></a> 编译错误定位</h2>\n<p>编译的时候,打印一些log但是并不详细\n一般会有更加详细的编译log文件，在里面可以更精确的定位错误发生的原因．</p>\n<h2 id=\"linux-的环境变量可能是两个\"><a class=\"markdownIt-Anchor\" href=\"#linux-的环境变量可能是两个\"></a> linux 的环境变量可能是两个</h2>\n<p><code>LIBRARY_PATH</code>编译的时候用到的库的搜索路径\n<code>LD_LIBRARY_PATH</code>程序加载时库的搜索路径</p>\n<h2 id=\"遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"><a class=\"markdownIt-Anchor\" href=\"#遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"></a> 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到</h2>\n<p>okular: error while loading shared libraries: libQt5Core.so.5: cannot open shared object file: No such file or directory\n用strip处理完之后解决\nsudo strip --remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5</p>\n<h1 id=\"编译vim\"><a class=\"markdownIt-Anchor\" href=\"#编译vim\"></a> 编译vim</h1>\n<p>apt安装的vim不能随意的控制vim的特性，比如在latex反向搜索的时候需要的+clietservice。\napt-cache search libc-dev\nln -s libXtst.so.6 <a href=\"http://libXtst.so\">libXtst.so</a>\n综合两篇博客。\n<a href=\"https://www.jianshu.com/p/aa5ea81bbc72\">https://www.jianshu.com/p/aa5ea81bbc72</a>\n<a href=\"https://toutiao.io/posts/runvgs/preview\">https://toutiao.io/posts/runvgs/preview</a>\n尽量多的保留特性，最终得到的config 命令是</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --<span class=\"keyword\">with</span>-features=huge \\</span><br><span class=\"line\">    --enable-multibyte \\</span><br><span class=\"line\">    --enable-rubyinterp=yes \\</span><br><span class=\"line\">    --enable-python3interp=yes \\</span><br><span class=\"line\">    --enable-perlinterp=yes \\</span><br><span class=\"line\">    --enable-cscope \\</span><br><span class=\"line\">    --enable-fontset \\</span><br><span class=\"line\">    --enable-largefile \\</span><br><span class=\"line\">    --enable-fail-<span class=\"keyword\">if</span>-missing \\</span><br><span class=\"line\">    --prefix=/path-to-install</span><br></pre></td></tr></table></figure>\n<p><code>--enable-fail-if-missing</code> 用于显示错误信息。</p>\n<h2 id=\"有点搞笑的是编译了很久没有成功最后apt安装解决了\"><a class=\"markdownIt-Anchor\" href=\"#有点搞笑的是编译了很久没有成功最后apt安装解决了\"></a> 有点搞笑的是编译了很久没有成功，最后apt安装解决了</h2>\n<p>编译的时候feature 用了hug，但是还是没有增加+clientserver。\n我估计是缺少库。查src/auto/cofig.log也没有发现很相关的信息。\n最后<code>sudo apt-get install vim-gtk</code>成功安装了+clientserver的vim。</p>\n"},{"title":"Experiments","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-17T02:00:56.000Z","password":null,"summary":null,"description":"发现统计规律，记录一些自己diy的实验。","_content":"\n\n\n# Deep Learning\n\n## Feature Map Multiplication\n\n### dataset: Caltech101\n\n[source code](https://github.com/xyegithub/Featrue-map-multiplication)\n\n3号服务器\n\n/media/new_2t/yexiang/image_classification/multiply/from_#1/ffmnst/Caltech101\n\n#### bn，sig\n\n| 配置                                                         | accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                     | 87.62    |\n| `out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))`     | 78.23    |\n| `out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))` | 78.69    |\n| `(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) ` | 78.57    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))    ` | 82.26    |\n| `self.bn_s.bias.data[:]=1`  <br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) ` | 84.10    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>` out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))             ` | 84.85    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 81.57    |\n\n1. 从这个结果看出shortcut的均值为1，会使得优化更好\n2. Res分支的sigmoid不需要加0.5或者1，性能提高了。乘以sigmoid本身有恒等的特性。sigmoid分支输出都为0时，sigmoid输入都是0.5。\n3. 在Res分支的sigmoid之前，先对out进行bn归一化，会优化的更好，而且让归一化的均值为0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的bn限制了表达能力。\n\n#### sig, bn\n\n| 配置                                                         | accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                     | 87.62    |\n| `out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)`     | 83.93    |\n| `out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)` | 85.54    |\n| `(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) ` | 85.14    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)    ` | 85.43    |\n| `self.bn_s.bias.data[:]=1`  <br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) ` | 87.44    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>` out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)             ` | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.91    |\n\n**sig, bn比bn, sig的效果好。原因可能是，sig本来就有梯度的问题，然而，shortcut分支没有需要优化的参数，所以把sigmoid放在shortcut分支更好？**\n\n#### bn, bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out)* self.bn_s(self.shortcut(x))`            | 77.13    |\n| `self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x)) ` | 75.75    |\n| `self.bn.bias.data[:] = 1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 79.55    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.39    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.05    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 80.24    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.22    |\n\n均值为1的话，一般来说还是会获益。但是bn的效果不是很好。\n\n#### sig, sig\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * out.sigmoid())`        | 79.44    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)` | 70.05    |\n| `out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())` | 76.61    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)`   | 72.64    |\n| `out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())`   | 71.77    |\n\n没有加bn，sigmoid会过饱和，效果不是很好。一边加bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 86.69    |\n| `out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()` | 79.90    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()` | 76.32    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 83.99    |\n| `self.bn.bias.data[:]=0 `<br>` out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.52    |\n| `self.bn.bias.data[:]=0 `<br>`out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1) ` | 82.83    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 78.74    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()` | 73.39    |\n\n两边加bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| ` out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.41    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)` | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.52    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 82.49    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn.weight.data[:]=1`<br/>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 83.47    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 84.91    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())` | 86.92    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())` | 86.75    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)` | 84.79    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 81.91    |\n| `self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 80.93    |\n\n#### Resdual 分支内部使用乘法\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1)` | 86.06    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1).sigmoid()` | 87.33    |\n| `out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()` | 85.71    |\n| `out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()` | 87.85    |\n| `self.bn2.bias.data[:]=0`<br>`out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()` | 86.64    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()` | 81.51    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.sigmoid())`<br/>`out *= self.adap(out_1).sigmoid()` | 82.66    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out = self.conv2(out_1).sigmoid()`<br>`out = self.adap(out_1) * out` | 84.22    |\n|                                                              |          |\n\n#### 借鉴NAM\n\n1. 用了sigmoid乘以原矩阵\n2. sigmoid之前用了bn\n3. 还在每个通道上乘以了和为1的数\n\n\n$$\n\\begin{align}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{align}\n$$\n\n| 配置                                 | Accuracy |\n| ------------------------------------ | -------- |\n| `out = self.nam(x) + self.bn_s(out)` | 86.41    |\n\n","source":"_posts/Experiments.md","raw":"---\ntitle: Experiments\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-17 10:00:56\npassword:\nsummary:\ndescription: 发现统计规律，记录一些自己diy的实验。\ncategories:\n- Experiments\ntags:\n- Personal Thought\n- Experiments\n- private\n---\n\n\n\n# Deep Learning\n\n## Feature Map Multiplication\n\n### dataset: Caltech101\n\n[source code](https://github.com/xyegithub/Featrue-map-multiplication)\n\n3号服务器\n\n/media/new_2t/yexiang/image_classification/multiply/from_#1/ffmnst/Caltech101\n\n#### bn，sig\n\n| 配置                                                         | accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                     | 87.62    |\n| `out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))`     | 78.23    |\n| `out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))` | 78.69    |\n| `(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) ` | 78.57    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))    ` | 82.26    |\n| `self.bn_s.bias.data[:]=1`  <br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) ` | 84.10    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>` out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))             ` | 84.85    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 81.57    |\n\n1. 从这个结果看出shortcut的均值为1，会使得优化更好\n2. Res分支的sigmoid不需要加0.5或者1，性能提高了。乘以sigmoid本身有恒等的特性。sigmoid分支输出都为0时，sigmoid输入都是0.5。\n3. 在Res分支的sigmoid之前，先对out进行bn归一化，会优化的更好，而且让归一化的均值为0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的bn限制了表达能力。\n\n#### sig, bn\n\n| 配置                                                         | accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                     | 87.62    |\n| `out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)`     | 83.93    |\n| `out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)` | 85.54    |\n| `(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) ` | 85.14    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)    ` | 85.43    |\n| `self.bn_s.bias.data[:]=1`  <br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) ` | 87.44    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>` out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)             ` | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.91    |\n\n**sig, bn比bn, sig的效果好。原因可能是，sig本来就有梯度的问题，然而，shortcut分支没有需要优化的参数，所以把sigmoid放在shortcut分支更好？**\n\n#### bn, bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = self.bn(out)* self.bn_s(self.shortcut(x))`            | 77.13    |\n| `self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x)) ` | 75.75    |\n| `self.bn.bias.data[:] = 1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 79.55    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.39    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.05    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 80.24    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.22    |\n\n均值为1的话，一般来说还是会获益。但是bn的效果不是很好。\n\n#### sig, sig\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * out.sigmoid())`        | 79.44    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)` | 70.05    |\n| `out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())` | 76.61    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)`   | 72.64    |\n| `out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())`   | 71.77    |\n\n没有加bn，sigmoid会过饱和，效果不是很好。一边加bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 86.69    |\n| `out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()` | 79.90    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()` | 76.32    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 83.99    |\n| `self.bn.bias.data[:]=0 `<br>` out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.52    |\n| `self.bn.bias.data[:]=0 `<br>`out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1) ` | 82.83    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()` | 78.74    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()` | 73.39    |\n\n两边加bn\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| ` out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.41    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)` | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 86.52    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 82.49    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn.weight.data[:]=1`<br/>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 83.47    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 84.91    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())` | 86.92    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())` | 86.75    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)` | 84.79    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 81.91    |\n| `self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 80.93    |\n\n#### Resdual 分支内部使用乘法\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1)` | 86.06    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1).sigmoid()` | 87.33    |\n| `out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()` | 85.71    |\n| `out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()` | 87.85    |\n| `self.bn2.bias.data[:]=0`<br>`out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()` | 86.64    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()` | 81.51    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.sigmoid())`<br/>`out *= self.adap(out_1).sigmoid()` | 82.66    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out = self.conv2(out_1).sigmoid()`<br>`out = self.adap(out_1) * out` | 84.22    |\n|                                                              |          |\n\n#### 借鉴NAM\n\n1. 用了sigmoid乘以原矩阵\n2. sigmoid之前用了bn\n3. 还在每个通道上乘以了和为1的数\n\n\n$$\n\\begin{align}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{align}\n$$\n\n| 配置                                 | Accuracy |\n| ------------------------------------ | -------- |\n| `out = self.nam(x) + self.bn_s(out)` | 86.41    |\n\n","slug":"Experiments","published":1,"updated":"2022-03-16T08:52:14.746Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hw0009gqulc4uv70a4","content":"<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"78a7d43e9b4c1e75f502d85631112d3edbd9042614947dc131f2fc69fee945c8\">66852511a631ad87fd1101c971fa7f213c692e7d123cbcb307d59697d2f247f74c8510b10e447ea1d6daedc6fc12b2ef470f29f5667e64b261580bbb685ec915ef4413ce46132f44bd5bf6de42f43081e58d40e21d0f2b6b4a08fb1497f5a54211db7a4265b1ed973aa660a650b1af067c767503f54917f88afeb9c0731960413963a96eea367ea6bcc7fe792c3656668954c20b543e50843dc43887f48f4376a0bce20d12fb10a470af387ecc92e1a16e37be2fd231372b7c0a10cd5312e0a299ccc04e7d052b310b9623cd920e94f8753b0debc7142b45400a1d0f8273d88d5d9330ed946ac7aca1f913e15a108eacb72df8cfc70e7e87b93eba765e47f4b1ffeeb7625c62bfba887b4d6b67f525314295ea1fe3529256b05a9502eb70059b95b6f186a00af31a44cbbde1d470703764ee1ee0d05977f4fb06e55503847f71052c15753227c7cf0c1edc799a42b0af7c55962a15fa1a23f94bdbc8e5aa9226d3cc11c3fa9b229614375ac13e32cf760b4448679c2b6168a3d614fc55a3a6e5d44f620893a3efc8e192d9cdb0737c79f31ed7e33b44fdf1804feac8dec862409b7e7ddb33482a312a9a90cdb757cdedb8a039edbb610e75cf4771416232454a0dab8bd009d5e1b02a5751cf8cc6eb019ca86568a3d88d10c415f0beadaec48b68693c5a6361f6bc3f12445f651a4939f277c9b058dfeacdff3a6ca6bc661586f7a1a5e0478fb8701cd21f741b58d322ff02848ae074b178646829295e35373835b3591855b611cc70c8ff4e257e2c636842efb54b0df7075297f94a423d88f1d9e10ce1a24b7dc83db6b94d0bb372c44985f20ac6533bd2b1ee7043ebb7731af89a54de6916be4d034f974cbe5aa523f6125f3b36546176f713a6c6fee27a149b3436969f56b5397e3405ea238fc3ea51acf7edb4b04ebe109201e0027bda1acea2b18405c09ce564a616e947ef310ada82f2d1d7a06ded9bd7cec5a1c1d5735ebf86cf49c0f94901dfe4a151a60479a5a8972503674c5ac536442bcb52c4a3dc7147e412a542c00a7f327d096a172b159d9fbf463475e0beec015593c78800bc0de02d5e0ad0f598a09696eb3c8b6e84ff43b965e2a4769b7a1d2708789e105f304719f50458308e4efa1c8f9ee387288a33dff9a0f7f6d12c1e7096d8cf5c1873fa5cd82d8a0bbd44ec3287f9f209571151f350b43b5489f04d0456e69a8352a63029d6d37a45bc9ebadcbed3b2b1bb2974bb17693c825a3fd3733ba8f91cab9e0c156b26e5750e9ce067901a724562b34c0ede4d8ef66478e507b4cffb78d6f59f01a310d5ea77c40727e804f00f25ea817fd060942fdd8c9f493cf0dc1bfa27c5993e32d955a070d55364bf5a6a9c2126911fac095d35c138610e0e3845a3811cb2119858ae0e1fc27942f6cbae0868126b3bd92f324fa062a4f74975eedd8bdf96525c9f7335353efbd7a94a8e2231fe06be75e338026311cd60e249cbb9a3116f3aa209c1edecfd72a9d9e7fa3ba8c54d0c6a14ce3b5433237103197c7d79e172e7640661a6514dabacb45c94658fd7941749a538e997fd9e99a256f7df01e46287a9512d18e9cee8e6ae29d1862648e914fa15798e6bdd12e118c1e8073371b55ff15c01e640dba24ba2fba01dbb2e003bf4f46308e2ab317b35069a01c6f1db735b964d4f8cc578e69cb20e250b39665ee6c7d98fd22b2822ec3213dc8006bc3dcc70335eac110b609a8f85d2307d862c10f63e6b056ff99cdb3a5da39c5552e20844bef19cdba32f5129dea0a9f4e733a49a2ae9070668ce3a29a586d1727dff3edb0546bf2c5ec8196a459a05d88e5aee43973ed01ff3fc9b926d270deca6c09e8d2fef91c7254fdb0c09c84f75736c4b71d6ab5f85f38bf900e6a2982cbff77af4d8677c945908547425e81ad57150275acf32769f1df3c66eb84ff07120117f34d5698946445179e16975139883e951621f49a45e4670f4b3f1e19ef922259e0cba238f149c31fd4fede403cf686bc0c5fd4d744c178c2811ac0ae3ceb32a73514dfb91496a37bf6e13fa1f1ec2f059bd1bc3cdb676134c6c5425721ef66d2c7e9ba4cfb2ab3b681ae4c1be656886b70bc14e99153f7e59b5d36affbec0a0c222d0545ab898a12175f9f73c91b5f643cf87dc3fae138d00e8d32f55025e55b83cc4e4efcde714fe27920cf2b632a355bfc3ca76e2765da45a8eeca770f0abc9fe14c66c6ad0c537b2a1c34a194eccdc6776cc866708808eaa4ba08179e61c948f128416a41eb90a131905f676cf0ea658044559a27a6a918c9881b490879af7d51a0362c40ff1868347f5ca9a6d56bac3a33801c2927bf7dffecd211902a8a114a428820bf96e37daf82fd1da5a46249525bc601af2da2558fa546181c71435cb6f42ea9127f179eba56bdc30a3d6fa1fd8710d40bfb519afd02d15ce7d1b9c30780f331a01772788328578298e7216ebdafad2bb62b8183f6d0aff16fe991c87bbe9d0d02c9107377eb441b92bc3a91fb062feafd99b546cd9678f055fca34fb96f986e25f8028a6a9717586d140d572fc95128b9baca935ef6a7ff21342a7d9cd65c15b53abd6cac4a7b031c8484fb01bde78816cc522a7f3df0118431f154950701bc7a7cff4d5043b74bc6442148b08a135d575e9a941b2544a061d3d62b0451d818ce261bd5fa82316738d8af76ab36d3d91f4f47bf3ecf2b4d74f1db08ca53653e794a6260879b88deb20c7dfeca9bf57673d160083ad39f49d383b08fb9aa466df6644d37bc8f47d7bf1932fd755a7a71d33d1f134469e7c60835b65856ad4ca3ee5071930022a22a89cde844f7cd0f6e3e2bf1b4c733e956fc4ebdf578cbd3aae2fe8b3f081d561b1b74883fdd0b36e957267c7c4b30cb1893e255752a9c859c5a6da0f865a0e830e324a262fd6b095c2f58eb4b7fd9fe5d9ca4379809527c6d6e5d70ee807c0ae6287620039211f63d34dc1ef3083c20db786fd112779279858e5c5c780e9dfac4dda5663c26363c74dbd2c82d86b5eb6aa96fdf49746bad746621bc8b9a948bf986c609d7154b872a0d1341e2a435e0b98fe12c9c4e7898dc0acf5f128f901534f586cdf7f7a89db4ccd3db2e5b6b4a22dbd2586f57058eb9029307a5faefcce3b7e6e85cf77504266697a9a201be598993d3b8a7f58a4b41e10480e789ce23bcc8e2c80fc9f70d9324aea4951c022a8b04c25f2d2b573e348813ab06fb4d279e0468014adc6416814b911ececda35eee97f2141b51ebb57be31febfc605c6b9741b53adbe512d8c4ca1b4ff61c7542d4dc0ddc8b311ab71bb1bf901220ccb9ca56bc6aa7af26d1d1f10ca60c5412a82704a9d05f56ffe8b3f0ee6401a207a884077237adef0ae7281243214a147e2e8644341379584926e40927140534da36fe12225fab4e83962a641cceecfb55aff8339adb790ca5aa53fb127e23be7f1ea32e52bcca2a3d0854152d4b891cb20491468030f8e0ee643ca42c3949f509a6fe4a05e62f85804c5c23ee24a3c07a89158d43ef1c59a731bdd32001754444beff196f4867c0419c9e0796e5cadda49570082edd61e01f4b4f1dd7a4c07c3a41bbe1270faa0875cd309f3c36027f317a9739de92c5c2b873dd3bb1b1888facc769a38be65716ee5dc006dafc1c4d35aa5bade97f13fd051b9f311b04636a198796a1ec40fb6a41e647c9031743ff904ef8caf5e2df4360aef8eb297c6621821471891d514a8e9ba432fbc134a6ca3738dba3b84d88040fd66488d62934bca280886f1070064c8ecf9fc838ebf0e264d73c9dc273e2f9f5ac83b248c4fbe72a869c8ba955b72eec63e8f577ff6f06a0b6ac432fced67a85aa25adc573376ba063a6bb516ea136efebe25614446264797fabd17c6be160506d763a45347421e8e8232cef7fb16a5931e29b17c55bdea664eb524751992e6d6303cd65ba90a4415493d86253a4329221a5afa7f92ad5da1275e70baa8209d2a09f7414d9cde2118c98d273f396fe5fb5d05e17e7419b43ff3f4c752a2467b2cd7579e76d3cb252600d01a1d334a9aa97be07aab0506b1526ce0b1ca37e0da7174c38ca8f072f544ab389aa9e8977135148a2a72329b17981916d23e082272a697ac0f184f5e0ed1b8be887a8169ab39cef827541f1e3dce3996f60f1a41b8e10f80a49fc8d65458d4a62eecd946120970b5b10201f3493d7e4ff4561b6f59f3ff79b74d0ab88c69ba03c9f8003c23c60d36347b55d094aaf372ab2719f349d18cf04586d333fada0b24cfa4259026b4f009ac1206ddc89bc4261556487636104bd67f39e0dd98dfd6bb17993a53ac07caf43321d5a12a31978503fef90a41e4faa7c6b26a12994654243e53c7fd5384d23a9e2b0f457697937e6e3aac5b9098fbf71c3d25e42717db6ff117e1ac92e7dff2dfe9c9ec000b7e245148c7aafe2831543413164791655dda492c8488bf3c5f198cc21e36a14754aa3e811a8f32d21215ed8f58b617fcd76340b9770ecd2536c3861884faddddeb6e4575693109013ad71639c035479e198ba383ab10ca0fe5c54e01cb2aca78b76a68fd214418351e290ee5116d4dd824d39c74f1e998c460ecb68de1cc0b931e05bd7057b65d5502493d4d0e5f2aba68122cd6b46edea8d6664b4577c5cb176c4f694903f5f37e802eb1c69f2850533bd9399c57df552cb04fef0698a28906845178c0a6e6860b3dc528d9e7b216a42cb513b89fe66161813b294c40c524a5ee3e806ebf44f8f01919c84afa9aae521a5c80e71b6338f6d0f85173c89bf39f34426647d77a9ca35cb3847805c83dfd36d421ee68c78128d00bdf1c52170161e6f8f755e7f526432d8d6799d202612e8f8b5de0e90fcb07a5a425cc0799b4b1485ae5804d1114420e075d02e27dc21447c27bb8e74155bb9c52733d8ad2519483b0d4f7d20352a3b4bf5840fbbfab69abb3cefb104f07374e5972fcba8d137693d360a834e2cff0c42a377e8db5a1148f243431b2953951f31afb7ebc121192ecfdfd5bb0646e52746f207dc59ce8e1b7e042f472674aa7c94dad2485f99ed3f13c71a1bfbe085b1386c38b1c9eb493664fb99af6c9948a8c7fecfda59faf54a17f26cb099684baafbcb14317e650ef07481423ec7c4b72326fa727dbdc69142373e696c9b675faaf041a4615d02597776d3b452a87406d3d8ca8874c675f9f0a4ffa89ef4c8abb414991acc95764fb3abf8e3e830d5556ced37a6bf9d5302f0a75c6a15bd20c947c74e7813ec074b2f8d3a96c2aea7b690553d3ebbdf2e57f8d7ef33065c9f7ff53c21097fcdc767b345c087a60175300f3e0826e0c1ee122aea758d77617bc9793a7457f8de16d1a7a7872f9322978c2187fadd41b4824d0fcf307f4a26b9e7c51bdbab0314489f5e451f28ab42e283d53c75b6c438e45643289e3f50fba1132e1ee2c0cb2e907ef83efa30baefa9dc8922c74bafb054a5953003b08eb239a453222881a74d7b5134caf0c2bddd03470b8e958394a05d4a0e6156a981bc885562a6b840a111ca100a85c3a36735bf93c2a4f09e82c6140c822b4aeca17cbadf91804f88f51e42c2fad193a006c6178a9287585a72d3089f3155df70dda7894d04b3ded172788c579a56eae152600b59540cc634584e53f17574060cd291254d72acc5bd55508239f09856c69efb90f01ab17ef16cc618fc4f01b4f063352fc2776aace0b1073f3740e6a641d8a239c7e552fe7a3e1a0c4f20083bdfb45ae55a2f3f5c76e2bdec341c38e519f7afb2e1df4845375675777a73530601d7a69234dc781cdb1b48ae77ec992cad1f6763c61bbc496de0ea77b9d99469409dc44d448f0e2ccf2f9af602edd51ffeb06d8e4dc728580dc55ec2b0e0381a6c34c3ab2f5bad1c883fd847b1cf2152d47fea3fed5b7096508eb1dcd982530800f235594957376aa98b6290a58b00ba2bf21567026e14d67ffa8f6d15f557448d3153f5b18d651cd3391a942c0acc65c39cb2ce1d713e07fec3cb958a98f92efff4650570868166f026e017018eef87e2d532c75225952546bbae8e6aa1f796b9717a70bdc900c5a5be8854491e6f80dbcbc4ee2d6f5a7e4fd470fb2f136de09962d78c5ff832192a7be86deb05540dcf4316d65c94f93b9cc8baef03c8c96e68b0a88e86befe3655456b0ad0376316545b92c3210cdf433cde7316abf33df45d3e17a0e7459bf68627539ac411f6f932df2097507101a17496510462f2f8e112e90691f52bf1c0c45e3987c7389ed4228b3744b93c771a410759dfcb338ce729062fb2584b2708feafd64d4d0240beb2ab2a3d9a81c4bb45b6af2cba9eb91bef484b05e7f1e838a6580191b4c65c403856c2970679ff2558869047de4192e1f6961b24708f8c9927f0045f4548c729100317977872c9696bf4f9c97a910def5c9d421110d4702b84558539019d28597c5ccd3341f2ec99de297d1d311d9183830e5f25ded61791c5fb72eea35d3a3146c91452046f5e33884814b266429d8c0b1e8b39e7cd9ecc6d370d5b809e12a15ac36abaae15eb7966fd0b68fb2b92616c229dc52c2e0d64b597a3b69c87a636af508deb982f1c609e0e7126617f10181f163117b08ef817d813664943aac2bf71237bf2e687d26cef5fd7828abffbf18a318ffb45abb0924cb08ae82cc090c41fbb9f758e85e9dd40018368eb4ba71ae326e5332ab4771ba5c5d4354c56d397ef3b97a9c68626c87a254a46bf37d40a3767aba20101503502c688210d3942effe4c4ac303f939c508bc965ffc5e0a03763a14d52f3687154ea5b710f13c8f752981351afa4ac41068a8b1c47f1de33aa07a4259aed1fc42ede596e4c170ba55cb52a7c4854cf5618884600c04e56fb5166d2a5f87b3352ae96dba88679bf804d951155d1f036229965087dc7c75823d3c8413d67a0445793bd0bf72a1b3804433e1cb9bc73a153daf94f642274ee2a7261bf624f3f7f6a01e3d605f684c184038022d138d13e0d5ba84b0538bdac8e4d209dedc0b53e34b78da262d464ed6cca32737104d47f9357db9b1b5c9b9fee1f69d3fd3c2e2546ea8cea488d3a48f93ef9f6f93d55c302fea323a5b1f4f35caf5b076f1579888ff57d4f3293f154138684307c8177c49a67d936fdd2408c347f63cd1c576decb2f9ce495206d0341b2376f4998e70c544809546364b34e2f5c2536d915a94c683e67edcfb37af7c62a0cb5927a9c6e39bac4b839d7a2463b3a226f3751fca8ed425f7e35ef97b9d54cc5ae0b0d4f08f2b9a2540559e13c30c0ccf4b8b79b209b3dc24a32fec9745a4ed90fc86ee5b684be2bcf62477e5bc2572c6d10d9e0c334b3d7dcc1f71f6886e82825d89964c62c7f75de0ad55098f4c26a3bf57ed7375bd5b2719ccf42cea578f4101f54604a8f987f5f6ced9ccaa6a513cb94e3d3247617cdeaed0eedbd24c2965c4da2456a697a07bd6d00a86d06b14f14f78ff1cf44adfe2a3afb754eec387cab822c43e74c70998cf321147344cc7fffd39b858b4c4f73b3a9340600eb6d6d70248b61b9e39d6c0fe26ed05fb7b67bf88c132b49c4a67a2235582b6ede60c9e6aa0106130d4f5af6c59fe08039e32a0953f14dbbfc0f9961b62baeecf043a0dd0813106a85a9abdfbc34348339a3c22aec6796511d9a9a132d8cbd20b718265b7b12900a16718b2ff34b67b63581c66fdc0bc3e26a10b889e6f4c12ac58b95fae022713185cab2177c58ccd28a27775ca2263a238c0b807a49cb96150cef633a1b1742849819c23a8a3bc7c4f1a34929084bf501ccf9e56b95e9179880dcfd3da12d639fd596c2a04dab9cf96e4c3b516dc46911a5cd66196dee92a18372b76b7fe6299a1ca5a09e03ed059808391d5d97bfc4ef9235e20b5aea9f922be0acfa8a2a4453bd0fdb2a8c93bf6b41648d1d18af7aa04efea9ac2e11c0dc1fad4552c648848f26f013db67d16b357a9c6d4ba669944b2df9de3dcf63528965cac6223690208d9d564bb024df38421ea30389dce91ab71ef86c65bfbfa977f5a534b240f83aed7af2bdc088e5a76de4129a3f53ddeb22748c68dcf75688cb289da298235c9eb4300b78741e7aad3c0054c9251b4c6fca6d5717c6ec6378833d51659b57dc9716d3d526a42f8c0ca3fe90fed0de60454396df21e4cebfbd925b3a236deb1cdcdaef8f14ed23f9b6731bd1ca3b9f8cf7ff708c5200d314f1c170e19c4ae7cceff923869f2d3be59b377f6a60d5d52c114bbcbb307ffb6946392908b0432243cfcf914bad539c3f2d6402ddaaafe7f139a3d46a783fe4ddd5092330786e5e4f8db389e402408e65b5fcda61ad1708ce9242e8b982a357759af894455afcf2f06ec243ad0313d025dd3ac29d341ac639971803e19f71e706842b4fcf5bc9388a3831eefedbb579c162aebf7e54e4cd0937ca5602fb66d4f8eb230ef298b8265912f9f5012f30fc3a2caa5dcd7506dc4bae2af2dffdcdc84102a373c947eb7b970b7b3161967e6146601d420c2eff6263ca3eb865bfd86a0c877529402407d7330dc6d9bcad573fb23d9921c4b22f49175a8435e2dd9178876a9543b8ba7e0ff8ecf66eda72bb9daf603b1c9398ccafce29d7658c7246ca1d230911d94d776c832d91705c96d8e262b8ab3f78a5ee67537ca49bdfe34d0b6229fefa22579a8470b0ae62e798ec616fa4bf76bd0b71e1b6641cd32536f1ef2318877d3134965a07c53f64e7c96e59d001de7e67b6b56ffb91d655b6066e4c474aa4e0438452eda6e53dc140191e9dd66ea128236b0604d5c007edbde21cae51b94367d26797e58bb2bcd7512a245230a5805890c13825bdf79a81c19b941dbf586d5f13f58b001105643881583d0307fa7c4d1cc0d48e42406819467f4e46ace1b090cc8c99f5da85833f343edbf1decda6c09947d202fadb2e6001a0c784663cee35f51558158833e94af970f6b8f0749860456c83f8a2841cc00cfe043540a391bf350a7323f016fa0692030235c952b7b3d2a51941a6179d54ad1c86993220166df7ddcc13d361db4844fbb751981a0df54e81ff13c25aa328b32ac953d07a3c2d2fc514e9128f62e2467fc56e98d39777ec7eb8fa5cd7721742c9a183e54a53abe9cf4af76e2c51dfc975a24c3b34745e890839cfdcb601a7abe8dd9966ff38c3e307991c2274b5146086b0f49327c628a0306439afd29ef8f1fc1521872ee17d715ae00e47d5a7ba4c27c595279981346137a2d901b241ddadadd01fec86a8458f234c0d1471519cd092ca87b1eae7c3aaead80d3555ecf3a55b1a64731a41c8a17e3aae30c1d76b94d38c97bd90e4cef23e0b1757dede420c1e3c535c72851041f3005596e17a7af77d9e6f78955ebccdf8f2b95e9f1b9ae1bb8e253bf4c5f7b4b668dfeb3b710cfd1caef7f54cc30b3b63cad2c85868d08c84a7a84ff7c95e7bf77bd89e02e2713d43168fe45115015ca184b3676ca83f66454e0003bb48928fe70451093d2ef9a44cb71745cb70f7a281b045f6bad89ed2026216c8aa0caf0ade3f411c0b092587beae677fe5401200e7cf63f9ea667f537373b3250cd9c6dc2113be31c1e60a676f4465b027914d18faeba12d02fd36441d55f6c007882fb2d80eead95b9e8e17173f36b54045ae708574f3fe77a5a124e6b8c1a3dff429dfaa840409c1ac3eb619bb13d3de278cc440938745f0d72710e5fad24283095a1d8b0c65f6535e83c82d29203382b6fe243c98a7625a3a9a9c5e98f542df2d3dacff0cb98257544946dd824a273ea5514d273043ed074a755ccb684d4011967489fa92f7469c7f22a6f6c0e0386574f9246a90e8a0890917392fa6301cfbc23db1565a562dca6aea232f8ebdf13b2fcd1f8d11a4e96cc31194f2cefe8496d6b53da56d497fc2a21e1eb208037569e54494fc8f5ede8350ae2916599ac78ee082492c155826414993c0466f4bf8e14d3c9079cbfa761c6b77d5ebf6a41b6901307820b2f2ba09bfac8f53c1022fb8f26bbcebf9a4321ce757fae05e65017dc7c5d244f355af5292d0a72d9c6dae6ba8417d30d8e32e22b5f2e662fd280d786d536b9b3e2c8a035fa29676bf0bb15a22c1284a40afbcdaf63c164ea3bd6ddda0a458e2a14b736cb5b165ccef1b8e2f271eace864adbc33aeba8e90426e4b52271bc2648651983e83c165488ccd6ca745e6bf5dedb6941c3a702e9858aa7bd67f9c122cd6606c465624f3d067a9a6596d5796fe97da897e05964c783fda6c3b55ec66298ee9b305b0f12660f3babdef3a621d56924bc21b0a538e15052b28a3b37ab3cb727836cab468d13142fbb3c5211b656925d80ec21f751cb2403f9c3195400fcb62a37e6c1ddcc777bf97c8a53ab496e0258f45df021a8033d0ba6a0ac4fdaa499e75bebf11c2a51bf07166a297986b645483e9edbac4ac4894e96c0d3469102408262d59e0c80279528719d397a58ce58868a948332fe84228ab57dfc03efa14883fffe365bae03c94c789ed1d86b3769d863e571382d905ec94013e085a142b128f3cdf4469705089c95e7c0f2fec1a51b5f354871f5bf9976d85c0f41cfc10a1fe166264c0001e97b34f5d9b9df24c8c8364a8b3e50e6e16dfb822332082e64a7218fb78b90722b7765258c3599f216dfb8ce47646cae5229473dbcf9e5b067d289f54e9cc6f7c60cde8dabe632a6d9ba03c699b3048b1fdb5ad28542259c95e53e77c64466bda248ff79bc0db3c54522e9db9b900d0ad29ffba127a173ad8206054b2674ece054c5a59c9d27459b025c1dfb7ee1d24367b0cf4c1e020da60d8adde4aea1417287ba7874b7a3cfdec3706b08b558baab6f41d92d3fa58d1dd213b31914c14ff9de1dbe5fc03d19283b49c4548b9d721b4a21e21263fbbff222c60e4f209bf240d1ab77e0c37c5de766ebf54128ecc59d7740b366e503b2a1ef978c7fa4e02ddc4d2d528e425544fe61061673ae35b25cda10563552cc572fef16d635bef92160ef925a13f1367cf6332c8f4dd1b482967c6ea84d736c5143b2d51c28f3b7b1e05163dc7111203526407bbe4875e8b0817f6423ee85dce264416bbcfb826a930778bbf610c5668b3083a89e7d6ac716eb3d4beef223bb3a34c626cfccc288f4ce9e9abeaf8c81f4ae0fcaf20daa0405670b78756f2e6881ee3b5ed174e6a5dd5a1ade92796aaffd78d4e770356ec189ddd9c61df62aa1a92a8a119185727dc76fe8f39ae73868686fe333dfdbe9cde42678c04a5044d64f4b5633ac67f06a69e3fdab9a7b38f55722351f3030d0479f625ccf34dec310b8b5a180e0066e4ab69aa691c09d5e2cd6b4eb455c834ee792fd6afd9066b9fe52a7ed961f61f03e7cb87858b41dc4238c859229ef9b5c4b8ae0e018f613bfcf8160bcabee85cc47d3de3fdeb3fc638a6e7e616a31d8f2d4d52c7e5c6bccea79abd8fb98d0ca4af723524b0a8963a539c0223f6ed0cda8d97e129463767b47940cae340f8f420d864c466b23ea237361420b05fe89437f2b4be1f5b846585682183a779ba3f8fc03d285360b68ee9060d3440fe37c8b2a5850f3b1da769969bc1c98a2c875c71c8063e39bcc92838865c49a58d7e0b5345db8805c3f917d791c0a8e75913137f5f523ec8ab5aefb3db817515be1c1bc45b82698b3efbaf24cfcefe026ef52f56c6bb2531dbe22b58b258d4e4e2e54832eb750687a113c00d7b08ed9862109572fea5a1c4dc294f80c1854d308d26646f3b1282c16013a2fccf745e9be0ec05ef6b144f9a3ad5dd0b3c9c4c24a3c8c0fe92f94cdcaac41eb189f2181d827daee5f81cb71e5947ca56d85194cf01b68310fff0bdd4efc40ea447228ef2f582033be8dffd902b274939f14fefeec33ccaa3a156274a0c902d32d4dd938a7114b705989e15766a953d372375dea0717cd227069117489980064748dd99e64cd105bffd8eb1b16752f2a873c8ffd331677a2006950612827647d53d440b6fd97fec017937cbf0966122314858b940e42dec76670596f6a3af08ee87e0353fa487e6afb0996ba254147b9522b4e81c38917f69e0a7ada5d3b10e6263ca5f6327df5fab1d61ed5ab43f355fe01b5424f4260865521145bab251e78fbe85c0b43ac04ea2e71e44fd4d7e5b7e149dded731626b5427982f258c1f92e460895190329b165afcc3e4582978e65d8f07d0553a896601f40cc4e01ca21ee1f61a2fbcf77e75998a7aa200a8fff1fd09cee8eda716eb44c0023e6f51821e840f8a70acd55f7783cbaf20d75a802e23518f4861255f950c218276f600337af8617e5cfe3efd308fab5a74c64c26d5cf195918b5c97e0284c9b354f960522aa52409c07a85a7f15746aaa29518e6b8f8ce5e2f5e1d78dd116bdafd212c9f7574dff8136fbc001915384714b702014f2df1566a7b33fd2d0241ec98da0a03a3a81b2661eef59b62c115f0247832ed311cd00a5c26ba1179f76e92bdc7b6c495e3715d5ab9c6ceb75a9cd496c34b4d88b4129c7ae7823e516e4236eac6d61a73a95b9ab7a0900fa2b5d585eb3e50151f51875c2300c39b83c1dc020d6537cddde65aafc005d6234f1db53de2d483754fc814c7f2474a1a45defc734946145de43270293c454922009d2d626f259e6e103da259b1ddb6fb1d15019d0b436e5a6a28f759defad3de58666482f02119d47b4e1f2ae16e81c737d3a2be34c2bc6ebb6c37b114fe8d8a6d094b457a71151f715d951654738191ad443912f1a381127e9bd2a84dda6c3f564bf6dd3c17fc018ce3a5210dab5a52fb83a7138b6f8bbd98d3b432ae308808fc8ccc196d05830f0a61f3c466dc8e701c11c98f791e20fb386ec18202f312fee8999cefa6a3cc40ae4fd907c60760a77c2f06fa97cf29c57950cd1fc3df9bb13926409e1779607d5933a22b55b979abf4dcf415b2ffe16a04f06bc5e83bba819d422f20601411ad0848e0c63dd946d4d9cc500245e81d3875629b5d25c8566b66790054329c79099ad4993fde6006b48de58f054881d4fdd42bbc21d613fd740797c74a8d36cf9070d358b7f3fb2f2a89f69fe4182c5bce994f1906ff689252601d29658fa4c7ce4ddfbc749cc53bc13ae0234bd31b69d361c513f565ba43c7acadb5788b6cb29895b54517812c972626199bf3ae1087ece5fde5657fafcf61a99c7baa22c3438bb2722cce390da21b3c295b6602e36ed4fd6b45b7df74619f64a4bd24d432662526fac1df0904336de20a0f7eb91d97ae64afee2bbccdac4f1e02505023627fa354146115c25df6f88d813456e1027c223f33ff452b66fc595926a2dbbed2f85a469ebb0024314e9996e61f09250a61ae92358793fa0b10bc789d950fb28e170703948982a094f400c523d8547a156748d08aa300de45c29b426dc49e478e00b9d2031eaa660c81040f2d25f9c34b3babd47a7d2f90397ed28acd0aab8bdffcb81146db16fd3d5b4087b25879c324a727229c79aa5ea332767512b621b34a3abee9be54c5d145e87243f5d8ae0b70847830f49f81f1a88966dc91b25c5a53b9ff981f542790aac0ed28465755519ce9def2964d28527de7af4726ac1a87acbeaf2e9d58124d2f7a03cd541918b1b5b10e95316c1f71f8e283ab5d7c3839325a7bd4013497b144ef328375259f3c5fd094e8f7ce2169ccec2ccf7dfe8f2d456cdd2a690ab03e9506926d31530dcd96ef970b95574ae549178db3e5438f8e2dc20c41dffc2913409ed4df9dd6e6bc922ed70eb5e5ce8c0e67f16eb430589af733aa9b28bb4d574b4338209f1ecf24b93862ac1aa3af138144b47e0b9fa4032d8e7a6cbd36f92f9fe467fc10955576a8040e45497d056b347a802140031591f76e51318e54487aece2dac57fb642d2f04953ae7020482afa0e542494e80a2cefcf727de1f831f26bb62c4c5e46de13ba45fbee0da6c4994edce9b4186ab27cd3bb231b1af71a55104a0a2c25f070d893fcf0070b2852296ad3540892c0c54da0dcfc3fe309830e641c27a72f4ff90a756294d804c8df4db964b05396b9af8e13906c3a623cd610309ac30a01dc0620f0e0c6893b308f356040430115ced54149dd3430022f674ff4aa89c4a2afddd5eb5fb4d95e0067f42523138af898ff719ca2a2fbaef06e0ce7d7d5c8f517f0b50758f43d37c44fedd0e3c985535a7df840fff96bbb8d44811eaad5713e645dccad18230dcd5c11f030f84209f040c0ddad1eeb7f85fadc1a8ad84001154d5fe1b234762de621b86210f01ac47176059621348b77fff41aee4370cee4c3dd737ca5841a4ed56f4edac77a8a01ac380317fceb0fe36d279c179f949b48e0fa25330aeb256e2329c729cc3bff5113a692e9f128fda11bf3312d9ab5edcd38cf73044dd37436b9e7d6d1561d9f4fe742962390ae9fdd2c2743b41cfe7fce425e51f9cf3534e8562054ffd787fa2417085daa4f7dcb10c92425babfaa967c5cb0f3808a0ad2055c159afb6649d7d2910459fcb774315374298a0feef914e2b4b7bc9908dfbde59a22689788472cefb94d8bfa142ffd1b6444926af18bfc1acc25919c0c34f045879609220dc6d6ebe051448a2c0553c5020b898c2dacb2d253418ce8de7f433f8d1ced9d2ef36a0764996c9e59823792c95b2dcb9851368f8623e6aa8f16008f7869f755b1773c53ceaa4868d5f9b8620bc5c3f9c33e87f7dbe5a97cbcdb1a4928eab6ccf0475c71340412941be5c1fa30127c51d063134af2fd8463e8efbc80b8e81b7e6d8199e511ffd3df03551a909bcb99b6d39d540659ed3e18ff995e314b68106cdffe0260944af33ae64b02f60cbb9f3cf17a5183009a374c4deb8fb5f2c25645f1b426496a174dbc3fd4c7c8355f71fe575aaef6a249296624c76c1cfe3e602b19eb71871c1318959bdd11df819911212d4e92b12c653e47c2a3e644fd4dc9c8da72208062cd175b1793ab8c5ad67f4b517d4d1e83796d06a83f35265b3cff9f5ea6d4363cb18ef5de3bcdf6c8ec0535a8c48fcb5d0d09c3a8cfddfc275b2fb3e3c40dde55aca34497116d1c854166d2b7d5207a70a8e7ae58c98c57e00be6a3e1f14c77a5986075266679ab8f76b96e68b7392a3e48a03debf9e2dda8f5161fecae3cee25c855a9929fd8ff5e434429a11cbf83191f8f213c387e9d48b9fa79e77ada17d8c9cda57f5f35ed798c3d12a6ec0c6d0074244ab47b44f05c42653756166a155a0a47aaae68b4c3cb8691c4d7c512d20f2b74ffeefcf316f881952f0fbfa48cbb5d615eabcf7b0bfa0594b20da30030c9b2e23a53e4c8b4267d63dd36854b2c732f6e33aa420c9247967cb7e635e265107d7d9a7bad7308d2dd47f1edcf8fee62d61c9aff045a43408f065045695ff474e802663d984bab0fe84bdb1be57b1345609ff4e381ffc30f2b74983bfa35821c83fe3c14a6de864d064e74a50726e9c1df9a1dea88cdd122eecf37b8945d50b728982e0d73a9473e9e799c927d07c0ce90040fdff7b89272f426b2bb86553077d7c6a8725aac303b04dd295beac5ae605adf9ddce4e90fe9fd48d2965ed9f2ab64ed38dcc4e51c6aabb19d8f3dea2c2aff97e31f50eb44a361248e651fd82657c609b67359cbaff55c75287554e40ea1b9eb19a2eb039124a2af3174c9fd47abac2ec0ac7b791a206a79eb6fc2fa3c3ff83e57bdeb1872831517f9c4120a16485f13fffd68ead18ffe67e36de60c849ff56559b2b3908e05e73e5601d96b65bfad43b84d25f6bbeebdfebb47938dd84f97a9abfb7409045b216ad778a9afebfcadd3b92f581eb142e1e71cba24d931f60f76d160b8a76a666fa54324932b4004681f5b99def010f2597da031fed154182c965409d6eb6b6fc23c1116448e4bab629a2d6d4faf6ac4ee0dced117258ea4f81ecb6bfc46d1d6ed9d71ba3fa4588e0b372292666feabff6568412dae113a6d1a2325606db08f551078ace25727ffa797575f371e7e625760dd772b0ede6c22ae9fb44d9d307df45575ba67c290ad6f2ac6b09517b2ce4bf0829cffdc3761a5b13c216054d0a8615dfd692fb2e2c26779cb7b116ae60eabb145580651286ead7f56c506b77e1986db8c9c76634d81ca29b4ac57d408bec9049a44fb9f7757c79bb3ef33dda96f368a5995c71f9e7ede3c8b228266c913204b2796a725cd31a3edbadf618aba1d5250ba039c411f9cd5edf2775558a3e535c8937dfd7272316d70d159130e51a57f85a6bc5b5101e65b67bc8433cf10c5b3fc60247c46304b05bfdde579500b968319261a7fa3bb45e40ea6e2a4c4dcc0050b4a8b747c78661477598340b79aa49e5add5f5d6ab546e0ef8873a85a17bcae4c06a60e8c3e10f15b8e6b3de101fad2525be968dd4afa92d3ce80426eb3853761be0a7df9c0e368340115c1eacc8c0ebb9b61eae5105acb4f48d3f7ff4a9aad440a11be9a68c193666f95008962909185b6664bf2dd7353c42947f08bdbe9cb37472dc5d8b827fe7e43ad4e89956176cf7a340d992fc812283f67e1138959ed45f45ec0b2f05e40481d851fb3e1747b15e459e3dc20ba693e42ccde01f449aa36272256f2ec4d48bf4ac4e655012ca7615239ff59d4f24357bb583b8fa7fd1dc6a5b2f36d459dc9b416473a0cd8eda644896fa9c2e73935f6f8da46f9723d5635849e053bf5f606878de45501eacb8de9940a1c93c0f0bbb3e39a0a2f4d56bc2db284805dde183e49ec9aa452c32e9adc30c147274e87fc00d673496a3aa877a4502b759b20b63298849993b8a7d2610125a4f142beb84909f8567b4492b2bc516b43169da89ce66cf2f7c31c07be7cd1abebe601f0392368bdf760c156339624634cfc7dce063faa23ebec6d27fee5cdd639426665e010e685186566976fdbb554059f5dedc085b5b48af59f331a6f4c51d5c18fc120000217b46ec8f1e9a635ee35bb95f49c0103472db2cd0395b16632aee42bea975065ace83837f86564da9dbfe0a082b2874ac71859802d4432aa9d09fee711a28b15a56068e5d8b035a1d54a8c606b06acd7d1685268df3613d4bdb94ab5b468516cda13c975ecbb87e5de04e66af8840c1ad67cdf9b0da60bc124a4d27c9bdd7d9ceb0e1b7ee11db3b8653a28242b52fba6dd8e5223fcdefa27cf850bcc178bd9b0efc0f48b9aa88b38fcce3cf4b6be992b6f12e7cbadbf14996754a0d50f6bc11b4aaa6e98888c1f5ff80967f5da4e3c340a6072fb741df56e9d6c7c47db86082cded19bb5b3c8f84a4c619a5f4714da9e94623defedc93dd97c04e283acaa68c8c2e002b5f3e5e0ed0c7d7864f1291e7923a0fa06474054eaf3392d0dfdea06ce306232fd0f6e5d4580ccb5034eba747f1b5ac45de758d5fdf2410b726f991dfa26babe1fe4ddb01a08be675afa6e804f72300fcd1795dd724778f33d2dd4c5c81379fa5387c5509b0fa277f2305510bb92df8d31e51b72f36480ab16fd465c71cf8491e6f13e5c34f79e1d240cc86a403fca1eaae9736698972b0c7387e8ab53a617c5b101ff13b3e710f72ad6eb9e4948a7f3a702e10ada016479bdf2a1baa1af61b73d3733f838b5319b080a0fd17728dc91996affd5327542d0d0a1e5fc57fd3714c9b1f4cf4705a310e664f375a2cd0291193e501a2ffa614c4427a0c94d0992d8d458af4bf931c73aae598ed6d5d93a74b487f5e91ea7ad4891bd953b422a18c5c60031213946ade2ba9aac00d2dd478fe73674a86fa830a1337a8e178b84f66d83494f4dd16826fffd0d101b43c6e897ab2e7bd0220fc56bb0ac379580fc77460082aed06858c3d96cc21257d36661c9e0c9c1066d4906be6b5911ca40572d15644c96841e275ba8d66a9794d3df618781ebcf1155db6a6bcb9e5b1dfdbcdaaedec82b9e5d5f40c9389bac1d4d83e906a1eec6fc291984624b1e0db24a740aa44717ad64f6b9baf7f0d2b00c8852d2ebe59b176bcce0b80547218584af62303140c42c45137b14959f0da554fab408ad4769da50807fad34e9d0ce2d2e1f5fc29bd97caaf81991b6f5c8368571f2f2bc062467b411e513f37f93c17583f914eeaa431b5623bae82ddf33ab8bfc7a524a184dc49d67d3f3efdc88571ac5f5bde9a82e0b491c69c3a0222d3f57ba188242d27b5a6b0aaa41f9ccfcc92da5bfaaef64965bb5248b9176d40b5faee0b65f8eb377fc926790b2cf6c992d11b0acbe13a197a2a6de5c55f55dec2969cc9be46b5ad285b1e61f8c9011e318565ea40a6ee3ca348d55e51135bb271f83521b80f79ba09e954bf76af6d166db8583b8d98ef332ce171fb4e584863ee44ec44a4bfbfe5f351d92cd6fa85ccd64fb9f5397a3b87beed4e7d46ebd67f99c2633af96400ea35e1ef31380cc27c9ca8c3cdc4baa31fc30112c472be3affef740eb004a4011c8c45f14dde30a2784611e77cd677bed98cf8f10f847a57508730d27f9a8a09280ea87545b3bfc8661aa3d096fdea4a8747b911c986f30e1da6bf6e01c668362a54c7496dc3a71c676a660301f59a0567bae3d0db890475d4a13f0b7a4db5e72e9af8137b20573a598724ad795232960d39f74c750d74f547ef7bdcdcfe5d78ecb8256838d5ae66eacc7d5bc903738b19607d2856747dec2cf997532512035c11d1d2cc350dd6737cfc409550e95f09d4517d595e71c94e2b8c0f31050540014f21515cb6551a2fa68fb0539ea4d182306a3fa36c6785b1209ddf24761c2eae12249</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">","site":{"data":{}},"excerpt":"这是一篇加密文章，需要密码才能继续阅读。","more":"这是一篇加密文章，需要密码才能继续阅读。","origin":"<html><head></head><body><h1 id=\"deep-learning\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#deep-learning\"></a> Deep Learning</h1>\n<h2 id=\"feature-map-multiplication\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#feature-map-multiplication\"></a> Feature Map Multiplication</h2>\n<h3 id=\"dataset-caltech101\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#dataset-caltech101\"></a> dataset: Caltech101</h3>\n<p><a href=\"https://github.com/xyegithub/Featrue-map-multiplication\">source code</a></p>\n<p>3号服务器</p>\n<p>/media/new_2t/yexiang/image_classification/multiply/from_#1/ffmnst/Caltech101</p>\n<h4 id=\"bnsig\"><span class=\"post-title-index\">1.1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#bnsig\"></a> bn，sig</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out) + self.shortcut(x)</code></td>\n<td>87.62</td>\n</tr>\n<tr>\n<td><code>out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))</code></td>\n<td>78.23</td>\n</tr>\n<tr>\n<td><code>out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))</code></td>\n<td>78.69</td>\n</tr>\n<tr>\n<td><code>(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>78.57</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))</code></td>\n<td>82.26</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code>  <br><code>out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>84.10</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>84.85</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))</code></td>\n<td>85.83</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))</code></td>\n<td>81.57</td>\n</tr>\n</tbody>\n</table>\n<ol>\n<li>从这个结果看出shortcut的均值为1，会使得优化更好</li>\n<li>Res分支的sigmoid不需要加0.5或者1，性能提高了。乘以sigmoid本身有恒等的特性。sigmoid分支输出都为0时，sigmoid输入都是0.5。</li>\n<li>在Res分支的sigmoid之前，先对out进行bn归一化，会优化的更好，而且让归一化的均值为0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的bn限制了表达能力。</li>\n</ol>\n<h4 id=\"sig-bn\"><span class=\"post-title-index\">1.1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#sig-bn\"></a> sig, bn</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out) + self.shortcut(x)</code></td>\n<td>87.62</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)</code></td>\n<td>83.93</td>\n</tr>\n<tr>\n<td><code>out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)</code></td>\n<td>85.54</td>\n</tr>\n<tr>\n<td><code>(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>85.14</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)</code></td>\n<td>85.43</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code>  <br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>87.44</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>84.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)</code></td>\n<td>84.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)</code></td>\n<td>84.91</td>\n</tr>\n</tbody>\n</table>\n<p><strong>sig, bn比bn, sig的效果好。原因可能是，sig本来就有梯度的问题，然而，shortcut分支没有需要优化的参数，所以把sigmoid放在shortcut分支更好？</strong></p>\n<h4 id=\"bn-bn\"><span class=\"post-title-index\">1.1.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#bn-bn\"></a> bn, bn</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>77.13</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>75.75</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:] = 1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>79.55</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.05</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>80.24</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.22</td>\n</tr>\n</tbody>\n</table>\n<p>均值为1的话，一般来说还是会获益。但是bn的效果不是很好。</p>\n<h4 id=\"sig-sig\"><span class=\"post-title-index\">1.1.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#sig-sig\"></a> sig, sig</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * out.sigmoid())</code></td>\n<td>79.44</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)</code></td>\n<td>70.05</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())</code></td>\n<td>76.61</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)</code></td>\n<td>72.64</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())</code></td>\n<td>71.77</td>\n</tr>\n</tbody>\n</table>\n<p>没有加bn，sigmoid会过饱和，效果不是很好。一边加bn</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.69</td>\n</tr>\n<tr>\n<td><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()</code></td>\n<td>79.90</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()</code></td>\n<td>76.32</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>83.99</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>86.52</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1)</code></td>\n<td>82.83</td>\n</tr>\n<tr>\n<td><code>self.bn.weight.data[:]=1</code><br><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>78.74</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()</code></td>\n<td>73.39</td>\n</tr>\n</tbody>\n</table>\n<p>两边加bn</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.23</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.41</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)</code></td>\n<td>85.83</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>86.23</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.52</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>82.49</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>83.47</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>84.91</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())</code></td>\n<td>86.92</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())</code></td>\n<td>86.75</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>84.79</td>\n</tr>\n<tr>\n<td><code>self.bn.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>81.91</td>\n</tr>\n<tr>\n<td><code>self.bn_s.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>80.93</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"resdual-分支内部使用乘法\"><span class=\"post-title-index\">1.1.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#resdual-分支内部使用乘法\"></a> Resdual 分支内部使用乘法</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out *= self.adap(out_1)</code></td>\n<td>86.06</td>\n</tr>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>87.33</td>\n</tr>\n<tr>\n<td><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1)</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>85.71</td>\n</tr>\n<tr>\n<td><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.relu())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>87.85</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1)</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>86.64</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.relu())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>81.51</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.sigmoid())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>82.66</td>\n</tr>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out = self.conv2(out_1).sigmoid()</code><br><code>out = self.adap(out_1) * out</code></td>\n<td>84.22</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"借鉴nam\"><span class=\"post-title-index\">1.1.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#借鉴nam\"></a> 借鉴NAM</h4>\n<ol>\n<li>用了sigmoid乘以原矩阵</li>\n<li>sigmoid之前用了bn</li>\n<li>还在每个通道上乘以了和为1的数</li>\n</ol>\n<p class=\"katex-block katex-error\" title=\"ParseError: KaTeX parse error: No such environment: align at position 7: \\begin{̲a̲l̲i̲g̲n̲}̲\natt &amp;= norm(x)…\">\\begin{align}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{align}\n</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.nam(x) + self.bn_s(out)</code></td>\n<td>86.41</td>\n</tr>\n</tbody>\n</table>\n</body></html>","encrypt":true},{"title":"First Step to Reinforcement Learning","date":"2021-12-03T08:48:41.000Z","description":"强化学习的入门介绍；什么是强化学习；深度强化学习算法：策略网络(Policy Network)和估值网络(Value Network)。","_content":"\n### 什么是强化学习，关于强化学习的几点疑问\n\n<font color=green size=3>强化学习三要素：环境状态，行动，奖励</font>\n\n<font color=green size=3>目标：尽量多的获得奖励</font>\n\n<font color=green size=3>本质：连续决策</font>\n\n基本的强化学习模型包括：\n\n- 环境状态的集合 S\n- 动作的集合 A\n- 状态之间的转换规则（是环境的一部分）\n- 规定转换后“即时奖励”的规则（是环境的一部分）\n- 描述主体（智能体）能够观察到什么的规则（是环境的一部分）\n- 能够做出决策/动作的主体（智能体）\n\n#### 区别于深度学习，强化学习的本质特点是什么？\n\n**两个定义**\n\n1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。\n\n2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。\n\n强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习。\n\n强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应用场景只管模型本身是不是满足深度学习的特点。\n\n而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。\n\n<font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强化学习的模型。</font>\n\n强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特点，估值网络的特点是修正和预测获益）\n\n由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化学习。\n\n#### 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？\n\n这个问题要了解下一节，具体的强化学习方法。\n\n#### 强化学习与弱监督学习？\n\n弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更多的信息。\n\n强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。\n\n所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的\n\n#### 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法\n\n深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是死的。\n\n有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它无法摆脱对绝对的标签的依赖，无法超越标签。\n\n而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的，拥有智能的算法。\n\n<font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境，强化有益行为</font>\n\n#### 关于深度学习，强化学习，连续可导性和离散不可导性的讨论\n\n1.  从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到 target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数。target 和 Action 都可以是离散的或者连续的。）\n\n2.  深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化的。因为包含和不包含是离散的，对 loss 不可导。\n\n不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。\n\n3.  强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决离散的问题。\n\n4.  下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次 Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终 reward 多少了，只有单步的 reward。\n\n限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这个问题，要靠强化学习。\n\n<font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自然的。</font>\n\n5.  多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。\n\n综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。\n\n强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。\n\n**<font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的大 reward 的行为。</font>**\n\n#### 深度学习优化和强化学习优化的感性理解\n\n前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学习优化方法和强化学习优化方法的感性理解。\n\n还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。\n\n然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下降算法无法优化它。\n\n强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一下。尝试的结果是哪种 reward 多，就增大哪种的概率。\n\n**<font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的 action 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的 reward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种 Action，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论。</font>**\n\n更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的 Action，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。\n\n强化学习方法算出的梯度是策略梯度。\n\n**<font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的 Action 优化它。</font>**\n\n**<font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font>**\n\n在不可导的地方加标签。\n\n**<font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font>**\n\n### 策略网络(Policy Network)和估值网络(Value Network)\n\nAlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。\n\n强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.\n\n深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主要分为策略网络和估值网络。\n\n强化学习中最重要的两类方法**Policy-based,Value-based**。第一种直接预测在某个环境下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动的期望价值，然后通过选择 q 值最高的行动执行策略。\n\n他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，还预测了决策带来的收益。\n\n<font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。\n\n<font color=green>相对来说，策略网络的性能会比估值网络好一些。</font>\n\n<font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络。</font>\n\n#### 策略网络(Policy Network)\n\n直接看一个例子，学习的目标是，左右用力使得木棍不倒地，[Policy_Network.py](https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py) [Policy_Network.py](policy_network.py)\n\n关键代码\n\n```python\nscore = tf.matmul(layer1,W2)\nprobability = tf.nn.sigmoid(score)#网络输出采取Action 1的概率。\ninput_y = tf.placeholder(tf.float32,[None,1], \\\\\nname=\"input_y\")# 输入采取过的行为，这个行为是随机生成的。\nadvantages = tf.placeholder(tf.float32,name=\"reward_signal\")\n# 输入获益\nloglik = tf.log(input_y*(input_y - probability) + \\\\\n(1 - input_y)*(input_y + probability))\n# 损失函数，如果行为是1，则增大\n\n#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损\n#失函数无论当前行为是什么都会增大当前行为的概率。\nloss = -tf.reduce_mean(loglik * advantages) # 这行代码很关键，\n#相当于给损失函数成了一个权重advantages，得到最终的损失函数。\n#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加\n#当前行为的概率。\n\n#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是\n#获益多的行为以更大的权重增加。\n\n#一个试验： 由初始状态开始，随机采取一连串的行为\n#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但\n#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实\n#验一下），直到任务结束。\n\n## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得\n#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）\n\n## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的\n#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。\n\n##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境\n#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型\n#学习为环境带来高获益的行为的规律。\n```\n\n由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的构建---如何构建数据集。\n\n在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。\n\n上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？\n\n##### 数据集是否可以和模型无关（不随着模型变化）？\n\n关键修改代码\n\n```python\n###基于当前模型，根据当前的状态x，生成Action 1的概率\ntfprob = sess.run(probability,feed_dict={observations: x})\n### 基于预测概率，随机生成行为，并试探环境。生成数据集。\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n修改后\n\n```python\n### 注释掉这句，并不需要根据当前模型生成概率\n### tfprob = sess.run(probability,feed_dict={observations: x})\n### 直接设置概率为0.5，随机完全随机探索生成数据集。\ntfprob = 0.5\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n结果：修改后，模型无法收敛。\n\n完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。\n\n所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的 action，再在这个相对好的 action 的基础上，在探索探索出更好的 action。\n\n如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。\n\n也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了一些随机，探索更好的知识。\n\n#### 估值网络(Value Network，Q-learning)\n\nQ-Learing 用神经网络实现，得到的模型就是估值网络。\n\n也看一个例子，[Value_Network.py](https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py)\n\n学习每个 Action 所对应的 reward 的期望。\n\n我们先看看数据集的结构\n\n```python\n###Save the experience to our episode buffer.\nepisodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[1,5]))\n### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward\n### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。\n```\n\n1.  现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为 a 的全部 reward 的期望。\n\n2.  现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递归的感觉了。\n\n3.  现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感觉这就是估值网络方法的核心。\n\n直接看关键代码\n\n```python\n###Choose an action by greedily (with e chance of random action)\n### from the Q-network\nif np.random.rand(1) < e or total_steps < pre_train_steps:\na = np.random.randint(0,4)\nelse:\na = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[0]\n### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps < pre_train_steps的时候）\n### 当total_steps >= pre_train_steps之后呢，就不是完全随机探索了。\n### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。\n### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入\n### 额外的参数e和pre_train_steps来控制随机探索的强度。\n### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action\n### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连\n### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的\n### 基础上具有一定的随机性进行探索。\n```\n\n**这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e chance of random action) from the Q-network\"的意思。**\n\n**<font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络，在探索阶段，在生成数据集上的特点。</font>**\n\n在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心不行。\n\n```python\nif total_steps > pre_train_steps:\nif e > endE:\ne -= stepDrop\n### 完全随机了之后，开始慢慢减小随机性。\n### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。\n### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验\n### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。\n### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性\n###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的\n```\n\n下面的代码是将在数据集弄好的情况下，如何训练模型的。\n\n```python\nif total_steps % (update_freq) == 0:\ntrainBatch = myBuffer.sample(batch_size) #Get a random batch of experiences.\n#Below we perform the Double-DQN update to the target Q-values\n# 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境\n# 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action\nQ1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,3])})\n# target网络预测了下一时刻的reward\nQ2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,3])})\nend_multiplier = -(trainBatch[:,4] - 1)\n# 用主网络预测出的Action以及target网络预测出的所有行为的reward\n# 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)\ndoubleQ = Q2[range(batch_size),Q1]\n# 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward\ntargetQ = trainBatch[:,2] + (y*doubleQ * end_multiplier)\n#Update the network with our target values.\n# 公式右边得到了之后，在把真正的当前状态输入进去，得到左边\n# 左边以右边作为标签进行学习。更新主网络的参数\n_ = sess.run(mainQN.updateModel, \\\nfeed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,0]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,1]})\n# 更新target网络的参数。\nupdateTarget(targetOps,sess) #Update the target network toward the primary network.\n```\n\ntarget 网络参数的更新方式代码\n\n````python\ndef updateTargetGraph(tfVars,tau):\ntotal_vars = len(tfVars)\nop_holder = []\n# 主网络是和target网络一样的，前一半参数正好是主网络的参数\nfor idx,var in enumerate(tfVars[0:total_vars//2]):\n# idx+total_vars对应的时候后一半的参数也就是target网络的参数\n# 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数\n# 也就是说target网络在以一定的速度向主网络靠近\n# 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式\n# 右边的值，即标签，即使是等式右边，也不是target网络完全决定的\n# target网络得到了所有Action的reward，最大的Action是主网络选择的\n# 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边\n# 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络\n# 是出于优化的考虑。我们后面叙述。\nop_holder.append(tfVars[idx+total_vars//2].assign\\\\\n((var.value()*tau) \\\\\n                      + ((1-tau)*tfVars[idx+total_vars//2].value())))\n                      return op_holder\n\n                      def updateTarget(op_holder,sess):\n                      for op in op_holder:\n                      sess.run(op)\n\n                      ```\n\n                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。\n\n                      1.  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。\n                      2.  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=1而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。\n                      3.  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。\n                      4.  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。\n                      5.  Dueling DQN。上代码\n\n                      ```python\n                      self.AW = tf.Variable(xavier_init([h_size//2,env.actions]))\n                      self.VW = tf.Variable(xavier_init([h_size//2,1]))\n                      self.Advantage = tf.matmul(self.streamA,self.AW)\n                      self.Value = tf.matmul(self.streamV,self.VW)\n\n###Then combine them together to get our final Q-values.\n### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage\n### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量\n### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value\n### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。\n### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。\n###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑\n### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现\n### 优化的好了。其实谁也不知道其中到底是什么原因起作用。\nself.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=1,keep_dims=True))\n\n````\n\n#### 策略网络和估值网络的不同\n\n从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在于对抗的方法。\n\n1.  策略网络：对抗的焦点在于选择 Action 的概率。\n2.  估值网络：对抗的焦点在于评估 Action 的 reward。\n3.  两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索\n4.  比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个 Action 的 reward 的时候，和其他 Action 是无关的。**而且其实不能说是提高 reward，它是预测出正确的 reward。**（这是两者的很大的不同处，策略网络更像是一个分类问题，而估值网络像是一个回归问题）\n\n### 回顾\n\n强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。\n\n连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的问题，做了标签，让问题可以解决。\n\n深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签，把它转换为可导的，可用 sgd 优化的问题。\n\n做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自用，保持谦卑，给新的可能保留空间。\n\n无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是隐式的利用探索和贪心）。\n\n策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在我得感觉上更加符合强化两个字。强化好的行为嘛。\n\n估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感觉。\n\n策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。而估值网络的数据集是单个单个的。\n\n由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和下一状态。\n\n```python\nif done:\nepisode_number += 1\nepx = np.vstack(xs)\nepy = np.vstack(ys)\nepr = np.vstack(drs)\ntfp = tfps\nxs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]\n\ndiscounted_epr = discount_rewards(epr)\ndiscounted_epr -= np.mean(discounted_epr)\ndiscounted_epr //= np.std(discounted_epr)\n\ntGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})\nfor ix,grad in enumerate(tGrad):\ngradBuffer[ix] += grad\n\nif episode_number % batch_size == 0:\nsess.run(updateGrads,feed_dict={W1Grad: gradBuffer[0],W1_1Grad:gradBuffer[1],W2Grad:gradBuffer[2]})\n```\n\n估值网络人为的控制随机强度，也是一个值得考虑的问题。\n","source":"_posts/First-Step-to-RL.md","raw":"---\n\ntitle: First Step to Reinforcement Learning\ndate: 2021-12-03 16:48:41\ndescription: 强化学习的入门介绍；什么是强化学习；深度强化学习算法：策略网络(Policy Network)和估值网络(Value Network)。\ntags:\n\n- Reinforcement Learning\n\ncategories:\n\n- Reinforcement Learning\n\n---\n\n### 什么是强化学习，关于强化学习的几点疑问\n\n<font color=green size=3>强化学习三要素：环境状态，行动，奖励</font>\n\n<font color=green size=3>目标：尽量多的获得奖励</font>\n\n<font color=green size=3>本质：连续决策</font>\n\n基本的强化学习模型包括：\n\n- 环境状态的集合 S\n- 动作的集合 A\n- 状态之间的转换规则（是环境的一部分）\n- 规定转换后“即时奖励”的规则（是环境的一部分）\n- 描述主体（智能体）能够观察到什么的规则（是环境的一部分）\n- 能够做出决策/动作的主体（智能体）\n\n#### 区别于深度学习，强化学习的本质特点是什么？\n\n**两个定义**\n\n1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。\n\n2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。\n\n强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习。\n\n强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应用场景只管模型本身是不是满足深度学习的特点。\n\n而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。\n\n<font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强化学习的模型。</font>\n\n强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特点，估值网络的特点是修正和预测获益）\n\n由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化学习。\n\n#### 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？\n\n这个问题要了解下一节，具体的强化学习方法。\n\n#### 强化学习与弱监督学习？\n\n弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更多的信息。\n\n强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。\n\n所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的\n\n#### 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法\n\n深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是死的。\n\n有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它无法摆脱对绝对的标签的依赖，无法超越标签。\n\n而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的，拥有智能的算法。\n\n<font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境，强化有益行为</font>\n\n#### 关于深度学习，强化学习，连续可导性和离散不可导性的讨论\n\n1.  从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到 target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数。target 和 Action 都可以是离散的或者连续的。）\n\n2.  深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化的。因为包含和不包含是离散的，对 loss 不可导。\n\n不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。\n\n3.  强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决离散的问题。\n\n4.  下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次 Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终 reward 多少了，只有单步的 reward。\n\n限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这个问题，要靠强化学习。\n\n<font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自然的。</font>\n\n5.  多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。\n\n综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。\n\n强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。\n\n**<font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的大 reward 的行为。</font>**\n\n#### 深度学习优化和强化学习优化的感性理解\n\n前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学习优化方法和强化学习优化方法的感性理解。\n\n还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。\n\n然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下降算法无法优化它。\n\n强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一下。尝试的结果是哪种 reward 多，就增大哪种的概率。\n\n**<font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的 action 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的 reward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种 Action，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论。</font>**\n\n更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的 Action，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。\n\n强化学习方法算出的梯度是策略梯度。\n\n**<font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的 Action 优化它。</font>**\n\n**<font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font>**\n\n在不可导的地方加标签。\n\n**<font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font>**\n\n### 策略网络(Policy Network)和估值网络(Value Network)\n\nAlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。\n\n强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.\n\n深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主要分为策略网络和估值网络。\n\n强化学习中最重要的两类方法**Policy-based,Value-based**。第一种直接预测在某个环境下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动的期望价值，然后通过选择 q 值最高的行动执行策略。\n\n他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，还预测了决策带来的收益。\n\n<font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。\n\n<font color=green>相对来说，策略网络的性能会比估值网络好一些。</font>\n\n<font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络。</font>\n\n#### 策略网络(Policy Network)\n\n直接看一个例子，学习的目标是，左右用力使得木棍不倒地，[Policy_Network.py](https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py) [Policy_Network.py](policy_network.py)\n\n关键代码\n\n```python\nscore = tf.matmul(layer1,W2)\nprobability = tf.nn.sigmoid(score)#网络输出采取Action 1的概率。\ninput_y = tf.placeholder(tf.float32,[None,1], \\\\\nname=\"input_y\")# 输入采取过的行为，这个行为是随机生成的。\nadvantages = tf.placeholder(tf.float32,name=\"reward_signal\")\n# 输入获益\nloglik = tf.log(input_y*(input_y - probability) + \\\\\n(1 - input_y)*(input_y + probability))\n# 损失函数，如果行为是1，则增大\n\n#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损\n#失函数无论当前行为是什么都会增大当前行为的概率。\nloss = -tf.reduce_mean(loglik * advantages) # 这行代码很关键，\n#相当于给损失函数成了一个权重advantages，得到最终的损失函数。\n#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加\n#当前行为的概率。\n\n#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是\n#获益多的行为以更大的权重增加。\n\n#一个试验： 由初始状态开始，随机采取一连串的行为\n#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但\n#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实\n#验一下），直到任务结束。\n\n## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得\n#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）\n\n## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的\n#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。\n\n##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境\n#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型\n#学习为环境带来高获益的行为的规律。\n```\n\n由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的构建---如何构建数据集。\n\n在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。\n\n上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？\n\n##### 数据集是否可以和模型无关（不随着模型变化）？\n\n关键修改代码\n\n```python\n###基于当前模型，根据当前的状态x，生成Action 1的概率\ntfprob = sess.run(probability,feed_dict={observations: x})\n### 基于预测概率，随机生成行为，并试探环境。生成数据集。\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n修改后\n\n```python\n### 注释掉这句，并不需要根据当前模型生成概率\n### tfprob = sess.run(probability,feed_dict={observations: x})\n### 直接设置概率为0.5，随机完全随机探索生成数据集。\ntfprob = 0.5\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n结果：修改后，模型无法收敛。\n\n完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。\n\n所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的 action，再在这个相对好的 action 的基础上，在探索探索出更好的 action。\n\n如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。\n\n也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了一些随机，探索更好的知识。\n\n#### 估值网络(Value Network，Q-learning)\n\nQ-Learing 用神经网络实现，得到的模型就是估值网络。\n\n也看一个例子，[Value_Network.py](https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py)\n\n学习每个 Action 所对应的 reward 的期望。\n\n我们先看看数据集的结构\n\n```python\n###Save the experience to our episode buffer.\nepisodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[1,5]))\n### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward\n### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。\n```\n\n1.  现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为 a 的全部 reward 的期望。\n\n2.  现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递归的感觉了。\n\n3.  现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感觉这就是估值网络方法的核心。\n\n直接看关键代码\n\n```python\n###Choose an action by greedily (with e chance of random action)\n### from the Q-network\nif np.random.rand(1) < e or total_steps < pre_train_steps:\na = np.random.randint(0,4)\nelse:\na = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[0]\n### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps < pre_train_steps的时候）\n### 当total_steps >= pre_train_steps之后呢，就不是完全随机探索了。\n### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。\n### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入\n### 额外的参数e和pre_train_steps来控制随机探索的强度。\n### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action\n### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连\n### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的\n### 基础上具有一定的随机性进行探索。\n```\n\n**这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e chance of random action) from the Q-network\"的意思。**\n\n**<font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络，在探索阶段，在生成数据集上的特点。</font>**\n\n在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心不行。\n\n```python\nif total_steps > pre_train_steps:\nif e > endE:\ne -= stepDrop\n### 完全随机了之后，开始慢慢减小随机性。\n### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。\n### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验\n### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。\n### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性\n###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的\n```\n\n下面的代码是将在数据集弄好的情况下，如何训练模型的。\n\n```python\nif total_steps % (update_freq) == 0:\ntrainBatch = myBuffer.sample(batch_size) #Get a random batch of experiences.\n#Below we perform the Double-DQN update to the target Q-values\n# 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境\n# 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action\nQ1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,3])})\n# target网络预测了下一时刻的reward\nQ2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,3])})\nend_multiplier = -(trainBatch[:,4] - 1)\n# 用主网络预测出的Action以及target网络预测出的所有行为的reward\n# 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)\ndoubleQ = Q2[range(batch_size),Q1]\n# 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward\ntargetQ = trainBatch[:,2] + (y*doubleQ * end_multiplier)\n#Update the network with our target values.\n# 公式右边得到了之后，在把真正的当前状态输入进去，得到左边\n# 左边以右边作为标签进行学习。更新主网络的参数\n_ = sess.run(mainQN.updateModel, \\\nfeed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,0]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,1]})\n# 更新target网络的参数。\nupdateTarget(targetOps,sess) #Update the target network toward the primary network.\n```\n\ntarget 网络参数的更新方式代码\n\n````python\ndef updateTargetGraph(tfVars,tau):\ntotal_vars = len(tfVars)\nop_holder = []\n# 主网络是和target网络一样的，前一半参数正好是主网络的参数\nfor idx,var in enumerate(tfVars[0:total_vars//2]):\n# idx+total_vars对应的时候后一半的参数也就是target网络的参数\n# 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数\n# 也就是说target网络在以一定的速度向主网络靠近\n# 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式\n# 右边的值，即标签，即使是等式右边，也不是target网络完全决定的\n# target网络得到了所有Action的reward，最大的Action是主网络选择的\n# 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边\n# 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络\n# 是出于优化的考虑。我们后面叙述。\nop_holder.append(tfVars[idx+total_vars//2].assign\\\\\n((var.value()*tau) \\\\\n                      + ((1-tau)*tfVars[idx+total_vars//2].value())))\n                      return op_holder\n\n                      def updateTarget(op_holder,sess):\n                      for op in op_holder:\n                      sess.run(op)\n\n                      ```\n\n                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。\n\n                      1.  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。\n                      2.  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=1而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。\n                      3.  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。\n                      4.  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。\n                      5.  Dueling DQN。上代码\n\n                      ```python\n                      self.AW = tf.Variable(xavier_init([h_size//2,env.actions]))\n                      self.VW = tf.Variable(xavier_init([h_size//2,1]))\n                      self.Advantage = tf.matmul(self.streamA,self.AW)\n                      self.Value = tf.matmul(self.streamV,self.VW)\n\n###Then combine them together to get our final Q-values.\n### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage\n### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量\n### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value\n### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。\n### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。\n###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑\n### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现\n### 优化的好了。其实谁也不知道其中到底是什么原因起作用。\nself.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=1,keep_dims=True))\n\n````\n\n#### 策略网络和估值网络的不同\n\n从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在于对抗的方法。\n\n1.  策略网络：对抗的焦点在于选择 Action 的概率。\n2.  估值网络：对抗的焦点在于评估 Action 的 reward。\n3.  两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索\n4.  比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个 Action 的 reward 的时候，和其他 Action 是无关的。**而且其实不能说是提高 reward，它是预测出正确的 reward。**（这是两者的很大的不同处，策略网络更像是一个分类问题，而估值网络像是一个回归问题）\n\n### 回顾\n\n强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。\n\n连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的问题，做了标签，让问题可以解决。\n\n深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签，把它转换为可导的，可用 sgd 优化的问题。\n\n做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自用，保持谦卑，给新的可能保留空间。\n\n无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是隐式的利用探索和贪心）。\n\n策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在我得感觉上更加符合强化两个字。强化好的行为嘛。\n\n估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感觉。\n\n策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。而估值网络的数据集是单个单个的。\n\n由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和下一状态。\n\n```python\nif done:\nepisode_number += 1\nepx = np.vstack(xs)\nepy = np.vstack(ys)\nepr = np.vstack(drs)\ntfp = tfps\nxs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]\n\ndiscounted_epr = discount_rewards(epr)\ndiscounted_epr -= np.mean(discounted_epr)\ndiscounted_epr //= np.std(discounted_epr)\n\ntGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})\nfor ix,grad in enumerate(tGrad):\ngradBuffer[ix] += grad\n\nif episode_number % batch_size == 0:\nsess.run(updateGrads,feed_dict={W1Grad: gradBuffer[0],W1_1Grad:gradBuffer[1],W2Grad:gradBuffer[2]})\n```\n\n估值网络人为的控制随机强度，也是一个值得考虑的问题。\n","slug":"First-Step-to-RL","published":1,"updated":"2022-03-16T08:52:14.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hx000cgquld3xogjs2","content":"<html><head></head><body><h3 id=\"什么是强化学习关于强化学习的几点疑问\"><span class=\"post-title-index\">.1. </span><a class=\"markdownIt-Anchor\" href=\"#什么是强化学习关于强化学习的几点疑问\"></a> 什么是强化学习，关于强化学习的几点疑问</h3>\n<p><font color=\"green\" size=\"3\">强化学习三要素：环境状态，行动，奖励</font></p>\n<p><font color=\"green\" size=\"3\">目标：尽量多的获得奖励</font></p>\n<p><font color=\"green\" size=\"3\">本质：连续决策</font></p>\n<p>基本的强化学习模型包括：</p>\n<ul>\n<li>环境状态的集合 S</li>\n<li>动作的集合 A</li>\n<li>状态之间的转换规则（是环境的一部分）</li>\n<li>规定转换后“即时奖励”的规则（是环境的一部分）</li>\n<li>描述主体（智能体）能够观察到什么的规则（是环境的一部分）</li>\n<li>能够做出决策/动作的主体（智能体）</li>\n</ul>\n<h4 id=\"区别于深度学习强化学习的本质特点是什么\"><span class=\"post-title-index\">.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#区别于深度学习强化学习的本质特点是什么\"></a> 区别于深度学习，强化学习的本质特点是什么？</h4>\n<p><strong>两个定义</strong></p>\n<p>1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。</p>\n<p>2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</p>\n<p>强化学习的本质是<font color=\"deeppink\"> 描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习。</p>\n<p>强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应用场景只管模型本身是不是满足深度学习的特点。</p>\n<p>而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。</p>\n<p><font color=\"deeppink\">强化学习的本质在于目标给定的形式，不像无监督学习那样完全没有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强化学习的模型。</font></p>\n<p>强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特点，估值网络的特点是修正和预测获益）</p>\n<p>由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化学习。</p>\n<h4 id=\"深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"><span class=\"post-title-index\">.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"></a> 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？</h4>\n<p>这个问题要了解下一节，具体的强化学习方法。</p>\n<h4 id=\"强化学习与弱监督学习\"><span class=\"post-title-index\">.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#强化学习与弱监督学习\"></a> 强化学习与弱监督学习？</h4>\n<p>弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更多的信息。</p>\n<p>强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。</p>\n<p>所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的</p>\n<h4 id=\"深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"><span class=\"post-title-index\">.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"></a> 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法</h4>\n<p>深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是死的。</p>\n<p>有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它无法摆脱对绝对的标签的依赖，无法超越标签。</p>\n<p>而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的，拥有智能的算法。</p>\n<p><font color=\"green\">从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境，强化有益行为</font></p>\n<h4 id=\"关于深度学习强化学习连续可导性和离散不可导性的讨论\"><span class=\"post-title-index\">.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#关于深度学习强化学习连续可导性和离散不可导性的讨论\"></a> 关于深度学习，强化学习，连续可导性和离散不可导性的讨论</h4>\n<ol>\n<li>\n<p>从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到 target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数。target 和 Action 都可以是离散的或者连续的。）</p>\n</li>\n<li>\n<p>深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化的。因为包含和不包含是离散的，对 loss 不可导。</p>\n</li>\n</ol>\n<p>不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。</p>\n<ol start=\"3\">\n<li>\n<p>强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决离散的问题。</p>\n</li>\n<li>\n<p>下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次 Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终 reward 多少了，只有单步的 reward。</p>\n</li>\n</ol>\n<p>限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这个问题，要靠强化学习。</p>\n<p><font color=\"green\">这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自然的。</font></p>\n<ol start=\"5\">\n<li>多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。</li>\n</ol>\n<p>综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。</p>\n<p>强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。</p>\n<p><strong><font color=\"green\">因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的大 reward 的行为。</font></strong></p>\n<h4 id=\"深度学习优化和强化学习优化的感性理解\"><span class=\"post-title-index\">.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习优化和强化学习优化的感性理解\"></a> 深度学习优化和强化学习优化的感性理解</h4>\n<p>前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学习优化方法和强化学习优化方法的感性理解。</p>\n<p>还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。</p>\n<p>然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下降算法无法优化它。</p>\n<p>强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一下。尝试的结果是哪种 reward 多，就增大哪种的概率。</p>\n<p><strong><font color=\"green\">所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的 action 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的 reward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种 Action，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论。</font></strong></p>\n<p>更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的 Action，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。</p>\n<p>强化学习方法算出的梯度是策略梯度。</p>\n<p><strong><font color=\"green\">强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的 Action 优化它。</font></strong></p>\n<p><strong><font color=\"green\">强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font></strong></p>\n<p>在不可导的地方加标签。</p>\n<p><strong><font color=\"green\">由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font></strong></p>\n<h3 id=\"策略网络policy-network和估值网络value-network\"><span class=\"post-title-index\">.2. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network和估值网络value-network\"></a> 策略网络(Policy Network)和估值网络(Value Network)</h3>\n<p>AlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。</p>\n<p>强化学习算法的一个关键是<font color=\"green\">随机性和探索性</font>，我们需要让算法通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.</p>\n<p>深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主要分为策略网络和估值网络。</p>\n<p>强化学习中最重要的两类方法<strong>Policy-based,Value-based</strong>。第一种直接预测在某个环境下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动的期望价值，然后通过选择 q 值最高的行动执行策略。</p>\n<p>他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，还预测了决策带来的收益。</p>\n<p><font color=\"deeppink\">策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。</p>\n<p><font color=\"green\">相对来说，策略网络的性能会比估值网络好一些。</font></p>\n<p><font color=\"green\">Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络。</font></p>\n<h4 id=\"策略网络policy-network\"><span class=\"post-title-index\">.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network\"></a> 策略网络(Policy Network)</h4>\n<p>直接看一个例子，学习的目标是，左右用力使得木棍不倒地，<a href=\"https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py\">Policy_Network.py</a> <a href=\"policy_network.py\">Policy_Network.py</a></p>\n<p>关键代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">score = tf.matmul(layer1,W2)</span><br><span class=\"line\">probability = tf.nn.sigmoid(score)<span class=\"comment\">#网络输出采取Action 1的概率。</span></span><br><span class=\"line\">input_y = tf.placeholder(tf.float32,[<span class=\"literal\">None</span>,<span class=\"number\">1</span>], \\\\</span><br><span class=\"line\">name=<span class=\"string\">\"input_y\"</span>)<span class=\"comment\"># 输入采取过的行为，这个行为是随机生成的。</span></span><br><span class=\"line\">advantages = tf.placeholder(tf.float32,name=<span class=\"string\">\"reward_signal\"</span>)</span><br><span class=\"line\"><span class=\"comment\"># 输入获益</span></span><br><span class=\"line\">loglik = tf.log(input_y*(input_y - probability) + \\\\</span><br><span class=\"line\">(<span class=\"number\">1</span> - input_y)*(input_y + probability))</span><br><span class=\"line\"><span class=\"comment\"># 损失函数，如果行为是1，则增大</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损</span></span><br><span class=\"line\"><span class=\"comment\">#失函数无论当前行为是什么都会增大当前行为的概率。</span></span><br><span class=\"line\">loss = -tf.reduce_mean(loglik * advantages) <span class=\"comment\"># 这行代码很关键，</span></span><br><span class=\"line\"><span class=\"comment\">#相当于给损失函数成了一个权重advantages，得到最终的损失函数。</span></span><br><span class=\"line\"><span class=\"comment\">#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加</span></span><br><span class=\"line\"><span class=\"comment\">#当前行为的概率。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是</span></span><br><span class=\"line\"><span class=\"comment\">#获益多的行为以更大的权重增加。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一个试验： 由初始状态开始，随机采取一连串的行为</span></span><br><span class=\"line\"><span class=\"comment\">#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但</span></span><br><span class=\"line\"><span class=\"comment\">#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实</span></span><br><span class=\"line\"><span class=\"comment\">#验一下），直到任务结束。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得</span></span><br><span class=\"line\"><span class=\"comment\">#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的</span></span><br><span class=\"line\"><span class=\"comment\">#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境</span></span><br><span class=\"line\"><span class=\"comment\">#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型</span></span><br><span class=\"line\"><span class=\"comment\">#学习为环境带来高获益的行为的规律。</span></span><br></pre></td></tr></tbody></table></figure>\n<p>由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的构建—如何构建数据集。</p>\n<p>在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。</p>\n<p>上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？</p>\n<h5 id=\"数据集是否可以和模型无关不随着模型变化\"><span class=\"post-title-index\">.2.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#数据集是否可以和模型无关不随着模型变化\"></a> 数据集是否可以和模型无关（不随着模型变化）？</h5>\n<p>关键修改代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###基于当前模型，根据当前的状态x，生成Action 1的概率</span></span><br><span class=\"line\">tfprob = sess.run(probability,feed_dict={observations: x})</span><br><span class=\"line\"><span class=\"comment\">### 基于预测概率，随机生成行为，并试探环境。生成数据集。</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></tbody></table></figure>\n<p>修改后</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 注释掉这句，并不需要根据当前模型生成概率</span></span><br><span class=\"line\"><span class=\"comment\">### tfprob = sess.run(probability,feed_dict={observations: x})</span></span><br><span class=\"line\"><span class=\"comment\">### 直接设置概率为0.5，随机完全随机探索生成数据集。</span></span><br><span class=\"line\">tfprob = <span class=\"number\">0.5</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></tbody></table></figure>\n<p>结果：修改后，模型无法收敛。</p>\n<p>完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。</p>\n<p>所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的 action，再在这个相对好的 action 的基础上，在探索探索出更好的 action。</p>\n<p>如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。</p>\n<p>也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了一些随机，探索更好的知识。</p>\n<h4 id=\"估值网络value-networkq-learning\"><span class=\"post-title-index\">.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#估值网络value-networkq-learning\"></a> 估值网络(Value Network，Q-learning)</h4>\n<p>Q-Learing 用神经网络实现，得到的模型就是估值网络。</p>\n<p>也看一个例子，<a href=\"https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py\">Value_Network.py</a></p>\n<p>学习每个 Action 所对应的 reward 的期望。</p>\n<p>我们先看看数据集的结构</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Save the experience to our episode buffer.</span></span><br><span class=\"line\">episodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[<span class=\"number\">1</span>,<span class=\"number\">5</span>]))</span><br><span class=\"line\"><span class=\"comment\">### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward</span></span><br><span class=\"line\"><span class=\"comment\">### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。</span></span><br></pre></td></tr></tbody></table></figure>\n<ol>\n<li>\n<p>现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为 a 的全部 reward 的期望。</p>\n</li>\n<li>\n<p>现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递归的感觉了。</p>\n</li>\n<li>\n<p>现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感觉这就是估值网络方法的核心。</p>\n</li>\n</ol>\n<p>直接看关键代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Choose an action by greedily (with e chance of random action)</span></span><br><span class=\"line\"><span class=\"comment\">### from the Q-network</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> np.random.rand(<span class=\"number\">1</span>) &lt; e <span class=\"keyword\">or</span> total_steps &lt; pre_train_steps:</span><br><span class=\"line\">a = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">a = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"comment\">### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps &lt; pre_train_steps的时候）</span></span><br><span class=\"line\"><span class=\"comment\">### 当total_steps &gt;= pre_train_steps之后呢，就不是完全随机探索了。</span></span><br><span class=\"line\"><span class=\"comment\">### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。</span></span><br><span class=\"line\"><span class=\"comment\">### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入</span></span><br><span class=\"line\"><span class=\"comment\">### 额外的参数e和pre_train_steps来控制随机探索的强度。</span></span><br><span class=\"line\"><span class=\"comment\">### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action</span></span><br><span class=\"line\"><span class=\"comment\">### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连</span></span><br><span class=\"line\"><span class=\"comment\">### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的</span></span><br><span class=\"line\"><span class=\"comment\">### 基础上具有一定的随机性进行探索。</span></span><br></pre></td></tr></tbody></table></figure>\n<p><strong>这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e chance of random action) from the Q-network\"的意思。</strong></p>\n<p><strong><font color=\"green\">“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络，在探索阶段，在生成数据集上的特点。</font></strong></p>\n<p>在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心不行。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps &gt; pre_train_steps:</span><br><span class=\"line\"><span class=\"keyword\">if</span> e &gt; endE:</span><br><span class=\"line\">e -= stepDrop</span><br><span class=\"line\"><span class=\"comment\">### 完全随机了之后，开始慢慢减小随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验</span></span><br><span class=\"line\"><span class=\"comment\">### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。</span></span><br><span class=\"line\"><span class=\"comment\">### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性</span></span><br><span class=\"line\"><span class=\"comment\">###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的</span></span><br></pre></td></tr></tbody></table></figure>\n<p>下面的代码是将在数据集弄好的情况下，如何训练模型的。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps % (update_freq) == <span class=\"number\">0</span>:</span><br><span class=\"line\">trainBatch = myBuffer.sample(batch_size) <span class=\"comment\">#Get a random batch of experiences.</span></span><br><span class=\"line\"><span class=\"comment\">#Below we perform the Double-DQN update to the target Q-values</span></span><br><span class=\"line\"><span class=\"comment\"># 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境</span></span><br><span class=\"line\"><span class=\"comment\"># 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action</span></span><br><span class=\"line\">Q1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])})</span><br><span class=\"line\"><span class=\"comment\"># target网络预测了下一时刻的reward</span></span><br><span class=\"line\">Q2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])})</span><br><span class=\"line\">end_multiplier = -(trainBatch[:,<span class=\"number\">4</span>] - <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用主网络预测出的Action以及target网络预测出的所有行为的reward</span></span><br><span class=\"line\"><span class=\"comment\"># 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)</span></span><br><span class=\"line\">doubleQ = Q2[<span class=\"built_in\">range</span>(batch_size),Q1]</span><br><span class=\"line\"><span class=\"comment\"># 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward</span></span><br><span class=\"line\">targetQ = trainBatch[:,<span class=\"number\">2</span>] + (y*doubleQ * end_multiplier)</span><br><span class=\"line\"><span class=\"comment\">#Update the network with our target values.</span></span><br><span class=\"line\"><span class=\"comment\"># 公式右边得到了之后，在把真正的当前状态输入进去，得到左边</span></span><br><span class=\"line\"><span class=\"comment\"># 左边以右边作为标签进行学习。更新主网络的参数</span></span><br><span class=\"line\">_ = sess.run(mainQN.updateModel, \\</span><br><span class=\"line\">feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">0</span>]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,<span class=\"number\">1</span>]})</span><br><span class=\"line\"><span class=\"comment\"># 更新target网络的参数。</span></span><br><span class=\"line\">updateTarget(targetOps,sess) <span class=\"comment\">#Update the target network toward the primary network.</span></span><br></pre></td></tr></tbody></table></figure>\n<p>target 网络参数的更新方式代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTargetGraph</span>(<span class=\"params\">tfVars,tau</span>):</span></span><br><span class=\"line\">total_vars = <span class=\"built_in\">len</span>(tfVars)</span><br><span class=\"line\">op_holder = []</span><br><span class=\"line\"><span class=\"comment\"># 主网络是和target网络一样的，前一半参数正好是主网络的参数</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> idx,var <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tfVars[<span class=\"number\">0</span>:total_vars//<span class=\"number\">2</span>]):</span><br><span class=\"line\"><span class=\"comment\"># idx+total_vars对应的时候后一半的参数也就是target网络的参数</span></span><br><span class=\"line\"><span class=\"comment\"># 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数</span></span><br><span class=\"line\"><span class=\"comment\"># 也就是说target网络在以一定的速度向主网络靠近</span></span><br><span class=\"line\"><span class=\"comment\"># 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式</span></span><br><span class=\"line\"><span class=\"comment\"># 右边的值，即标签，即使是等式右边，也不是target网络完全决定的</span></span><br><span class=\"line\"><span class=\"comment\"># target网络得到了所有Action的reward，最大的Action是主网络选择的</span></span><br><span class=\"line\"><span class=\"comment\"># 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边</span></span><br><span class=\"line\"><span class=\"comment\"># 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络</span></span><br><span class=\"line\"><span class=\"comment\"># 是出于优化的考虑。我们后面叙述。</span></span><br><span class=\"line\">op_holder.append(tfVars[idx+total_vars//<span class=\"number\">2</span>].assign\\\\</span><br><span class=\"line\">((var.value()*tau) \\\\</span><br><span class=\"line\">                      + ((<span class=\"number\">1</span>-tau)*tfVars[idx+total_vars//<span class=\"number\">2</span>].value())))</span><br><span class=\"line\">                      <span class=\"keyword\">return</span> op_holder</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTarget</span>(<span class=\"params\">op_holder,sess</span>):</span></span><br><span class=\"line\">                      <span class=\"keyword\">for</span> op <span class=\"keyword\">in</span> op_holder:</span><br><span class=\"line\">                      sess.run(op)</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```</span><br><span class=\"line\"></span><br><span class=\"line\">                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"number\">1.</span>  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。</span><br><span class=\"line\">                      <span class=\"number\">2.</span>  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=<span class=\"number\">1</span>而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。</span><br><span class=\"line\">                      <span class=\"number\">3.</span>  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。</span><br><span class=\"line\">                      <span class=\"number\">4.</span>  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。</span><br><span class=\"line\">                      <span class=\"number\">5.</span>  Dueling DQN。上代码</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```python</span><br><span class=\"line\">                      self.AW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,env.actions]))</span><br><span class=\"line\">                      self.VW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,<span class=\"number\">1</span>]))</span><br><span class=\"line\">                      self.Advantage = tf.matmul(self.streamA,self.AW)</span><br><span class=\"line\">                      self.Value = tf.matmul(self.streamV,self.VW)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###Then combine them together to get our final Q-values.</span></span><br><span class=\"line\"><span class=\"comment\">### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage</span></span><br><span class=\"line\"><span class=\"comment\">### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量</span></span><br><span class=\"line\"><span class=\"comment\">### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value</span></span><br><span class=\"line\"><span class=\"comment\">### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。</span></span><br><span class=\"line\"><span class=\"comment\">### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。</span></span><br><span class=\"line\"><span class=\"comment\">###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑</span></span><br><span class=\"line\"><span class=\"comment\">### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现</span></span><br><span class=\"line\"><span class=\"comment\">### 优化的好了。其实谁也不知道其中到底是什么原因起作用。</span></span><br><span class=\"line\">self.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=<span class=\"number\">1</span>,keep_dims=<span class=\"literal\">True</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"策略网络和估值网络的不同\"><span class=\"post-title-index\">.2.3. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络和估值网络的不同\"></a> 策略网络和估值网络的不同</h4>\n<p>从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在于对抗的方法。</p>\n<ol>\n<li>策略网络：对抗的焦点在于选择 Action 的概率。</li>\n<li>估值网络：对抗的焦点在于评估 Action 的 reward。</li>\n<li>两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索</li>\n<li>比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个 Action 的 reward 的时候，和其他 Action 是无关的。<strong>而且其实不能说是提高 reward，它是预测出正确的 reward。</strong>（这是两者的很大的不同处，策略网络更像是一个分类问题，而估值网络像是一个回归问题）</li>\n</ol>\n<h3 id=\"回顾\"><span class=\"post-title-index\">.3. </span><a class=\"markdownIt-Anchor\" href=\"#回顾\"></a> 回顾</h3>\n<p>强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。</p>\n<p>连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的问题，做了标签，让问题可以解决。</p>\n<p>深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签，把它转换为可导的，可用 sgd 优化的问题。</p>\n<p>做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自用，保持谦卑，给新的可能保留空间。</p>\n<p>无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是隐式的利用探索和贪心）。</p>\n<p>策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在我得感觉上更加符合强化两个字。强化好的行为嘛。</p>\n<p>估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感觉。</p>\n<p>策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。而估值网络的数据集是单个单个的。</p>\n<p>由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和下一状态。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> done:</span><br><span class=\"line\">episode_number += <span class=\"number\">1</span></span><br><span class=\"line\">epx = np.vstack(xs)</span><br><span class=\"line\">epy = np.vstack(ys)</span><br><span class=\"line\">epr = np.vstack(drs)</span><br><span class=\"line\">tfp = tfps</span><br><span class=\"line\">xs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]</span><br><span class=\"line\"></span><br><span class=\"line\">discounted_epr = discount_rewards(epr)</span><br><span class=\"line\">discounted_epr -= np.mean(discounted_epr)</span><br><span class=\"line\">discounted_epr //= np.std(discounted_epr)</span><br><span class=\"line\"></span><br><span class=\"line\">tGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})</span><br><span class=\"line\"><span class=\"keyword\">for</span> ix,grad <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tGrad):</span><br><span class=\"line\">gradBuffer[ix] += grad</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> episode_number % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">sess.run(updateGrads,feed_dict={W1Grad: gradBuffer[<span class=\"number\">0</span>],W1_1Grad:gradBuffer[<span class=\"number\">1</span>],W2Grad:gradBuffer[<span class=\"number\">2</span>]})</span><br></pre></td></tr></tbody></table></figure>\n<p>估值网络人为的控制随机强度，也是一个值得考虑的问题。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h3 id=\"什么是强化学习关于强化学习的几点疑问\"><a class=\"markdownIt-Anchor\" href=\"#什么是强化学习关于强化学习的几点疑问\"></a> 什么是强化学习，关于强化学习的几点疑问</h3>\n<p><font color=green size=3>强化学习三要素：环境状态，行动，奖励</font></p>\n<p><font color=green size=3>目标：尽量多的获得奖励</font></p>\n<p><font color=green size=3>本质：连续决策</font></p>\n<p>基本的强化学习模型包括：</p>\n<ul>\n<li>环境状态的集合 S</li>\n<li>动作的集合 A</li>\n<li>状态之间的转换规则（是环境的一部分）</li>\n<li>规定转换后“即时奖励”的规则（是环境的一部分）</li>\n<li>描述主体（智能体）能够观察到什么的规则（是环境的一部分）</li>\n<li>能够做出决策/动作的主体（智能体）</li>\n</ul>\n<h4 id=\"区别于深度学习强化学习的本质特点是什么\"><a class=\"markdownIt-Anchor\" href=\"#区别于深度学习强化学习的本质特点是什么\"></a> 区别于深度学习，强化学习的本质特点是什么？</h4>\n<p><strong>两个定义</strong></p>\n<p>1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。</p>\n<p>2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</p>\n<p>强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习。</p>\n<p>强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应用场景只管模型本身是不是满足深度学习的特点。</p>\n<p>而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。</p>\n<p><font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强化学习的模型。</font></p>\n<p>强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特点，估值网络的特点是修正和预测获益）</p>\n<p>由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化学习。</p>\n<h4 id=\"深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"><a class=\"markdownIt-Anchor\" href=\"#深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"></a> 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？</h4>\n<p>这个问题要了解下一节，具体的强化学习方法。</p>\n<h4 id=\"强化学习与弱监督学习\"><a class=\"markdownIt-Anchor\" href=\"#强化学习与弱监督学习\"></a> 强化学习与弱监督学习？</h4>\n<p>弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更多的信息。</p>\n<p>强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。</p>\n<p>所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的</p>\n<h4 id=\"深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"><a class=\"markdownIt-Anchor\" href=\"#深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"></a> 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法</h4>\n<p>深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是死的。</p>\n<p>有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它无法摆脱对绝对的标签的依赖，无法超越标签。</p>\n<p>而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的，拥有智能的算法。</p>\n<p><font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境，强化有益行为</font></p>\n<h4 id=\"关于深度学习强化学习连续可导性和离散不可导性的讨论\"><a class=\"markdownIt-Anchor\" href=\"#关于深度学习强化学习连续可导性和离散不可导性的讨论\"></a> 关于深度学习，强化学习，连续可导性和离散不可导性的讨论</h4>\n<ol>\n<li>\n<p>从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到 target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数。target 和 Action 都可以是离散的或者连续的。）</p>\n</li>\n<li>\n<p>深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化的。因为包含和不包含是离散的，对 loss 不可导。</p>\n</li>\n</ol>\n<p>不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。</p>\n<ol start=\"3\">\n<li>\n<p>强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决离散的问题。</p>\n</li>\n<li>\n<p>下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次 Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终 reward 多少了，只有单步的 reward。</p>\n</li>\n</ol>\n<p>限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这个问题，要靠强化学习。</p>\n<p><font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自然的。</font></p>\n<ol start=\"5\">\n<li>多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。</li>\n</ol>\n<p>综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。</p>\n<p>强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。</p>\n<p><strong><font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的大 reward 的行为。</font></strong></p>\n<h4 id=\"深度学习优化和强化学习优化的感性理解\"><a class=\"markdownIt-Anchor\" href=\"#深度学习优化和强化学习优化的感性理解\"></a> 深度学习优化和强化学习优化的感性理解</h4>\n<p>前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学习优化方法和强化学习优化方法的感性理解。</p>\n<p>还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。</p>\n<p>然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下降算法无法优化它。</p>\n<p>强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一下。尝试的结果是哪种 reward 多，就增大哪种的概率。</p>\n<p><strong><font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的 action 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的 reward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种 Action，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论。</font></strong></p>\n<p>更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的 Action，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。</p>\n<p>强化学习方法算出的梯度是策略梯度。</p>\n<p><strong><font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的 Action 优化它。</font></strong></p>\n<p><strong><font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font></strong></p>\n<p>在不可导的地方加标签。</p>\n<p><strong><font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font></strong></p>\n<h3 id=\"策略网络policy-network和估值网络value-network\"><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network和估值网络value-network\"></a> 策略网络(Policy Network)和估值网络(Value Network)</h3>\n<p>AlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。</p>\n<p>强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.</p>\n<p>深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主要分为策略网络和估值网络。</p>\n<p>强化学习中最重要的两类方法<strong>Policy-based,Value-based</strong>。第一种直接预测在某个环境下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动的期望价值，然后通过选择 q 值最高的行动执行策略。</p>\n<p>他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，还预测了决策带来的收益。</p>\n<p><font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。</p>\n<p><font color=green>相对来说，策略网络的性能会比估值网络好一些。</font></p>\n<p><font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络。</font></p>\n<h4 id=\"策略网络policy-network\"><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network\"></a> 策略网络(Policy Network)</h4>\n<p>直接看一个例子，学习的目标是，左右用力使得木棍不倒地，<a href=\"https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py\">Policy_Network.py</a> <a href=\"policy_network.py\">Policy_Network.py</a></p>\n<p>关键代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">score = tf.matmul(layer1,W2)</span><br><span class=\"line\">probability = tf.nn.sigmoid(score)<span class=\"comment\">#网络输出采取Action 1的概率。</span></span><br><span class=\"line\">input_y = tf.placeholder(tf.float32,[<span class=\"literal\">None</span>,<span class=\"number\">1</span>], \\\\</span><br><span class=\"line\">name=<span class=\"string\">&quot;input_y&quot;</span>)<span class=\"comment\"># 输入采取过的行为，这个行为是随机生成的。</span></span><br><span class=\"line\">advantages = tf.placeholder(tf.float32,name=<span class=\"string\">&quot;reward_signal&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 输入获益</span></span><br><span class=\"line\">loglik = tf.log(input_y*(input_y - probability) + \\\\</span><br><span class=\"line\">(<span class=\"number\">1</span> - input_y)*(input_y + probability))</span><br><span class=\"line\"><span class=\"comment\"># 损失函数，如果行为是1，则增大</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损</span></span><br><span class=\"line\"><span class=\"comment\">#失函数无论当前行为是什么都会增大当前行为的概率。</span></span><br><span class=\"line\">loss = -tf.reduce_mean(loglik * advantages) <span class=\"comment\"># 这行代码很关键，</span></span><br><span class=\"line\"><span class=\"comment\">#相当于给损失函数成了一个权重advantages，得到最终的损失函数。</span></span><br><span class=\"line\"><span class=\"comment\">#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加</span></span><br><span class=\"line\"><span class=\"comment\">#当前行为的概率。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是</span></span><br><span class=\"line\"><span class=\"comment\">#获益多的行为以更大的权重增加。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一个试验： 由初始状态开始，随机采取一连串的行为</span></span><br><span class=\"line\"><span class=\"comment\">#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但</span></span><br><span class=\"line\"><span class=\"comment\">#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实</span></span><br><span class=\"line\"><span class=\"comment\">#验一下），直到任务结束。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得</span></span><br><span class=\"line\"><span class=\"comment\">#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的</span></span><br><span class=\"line\"><span class=\"comment\">#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境</span></span><br><span class=\"line\"><span class=\"comment\">#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型</span></span><br><span class=\"line\"><span class=\"comment\">#学习为环境带来高获益的行为的规律。</span></span><br></pre></td></tr></table></figure>\n<p>由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的构建—如何构建数据集。</p>\n<p>在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。</p>\n<p>上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？</p>\n<h5 id=\"数据集是否可以和模型无关不随着模型变化\"><a class=\"markdownIt-Anchor\" href=\"#数据集是否可以和模型无关不随着模型变化\"></a> 数据集是否可以和模型无关（不随着模型变化）？</h5>\n<p>关键修改代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###基于当前模型，根据当前的状态x，生成Action 1的概率</span></span><br><span class=\"line\">tfprob = sess.run(probability,feed_dict=&#123;observations: x&#125;)</span><br><span class=\"line\"><span class=\"comment\">### 基于预测概率，随机生成行为，并试探环境。生成数据集。</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<p>修改后</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 注释掉这句，并不需要根据当前模型生成概率</span></span><br><span class=\"line\"><span class=\"comment\">### tfprob = sess.run(probability,feed_dict=&#123;observations: x&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">### 直接设置概率为0.5，随机完全随机探索生成数据集。</span></span><br><span class=\"line\">tfprob = <span class=\"number\">0.5</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<p>结果：修改后，模型无法收敛。</p>\n<p>完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。</p>\n<p>所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的 action，再在这个相对好的 action 的基础上，在探索探索出更好的 action。</p>\n<p>如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。</p>\n<p>也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了一些随机，探索更好的知识。</p>\n<h4 id=\"估值网络value-networkq-learning\"><a class=\"markdownIt-Anchor\" href=\"#估值网络value-networkq-learning\"></a> 估值网络(Value Network，Q-learning)</h4>\n<p>Q-Learing 用神经网络实现，得到的模型就是估值网络。</p>\n<p>也看一个例子，<a href=\"https://github.com/xyegithub/myBlog/blob/main/2021/12/03/First-Step-to-RL/policy_network.py\">Value_Network.py</a></p>\n<p>学习每个 Action 所对应的 reward 的期望。</p>\n<p>我们先看看数据集的结构</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Save the experience to our episode buffer.</span></span><br><span class=\"line\">episodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[<span class=\"number\">1</span>,<span class=\"number\">5</span>]))</span><br><span class=\"line\"><span class=\"comment\">### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward</span></span><br><span class=\"line\"><span class=\"comment\">### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>\n<p>现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为 a 的全部 reward 的期望。</p>\n</li>\n<li>\n<p>现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递归的感觉了。</p>\n</li>\n<li>\n<p>现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感觉这就是估值网络方法的核心。</p>\n</li>\n</ol>\n<p>直接看关键代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Choose an action by greedily (with e chance of random action)</span></span><br><span class=\"line\"><span class=\"comment\">### from the Q-network</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> np.random.rand(<span class=\"number\">1</span>) &lt; e <span class=\"keyword\">or</span> total_steps &lt; pre_train_steps:</span><br><span class=\"line\">a = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">a = sess.run(mainQN.predict,feed_dict=&#123;mainQN.scalarInput:[s]&#125;)[<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"comment\">### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps &lt; pre_train_steps的时候）</span></span><br><span class=\"line\"><span class=\"comment\">### 当total_steps &gt;= pre_train_steps之后呢，就不是完全随机探索了。</span></span><br><span class=\"line\"><span class=\"comment\">### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。</span></span><br><span class=\"line\"><span class=\"comment\">### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入</span></span><br><span class=\"line\"><span class=\"comment\">### 额外的参数e和pre_train_steps来控制随机探索的强度。</span></span><br><span class=\"line\"><span class=\"comment\">### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action</span></span><br><span class=\"line\"><span class=\"comment\">### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连</span></span><br><span class=\"line\"><span class=\"comment\">### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的</span></span><br><span class=\"line\"><span class=\"comment\">### 基础上具有一定的随机性进行探索。</span></span><br></pre></td></tr></table></figure>\n<p><strong>这是策略网络和估值网络的共通之处，其实这也最上面那个注释&quot;by greedily (with e chance of random action) from the Q-network&quot;的意思。</strong></p>\n<p><strong><font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络，在探索阶段，在生成数据集上的特点。</font></strong></p>\n<p>在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心不行。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps &gt; pre_train_steps:</span><br><span class=\"line\"><span class=\"keyword\">if</span> e &gt; endE:</span><br><span class=\"line\">e -= stepDrop</span><br><span class=\"line\"><span class=\"comment\">### 完全随机了之后，开始慢慢减小随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验</span></span><br><span class=\"line\"><span class=\"comment\">### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。</span></span><br><span class=\"line\"><span class=\"comment\">### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性</span></span><br><span class=\"line\"><span class=\"comment\">###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的</span></span><br></pre></td></tr></table></figure>\n<p>下面的代码是将在数据集弄好的情况下，如何训练模型的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps % (update_freq) == <span class=\"number\">0</span>:</span><br><span class=\"line\">trainBatch = myBuffer.sample(batch_size) <span class=\"comment\">#Get a random batch of experiences.</span></span><br><span class=\"line\"><span class=\"comment\">#Below we perform the Double-DQN update to the target Q-values</span></span><br><span class=\"line\"><span class=\"comment\"># 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境</span></span><br><span class=\"line\"><span class=\"comment\"># 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action</span></span><br><span class=\"line\">Q1 = sess.run(mainQN.predict,feed_dict=&#123;mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])&#125;)</span><br><span class=\"line\"><span class=\"comment\"># target网络预测了下一时刻的reward</span></span><br><span class=\"line\">Q2 = sess.run(targetQN.Qout,feed_dict=&#123;targetQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])&#125;)</span><br><span class=\"line\">end_multiplier = -(trainBatch[:,<span class=\"number\">4</span>] - <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用主网络预测出的Action以及target网络预测出的所有行为的reward</span></span><br><span class=\"line\"><span class=\"comment\"># 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)</span></span><br><span class=\"line\">doubleQ = Q2[<span class=\"built_in\">range</span>(batch_size),Q1]</span><br><span class=\"line\"><span class=\"comment\"># 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward</span></span><br><span class=\"line\">targetQ = trainBatch[:,<span class=\"number\">2</span>] + (y*doubleQ * end_multiplier)</span><br><span class=\"line\"><span class=\"comment\">#Update the network with our target values.</span></span><br><span class=\"line\"><span class=\"comment\"># 公式右边得到了之后，在把真正的当前状态输入进去，得到左边</span></span><br><span class=\"line\"><span class=\"comment\"># 左边以右边作为标签进行学习。更新主网络的参数</span></span><br><span class=\"line\">_ = sess.run(mainQN.updateModel, \\</span><br><span class=\"line\">feed_dict=&#123;mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">0</span>]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,<span class=\"number\">1</span>]&#125;)</span><br><span class=\"line\"><span class=\"comment\"># 更新target网络的参数。</span></span><br><span class=\"line\">updateTarget(targetOps,sess) <span class=\"comment\">#Update the target network toward the primary network.</span></span><br></pre></td></tr></table></figure>\n<p>target 网络参数的更新方式代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTargetGraph</span>(<span class=\"params\">tfVars,tau</span>):</span></span><br><span class=\"line\">total_vars = <span class=\"built_in\">len</span>(tfVars)</span><br><span class=\"line\">op_holder = []</span><br><span class=\"line\"><span class=\"comment\"># 主网络是和target网络一样的，前一半参数正好是主网络的参数</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> idx,var <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tfVars[<span class=\"number\">0</span>:total_vars//<span class=\"number\">2</span>]):</span><br><span class=\"line\"><span class=\"comment\"># idx+total_vars对应的时候后一半的参数也就是target网络的参数</span></span><br><span class=\"line\"><span class=\"comment\"># 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数</span></span><br><span class=\"line\"><span class=\"comment\"># 也就是说target网络在以一定的速度向主网络靠近</span></span><br><span class=\"line\"><span class=\"comment\"># 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式</span></span><br><span class=\"line\"><span class=\"comment\"># 右边的值，即标签，即使是等式右边，也不是target网络完全决定的</span></span><br><span class=\"line\"><span class=\"comment\"># target网络得到了所有Action的reward，最大的Action是主网络选择的</span></span><br><span class=\"line\"><span class=\"comment\"># 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边</span></span><br><span class=\"line\"><span class=\"comment\"># 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络</span></span><br><span class=\"line\"><span class=\"comment\"># 是出于优化的考虑。我们后面叙述。</span></span><br><span class=\"line\">op_holder.append(tfVars[idx+total_vars//<span class=\"number\">2</span>].assign\\\\</span><br><span class=\"line\">((var.value()*tau) \\\\</span><br><span class=\"line\">                      + ((<span class=\"number\">1</span>-tau)*tfVars[idx+total_vars//<span class=\"number\">2</span>].value())))</span><br><span class=\"line\">                      <span class=\"keyword\">return</span> op_holder</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTarget</span>(<span class=\"params\">op_holder,sess</span>):</span></span><br><span class=\"line\">                      <span class=\"keyword\">for</span> op <span class=\"keyword\">in</span> op_holder:</span><br><span class=\"line\">                      sess.run(op)</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```</span><br><span class=\"line\"></span><br><span class=\"line\">                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"number\">1.</span>  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。</span><br><span class=\"line\">                      <span class=\"number\">2.</span>  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=<span class=\"number\">1</span>而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。</span><br><span class=\"line\">                      <span class=\"number\">3.</span>  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。</span><br><span class=\"line\">                      <span class=\"number\">4.</span>  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。</span><br><span class=\"line\">                      <span class=\"number\">5.</span>  Dueling DQN。上代码</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```python</span><br><span class=\"line\">                      self.AW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,env.actions]))</span><br><span class=\"line\">                      self.VW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,<span class=\"number\">1</span>]))</span><br><span class=\"line\">                      self.Advantage = tf.matmul(self.streamA,self.AW)</span><br><span class=\"line\">                      self.Value = tf.matmul(self.streamV,self.VW)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###Then combine them together to get our final Q-values.</span></span><br><span class=\"line\"><span class=\"comment\">### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage</span></span><br><span class=\"line\"><span class=\"comment\">### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量</span></span><br><span class=\"line\"><span class=\"comment\">### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value</span></span><br><span class=\"line\"><span class=\"comment\">### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。</span></span><br><span class=\"line\"><span class=\"comment\">### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。</span></span><br><span class=\"line\"><span class=\"comment\">###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑</span></span><br><span class=\"line\"><span class=\"comment\">### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现</span></span><br><span class=\"line\"><span class=\"comment\">### 优化的好了。其实谁也不知道其中到底是什么原因起作用。</span></span><br><span class=\"line\">self.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=<span class=\"number\">1</span>,keep_dims=<span class=\"literal\">True</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"策略网络和估值网络的不同\"><a class=\"markdownIt-Anchor\" href=\"#策略网络和估值网络的不同\"></a> 策略网络和估值网络的不同</h4>\n<p>从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在于对抗的方法。</p>\n<ol>\n<li>策略网络：对抗的焦点在于选择 Action 的概率。</li>\n<li>估值网络：对抗的焦点在于评估 Action 的 reward。</li>\n<li>两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索</li>\n<li>比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个 Action 的 reward 的时候，和其他 Action 是无关的。<strong>而且其实不能说是提高 reward，它是预测出正确的 reward。</strong>（这是两者的很大的不同处，策略网络更像是一个分类问题，而估值网络像是一个回归问题）</li>\n</ol>\n<h3 id=\"回顾\"><a class=\"markdownIt-Anchor\" href=\"#回顾\"></a> 回顾</h3>\n<p>强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。</p>\n<p>连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的问题，做了标签，让问题可以解决。</p>\n<p>深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签，把它转换为可导的，可用 sgd 优化的问题。</p>\n<p>做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自用，保持谦卑，给新的可能保留空间。</p>\n<p>无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是隐式的利用探索和贪心）。</p>\n<p>策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在我得感觉上更加符合强化两个字。强化好的行为嘛。</p>\n<p>估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r + <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感觉。</p>\n<p>策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。而估值网络的数据集是单个单个的。</p>\n<p>由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和下一状态。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> done:</span><br><span class=\"line\">episode_number += <span class=\"number\">1</span></span><br><span class=\"line\">epx = np.vstack(xs)</span><br><span class=\"line\">epy = np.vstack(ys)</span><br><span class=\"line\">epr = np.vstack(drs)</span><br><span class=\"line\">tfp = tfps</span><br><span class=\"line\">xs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]</span><br><span class=\"line\"></span><br><span class=\"line\">discounted_epr = discount_rewards(epr)</span><br><span class=\"line\">discounted_epr -= np.mean(discounted_epr)</span><br><span class=\"line\">discounted_epr //= np.std(discounted_epr)</span><br><span class=\"line\"></span><br><span class=\"line\">tGrad = sess.run(newGrads,feed_dict=&#123;observations: epx, input_y: epy, advantages: discounted_epr&#125;)</span><br><span class=\"line\"><span class=\"keyword\">for</span> ix,grad <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tGrad):</span><br><span class=\"line\">gradBuffer[ix] += grad</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> episode_number % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">sess.run(updateGrads,feed_dict=&#123;W1Grad: gradBuffer[<span class=\"number\">0</span>],W1_1Grad:gradBuffer[<span class=\"number\">1</span>],W2Grad:gradBuffer[<span class=\"number\">2</span>]&#125;)</span><br></pre></td></tr></table></figure>\n<p>估值网络人为的控制随机强度，也是一个值得考虑的问题。</p>\n"},{"title":"Foundation for Topological Data Analysis","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-30T01:07:39.000Z","password":null,"summary":null,"description":"拓扑数据分析的数学基础。","_content":"\n# 持续同调\n\n## 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。\n\n要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的3个基本事实。根据这3个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭链，边缘算子，同调等，为什么这样定义。\n\n1. 任意一个q维单纯形是“实心的”，没有空洞的。所以所有q维丹村行的边缘链，以及边缘链的线性组合，都是同调的（等价的），因为都没有空洞。\n2. 如果拓扑结构中有一个q维空洞，那么它一定是一个空心的q维单纯形, i.e., 复形中不含该q维单纯形，但含有该单纯形的所有q-1维边缘。\n3. 如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否则它不是闭链。\n\n由2和3可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。\n\n## 边缘算子的定义\n\n为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑结构中的空洞，具体怎么样定义边缘算子是无所谓的。\n\n## 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调\n\n再说明一个事实\n\n4. 包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面3个事实可以推出4）\n\n现有的同调里面里面的定义都是满足这4个事实的，应该能对链进行分类，分类的依据是它们包含空洞的不同。\n\n## 对闭链的直观理解\n\n闭链被定义为在边缘算子下结果为0的链。但从思维的角度来说，与其说闭链依赖边缘算子，不如说是边缘算子是为了满足闭链的性质3，而设计的。\n\n知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。\n\n根据3可知任意一个q维闭链一定是q+1维的空心或者实心单纯形的边缘，或其线性组合。\n\n给定一个q维闭链，它一定，而且只能把q+1维空间分割成不相交的若干区域。它是在q+1维空间中封闭的，里面的点和外面的点无法连通。\n\n一个q维的链，只能围城q+1维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维的空洞。\n","source":"_posts/Foundation-for-Topological-Data-Analysis.md","raw":"---\ntitle: Foundation for Topological Data Analysis\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-30 09:07:39\npassword:\nsummary:\ndescription: 拓扑数据分析的数学基础。\ncategories:\n- Topological Data Analysis\ntags:\n- Topological Data Analysis \n---\n\n# 持续同调\n\n## 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。\n\n要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的3个基本事实。根据这3个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭链，边缘算子，同调等，为什么这样定义。\n\n1. 任意一个q维单纯形是“实心的”，没有空洞的。所以所有q维丹村行的边缘链，以及边缘链的线性组合，都是同调的（等价的），因为都没有空洞。\n2. 如果拓扑结构中有一个q维空洞，那么它一定是一个空心的q维单纯形, i.e., 复形中不含该q维单纯形，但含有该单纯形的所有q-1维边缘。\n3. 如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否则它不是闭链。\n\n由2和3可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。\n\n## 边缘算子的定义\n\n为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑结构中的空洞，具体怎么样定义边缘算子是无所谓的。\n\n## 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调\n\n再说明一个事实\n\n4. 包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面3个事实可以推出4）\n\n现有的同调里面里面的定义都是满足这4个事实的，应该能对链进行分类，分类的依据是它们包含空洞的不同。\n\n## 对闭链的直观理解\n\n闭链被定义为在边缘算子下结果为0的链。但从思维的角度来说，与其说闭链依赖边缘算子，不如说是边缘算子是为了满足闭链的性质3，而设计的。\n\n知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。\n\n根据3可知任意一个q维闭链一定是q+1维的空心或者实心单纯形的边缘，或其线性组合。\n\n给定一个q维闭链，它一定，而且只能把q+1维空间分割成不相交的若干区域。它是在q+1维空间中封闭的，里面的点和外面的点无法连通。\n\n一个q维的链，只能围城q+1维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维的空洞。\n","slug":"Foundation-for-Topological-Data-Analysis","published":1,"updated":"2022-03-16T08:52:14.762Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1hz000dgqul776ya2z1","content":"<html><head></head><body><h1 id=\"持续同调\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#持续同调\"></a> 持续同调</h1>\n<h2 id=\"同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"></a> 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。</h2>\n<p>要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的3个基本事实。根据这3个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭链，边缘算子，同调等，为什么这样定义。</p>\n<ol>\n<li>任意一个q维单纯形是“实心的”，没有空洞的。所以所有q维丹村行的边缘链，以及边缘链的线性组合，都是同调的（等价的），因为都没有空洞。</li>\n<li>如果拓扑结构中有一个q维空洞，那么它一定是一个空心的q维单纯形, i.e., 复形中不含该q维单纯形，但含有该单纯形的所有q-1维边缘。</li>\n<li>如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否则它不是闭链。</li>\n</ol>\n<p>由2和3可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。</p>\n<h2 id=\"边缘算子的定义\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#边缘算子的定义\"></a> 边缘算子的定义</h2>\n<p>为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑结构中的空洞，具体怎么样定义边缘算子是无所谓的。</p>\n<h2 id=\"上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"><span class=\"post-title-index\">1.3. </span><a class=\"markdownIt-Anchor\" href=\"#上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"></a> 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调</h2>\n<p>再说明一个事实</p>\n<ol start=\"4\">\n<li>包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面3个事实可以推出4）</li>\n</ol>\n<p>现有的同调里面里面的定义都是满足这4个事实的，应该能对链进行分类，分类的依据是它们包含空洞的不同。</p>\n<h2 id=\"对闭链的直观理解\"><span class=\"post-title-index\">1.4. </span><a class=\"markdownIt-Anchor\" href=\"#对闭链的直观理解\"></a> 对闭链的直观理解</h2>\n<p>闭链被定义为在边缘算子下结果为0的链。但从思维的角度来说，与其说闭链依赖边缘算子，不如说是边缘算子是为了满足闭链的性质3，而设计的。</p>\n<p>知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。</p>\n<p>根据3可知任意一个q维闭链一定是q+1维的空心或者实心单纯形的边缘，或其线性组合。</p>\n<p>给定一个q维闭链，它一定，而且只能把q+1维空间分割成不相交的若干区域。它是在q+1维空间中封闭的，里面的点和外面的点无法连通。</p>\n<p>一个q维的链，只能围城q+1维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维的空洞。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"持续同调\"><a class=\"markdownIt-Anchor\" href=\"#持续同调\"></a> 持续同调</h1>\n<h2 id=\"同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"><a class=\"markdownIt-Anchor\" href=\"#同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"></a> 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。</h2>\n<p>要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的3个基本事实。根据这3个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭链，边缘算子，同调等，为什么这样定义。</p>\n<ol>\n<li>任意一个q维单纯形是“实心的”，没有空洞的。所以所有q维丹村行的边缘链，以及边缘链的线性组合，都是同调的（等价的），因为都没有空洞。</li>\n<li>如果拓扑结构中有一个q维空洞，那么它一定是一个空心的q维单纯形, i.e., 复形中不含该q维单纯形，但含有该单纯形的所有q-1维边缘。</li>\n<li>如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否则它不是闭链。</li>\n</ol>\n<p>由2和3可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。</p>\n<h2 id=\"边缘算子的定义\"><a class=\"markdownIt-Anchor\" href=\"#边缘算子的定义\"></a> 边缘算子的定义</h2>\n<p>为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑结构中的空洞，具体怎么样定义边缘算子是无所谓的。</p>\n<h2 id=\"上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"><a class=\"markdownIt-Anchor\" href=\"#上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"></a> 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调</h2>\n<p>再说明一个事实</p>\n<ol start=\"4\">\n<li>包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面3个事实可以推出4）</li>\n</ol>\n<p>现有的同调里面里面的定义都是满足这4个事实的，应该能对链进行分类，分类的依据是它们包含空洞的不同。</p>\n<h2 id=\"对闭链的直观理解\"><a class=\"markdownIt-Anchor\" href=\"#对闭链的直观理解\"></a> 对闭链的直观理解</h2>\n<p>闭链被定义为在边缘算子下结果为0的链。但从思维的角度来说，与其说闭链依赖边缘算子，不如说是边缘算子是为了满足闭链的性质3，而设计的。</p>\n<p>知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。</p>\n<p>根据3可知任意一个q维闭链一定是q+1维的空心或者实心单纯形的边缘，或其线性组合。</p>\n<p>给定一个q维闭链，它一定，而且只能把q+1维空间分割成不相交的若干区域。它是在q+1维空间中封闭的，里面的点和外面的点无法连通。</p>\n<p>一个q维的链，只能围城q+1维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维的空洞。</p>\n"},{"title":"How to Blance Losses in Multi Task Training","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2022-01-10T06:34:19.000Z","password":null,"summary":null,"description":"在多任务模型中，如何平衡多个 loss 函数。","_content":"\n# 论文中有的方法\n\nTask Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nMulti-Task Learning as Multi-Objective Optimization\n\nMulti-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nBounding Box Regression with Uncertainty for Accurate Object Detection\n\n这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各个 loss 分量当前的大小自动设定其权重。\n\n# 利用 Focal loss\n\nDynamic Task Prioritization for Multitask Learning\n\n这里主要想讲的是利用 focal loss 的方法，比较简单。\n\n每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务的准确率，kpi 越高说明这个任务完成得越好。\n\n对于每个进来的 batch，每个$Task_i$ 有个 $loss_i$。每个 Task i 还有个不同的 $KPI: k_i$。\n那根据 Focal loss 的定义，$FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)$。一般来说我们 $\\gamma$ 取 2。\n\n最后 $loss = \\sum(FL(k_i, \\gamma_i) * loss_i)$，loss 前面乘以得这个系数 FL，就是一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，当任务完成得不好的时候，权重就会比较大。\n","source":"_posts/How-to-Blance-Losses-in-Multi-Task-Training.md","raw":"---\ntitle: How to Blance Losses in Multi Task Training\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2022-01-10 14:34:19\npassword:\nsummary:\ndescription: 在多任务模型中，如何平衡多个 loss 函数。\ncategories:\n  - Little Things\n\ntags:\n  - Multi Task Training\n---\n\n# 论文中有的方法\n\nTask Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nMulti-Task Learning as Multi-Objective Optimization\n\nMulti-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nBounding Box Regression with Uncertainty for Accurate Object Detection\n\n这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各个 loss 分量当前的大小自动设定其权重。\n\n# 利用 Focal loss\n\nDynamic Task Prioritization for Multitask Learning\n\n这里主要想讲的是利用 focal loss 的方法，比较简单。\n\n每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务的准确率，kpi 越高说明这个任务完成得越好。\n\n对于每个进来的 batch，每个$Task_i$ 有个 $loss_i$。每个 Task i 还有个不同的 $KPI: k_i$。\n那根据 Focal loss 的定义，$FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)$。一般来说我们 $\\gamma$ 取 2。\n\n最后 $loss = \\sum(FL(k_i, \\gamma_i) * loss_i)$，loss 前面乘以得这个系数 FL，就是一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，当任务完成得不好的时候，权重就会比较大。\n","slug":"How-to-Blance-Losses-in-Multi-Task-Training","published":1,"updated":"2022-03-16T11:28:42.497Z","_id":"cl0thb1i1000hgqul1can83ic","comments":1,"layout":"post","photos":[],"link":"","content":"<html><head></head><body><h1 id=\"论文中有的方法\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#论文中有的方法\"></a> 论文中有的方法</h1>\n<p>Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Multi-Task Learning as Multi-Objective Optimization</p>\n<p>Multi-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Bounding Box Regression with Uncertainty for Accurate Object Detection</p>\n<p>这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各个 loss 分量当前的大小自动设定其权重。</p>\n<h1 id=\"利用-focal-loss\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#利用-focal-loss\"></a> 利用 Focal loss</h1>\n<p>Dynamic Task Prioritization for Multitask Learning</p>\n<p>这里主要想讲的是利用 focal loss 的方法，比较简单。</p>\n<p>每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务的准确率，kpi 越高说明这个任务完成得越好。</p>\n<p>对于每个进来的 batch，每个<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi><mi>a</mi><mi>s</mi><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Task_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 有个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">loss_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。每个 Task i 还有个不同的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi><mi>P</mi><mi>I</mi><mo>:</mo><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">KPI: k_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathdefault\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。\n那根据 Focal loss 的定义，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><msub><mi>γ</mi><mi>i</mi></msub></msup><mo>∗</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.05556em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。一般来说我们 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span> 取 2。</p>\n<p>最后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>∗</mo><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">loss = \\sum(FL(k_i, \\gamma_i) * loss_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，loss 前面乘以得这个系数 FL，就是一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，当任务完成得不好的时候，权重就会比较大。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"论文中有的方法\"><a class=\"markdownIt-Anchor\" href=\"#论文中有的方法\"></a> 论文中有的方法</h1>\n<p>Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Multi-Task Learning as Multi-Objective Optimization</p>\n<p>Multi-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Bounding Box Regression with Uncertainty for Accurate Object Detection</p>\n<p>这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各个 loss 分量当前的大小自动设定其权重。</p>\n<h1 id=\"利用-focal-loss\"><a class=\"markdownIt-Anchor\" href=\"#利用-focal-loss\"></a> 利用 Focal loss</h1>\n<p>Dynamic Task Prioritization for Multitask Learning</p>\n<p>这里主要想讲的是利用 focal loss 的方法，比较简单。</p>\n<p>每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务的准确率，kpi 越高说明这个任务完成得越好。</p>\n<p>对于每个进来的 batch，每个<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi><mi>a</mi><mi>s</mi><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Task_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 有个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">loss_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。每个 Task i 还有个不同的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi><mi>P</mi><mi>I</mi><mo>:</mo><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">KPI: k_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathdefault\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。\n那根据 Focal loss 的定义，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><msub><mi>γ</mi><mi>i</mi></msub></msup><mo>∗</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.05556em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。一般来说我们 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span> 取 2。</p>\n<p>最后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>∗</mo><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">loss = \\sum(FL(k_i, \\gamma_i) * loss_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，loss 前面乘以得这个系数 FL，就是一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，当任务完成得不好的时候，权重就会比较大。</p>\n"},{"title":"Personal Thought","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-15T08:01:28.000Z","password":null,"summary":null,"description":"记录自己在学术方面的一些想法。","_content":"\n\n\n# Deep Learning\n\n## 泛化性能\n\n### 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。\n\n深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。\n\n在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。\n\n这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。\n\n比如，如果点A处函数值为1，那么把A翻转，函数值也为1。这是源于目标识别常识的先验。\n\n数据增广方法mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个先验。在样本之间，函数线性变换好。\n\n所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的设计。\n\n比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。\n\n**设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在MNIST, CIFAR-10等数据集上都达到100%准确率的函数。我们总结这些函数曲面有什么特点，光不光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变），而这种对称性，就是真实图像对应的理想函数所具有的。**\n\n洞察真实数据是什么样的，是提高模型泛化能力的最终途径。\n\n### neural tangent kernel\n\n**最新有论文表示[^1]，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值得探索。**\n\n[^1]:NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION\n\n\n\n## 高次非线性与注意力机制\n\n### 特征图乘法\n\n特征图乘法会带来高次非线性。如果把ResNet里面的加法改成乘法。\n\n```python\nshortcut(x) + out\n# 修改为\nshortcut(x) * out\n```\n\n**可以从两个角度这个乘法**\n\n1. 把 高次非线性，引入到CNN中\n2. 把ResNet的分支做成一个3D的mask，形成一种无参数增加的attention module\n\n### 和数据集有关\n\n在有的数据集上效果挺好，比如Cifar-100。但是即使在Cifar-10上表现都一般。\n\n### 和优化有关？和表达的曲面性质有关？\n\n原因可能有两个\n\n1. 这样做乘法太粗糙，确实表达能力不行\n2. 优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。\n\n现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。\n\n为了减少优化上的缺陷。尝试过几种方法\n\n1. 为两端加bn。``bn(shortcut(x)) * bn(out)``\n\n2. 把bn的bias设置为1，保证bn(shortcut(x))和bn(out)的均值都是1，这样可以产生比较稳定的梯度。这个想法是源于 \n\n    **1. 原始的shortcut(x) + out。相当于shortcut(x)乘以了一个1的因子，out也乘以了一个1的因子。**\n\n   **2. 保持恒等映射。当out 是0的时候shorcut可以容易的实现恒等映射。**\n\n### sigmoid容易饱和？\n\n3. 像attention一样，把一边或者两边都用sigmoid函数。``bn(shortcut(x)) * out.sigmoid()``。这样的话，效果也不是很好，而且发现sigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的太快的感觉，所以陷入的局部最优点。猜想这是因为sigmoid函数太容易饱和了。\n4. soft attention经常利用sigmoid函数，是否也存在过饱和的情况。为什么它没有出现过饱和现象。1. 用的不多？ 2. 因为是2d或者1d的？就拿SE-Net举例，每个像素点其实也都是乘以了attention的。只是空间乘以的是同一个attention。\n\n\n\n","source":"_posts/Personal-Thought.md","raw":"---\ntitle: Personal Thought\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-15 16:01:28\npassword:\nsummary:\ndescription: 记录自己在学术方面的一些想法。\ncategories:\n- About Papers\ntags:\n- Personal Thought\n- Papers\n- private\n---\n\n\n\n# Deep Learning\n\n## 泛化性能\n\n### 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。\n\n深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。\n\n在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。\n\n这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。\n\n比如，如果点A处函数值为1，那么把A翻转，函数值也为1。这是源于目标识别常识的先验。\n\n数据增广方法mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个先验。在样本之间，函数线性变换好。\n\n所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的设计。\n\n比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。\n\n**设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在MNIST, CIFAR-10等数据集上都达到100%准确率的函数。我们总结这些函数曲面有什么特点，光不光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变），而这种对称性，就是真实图像对应的理想函数所具有的。**\n\n洞察真实数据是什么样的，是提高模型泛化能力的最终途径。\n\n### neural tangent kernel\n\n**最新有论文表示[^1]，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值得探索。**\n\n[^1]:NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION\n\n\n\n## 高次非线性与注意力机制\n\n### 特征图乘法\n\n特征图乘法会带来高次非线性。如果把ResNet里面的加法改成乘法。\n\n```python\nshortcut(x) + out\n# 修改为\nshortcut(x) * out\n```\n\n**可以从两个角度这个乘法**\n\n1. 把 高次非线性，引入到CNN中\n2. 把ResNet的分支做成一个3D的mask，形成一种无参数增加的attention module\n\n### 和数据集有关\n\n在有的数据集上效果挺好，比如Cifar-100。但是即使在Cifar-10上表现都一般。\n\n### 和优化有关？和表达的曲面性质有关？\n\n原因可能有两个\n\n1. 这样做乘法太粗糙，确实表达能力不行\n2. 优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。\n\n现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。\n\n为了减少优化上的缺陷。尝试过几种方法\n\n1. 为两端加bn。``bn(shortcut(x)) * bn(out)``\n\n2. 把bn的bias设置为1，保证bn(shortcut(x))和bn(out)的均值都是1，这样可以产生比较稳定的梯度。这个想法是源于 \n\n    **1. 原始的shortcut(x) + out。相当于shortcut(x)乘以了一个1的因子，out也乘以了一个1的因子。**\n\n   **2. 保持恒等映射。当out 是0的时候shorcut可以容易的实现恒等映射。**\n\n### sigmoid容易饱和？\n\n3. 像attention一样，把一边或者两边都用sigmoid函数。``bn(shortcut(x)) * out.sigmoid()``。这样的话，效果也不是很好，而且发现sigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的太快的感觉，所以陷入的局部最优点。猜想这是因为sigmoid函数太容易饱和了。\n4. soft attention经常利用sigmoid函数，是否也存在过饱和的情况。为什么它没有出现过饱和现象。1. 用的不多？ 2. 因为是2d或者1d的？就拿SE-Net举例，每个像素点其实也都是乘以了attention的。只是空间乘以的是同一个attention。\n\n\n\n","slug":"Personal-Thought","published":1,"updated":"2022-03-16T08:52:14.770Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1i2000jgquldqobh02f","content":"<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"a271ce8adee9341878228b054778edb7cde3c2e878b4974b9423a5b237e34bd9\">66852511a631ad87fd1101c971fa7f213c692e7d123cbcb307d59697d2f247f74c8510b10e447ea1d6daedc6fc12b2ef470f29f5667e64b261580bbb685ec915ef4413ce46132f44bd5bf6de42f43081e58d40e21d0f2b6b4a08fb1497f5a54211db7a4265b1ed973aa660a650b1af067c767503f54917f88afeb9c0731960413963a96eea367ea6bcc7fe792c3656668954c20b543e50843dc43887f48f4376a0bce20d12fb10a470af387ecc92e1a16e37be2fd231372b7c0a10cd5312e0a2e98117890553264ffe1457bee6ddd5a1abcb19f794bff4c0a09db1865056b01e2a7afbbee73989cf332fca598b6d82048c6c8601a653ad624bc86884220b6f2653a084d972ec6d88b819d3f30c6f3ffafcb2bb3d510640eb4df5d3b3b1275d9eda74f9c11d6b2863afc5e0cf3a76d3f250b7c57735a56f32e2d24060edf417ba446ce0cf86ed7d9aa714cee7f8c9b5074bf357fbc7b11df9d37aca76cc1e4872fa31ca326b28e40139d2ccd6e8c03a55aa4f47d47061d38d29dd33c2cd24a28d3a644df72d538d2642f5814e09c95e9105f39d8f3bd947b8fb6557aab26aa4c500b1be5e33b9575127494a6f8638b3a5af07666c321647dfb5f9bf45ed0fce39b8c5a71cdbd83bc3b5f4c0a282f178a48279971fe06ac5d378157ac0037cbe1e9a8c7ea61a4ec6a2dc43f17e8248a4b86c101ec95e265e814ab7b705b2b43b0289663f342c6dd26b650dca4e8bacffaa02505671fa235d5b1eb900faf67bd3d359f258ab3d7813cb9640232bd7fc53dcd80594dee308144e0c9667d209bc402d72a25ec3cc84f1278ba00605475f15359d6689ee3a251c9661182041b4b5bb89a2b730d1b4cc7eecb2f5be4d93d512912e43da51cdad707a0c21e2aef059097d67c2b310022e42a5fe30addbd5830807a99779f56a4f87ce791955d2743abce30497a4c757adc62a40e628b47b1bddf147684738b87ba783a74bdaa31d5de3711459306e11b860610dc37e2562ba7a16b5668e2352a9caf2c434da727f08d243d09f26e043d87ee756980cc334fc90cae165f762994c7b90c76f267bc80bf5e6e4f1c0db54848a56295f42c5a9b7a53dd1d75489e55402a235b397b96da0bb4b1fa17052996c1b67b6f2acadcb6c569284c202fd357566b6c47b6fcf7dbdebe3bee053852d8282eda95e7fe66dfce4ded1d1f7ca5517e1a2948518c4d8db40924bea0f0ea84ebf46c31ee2db47b8a938518f2cd46c9ff8ec1d4420e11b4fcf98a5c6ce53298b624b4d733040c9dae9e6a335b1a3971fa2e085f2e8f4ddf75b55df4eeded0412c7842fa030cec3ff08ca4176bc72713485e953c2f1aa322d7c0aafdb8154a8218cfbabf1fc0f1b3ac5a4064d98b88b0be679cca56631479376135bb93c5964584c9aa46c16d8d9d876986e44f96dd38f8f44f64b0d71123a6a5a640d09813a28816e4f009202561f1a2719763547558a15e446806d14cf48f98601fe6f2d2c04ec10e227a138ca34fd922a25254c466e4ca93555004a7fab70ec1bd60effad4febb4692c8fd6f883ec87474b33ab5fb0fcc99cb1cf69522becffc40a02c31171ff010bc6c883fa0691ad6dacd58b77145ce5a676943061c8d5fde494bc856db5f01e8253731c683b6b0d3a387f36cbf57ad1a37bbb106db24f21d50b71d120ad1dedd717a56e308ab5544eb3708f30a45eb38a64c7187b966f02ae7b9b3d4e4fe9dcfcda22b25c10182b6cf4ea51954b3b847c9c02b63629f98efd1bd9711a51a00abbc104ec851cdd39c1d4890a8dc5ae000b36cbe351e262a2db0d53e732b8750278b3dcc78e0c6d70dc6f503b1682fd9dd5fa17ef6f802a1f7d9e3b97dd54ca95efcea034d6dd6d5598caedbcda2a31a6a71aa67ef81bd94479151ac54f650a1353f49afa83bb15baa7082f6c33bdd5a716ac4dec4b154b94cc26c9a1c5c3df196ec7034231f64a8ab907101562c8bd3c8f05e8573d6ac490d091226f4018eecb12fc1e8631dd1a5f4e5f5a92614c1e16c139d78ed4b6e6d5eab912fb44911813b612c560d71a5b374e283dc82b9e5231c8c8452adbf650b15272f5e18dce70adf6977a67d1956d3a40ba47942a46a6a4e0386dec8b4af04dd1c0181ed483e399f4b1400471fdaffb3763aa6b61ca47968060e96e7926d246c237e007c3f288a171bb9dbaa4ff64c5c247430e2ce837ba0522eb98ec9989a62e7f6bfa7f5f7c106b6b3e081259652e3b1f4a3e511532eefbf885dc8849acc9a075eadf92e4e810cafdefbbb4a104fab3ad8f853579462ed735b931012871f9fb83dac84052aab4c7cd0232c8463d890d0002cae582ad4196532e046d764259e35046c84f3a1e469d44159f9d2b04085d43046f90c24c7add06a9c85286c2a210621676f6105547a413bbea870e7d4fdb51d9ce65aae7e4f0f625d20f1c95a42397da70291c9ffd88e87f42bc2940d78c5e65d0d81436405c65b2bbcb2e91b7de148d43cf2cabb0ddb296eb2d91a52f6594b27f535feae68c202eeb0f900d62ecd623409f01301d4d38721172c1d2d429693880dfb97cda37d9c452392b323fedd7a0d922ca618422960d7d3271f882ffb0d6cfd220a7e5e359a4c07de41f0f21d26663aa1bc4da3ddf96412a340467062a13cb18fa9d66d103e942dd76aee320808c277b8d2637991e48f0a2b597633d21f1a27f15d69ab967ec331153c25b8d9f5d1476d8e67f7b0ff17fe651b0d54f53624646fa0ee55024d322ec4b7d7bec47ca0447da4011170275446b47efddc7400273249e34f0d447d0d895708d35680295a6529da05ce7796dcd4fd28390b25000d8568f83f480f3d3d1dce9def84e298bb755a9e2ab8049c8efc444124eee59bc247c162796e9c0e9be3a0b956e03fad9e60bc6a077ae279bc161f5923d60195dc030d80196ee70a7ab4385ad0008dd00bc368bbbb0f773f8e45fe223599d2b0b2c907903b1bdfea62a3cfb38a74996201dda685f8eebfc2ba670e1780d84ec167de308c5be3aad5dfaa276462ca6e7d01987d90a56feca31aac517935a2652dd750fbcc8d12bc6c995e6fba0eb3d9cc0bcd08a44c5ee89ac7fd24413838e77fab4a8bb9744872c3627d88d7174faeb3f721d93fdddd6aa7d29dad4085dec279703c7330cd2bd46e66eff8c8debdfa1ef93067732ccdab65fd1a77ca48a686fea7e409dd224afbee8a7d84f2755820ed1edcec9471fa4766292a111c3114782ce938f9a4884ff9767c79d6908c2ed1c68526cee7e2215f1d77ccc0ee9dcab254afbb3902ff3074cb421e0c8a7381105d702f67f34b17b8a28d95c372ded956987c6bfc9071e75e58cd6d8167667e8701c9a95f51a0f859aa7c9994d940de8128e12774d00c374466bd8a9edcbde420a755a3171d7bd46658b3b5cce8ea795bfb9342613a104d1f0c9ff148cfaf64ff086244807ff0c9ac3b206626eeb3ea025ab2f7962eaeaf9be0e7372683248cd3bebdae952bd0410deffc9c172ee17a168bc7fddd5b3bd123a685cced0351c7f2c38387ffba56120434d52be1d02314413a6df783ad4de392f01e54fc8c020f429327053846bf4743d8232647b310acf02f8978c54b4244cf6f14ddf1523a4123f054e96ca253bba3257fcfd0600075c6988acea0349d9503e77bd97da2052925b3d9a7459c5da6f70a505934cd64b45ea7a856ce3e65507886d6dc0e1ba400ef4aa981b1053ae6aa8e752d7af50371e7b3f387b871fd5c3340baa660befa638910f7f0992d22f4d5b5142c8ef4adc326aac47a2226b3824c20763e39ef9aa20af6b17879162368325e40a2a60d048a99da9acb9d336ab23626ae11e5fed2068d895f6c47779338fc6e80c374da4d7298daea2452ebb0a7ed5e7e0fa3dd5c1518089ad9753b226a04e877cdb8e9fd6861796113300b1890c6e51a5df4855e4be9b91a098664506377dddc3abd8ae54b3b5707915e5023737b9d47347da05c0985870e82ce60853f5dd7d0f785bdf45985493d8942c0771b257d90f38a88379e4c499fe875ee6c841eaac8114882c79fb173ed4508832d900d9c123686410ce6ea7a9e0dce9204fc05054cc9204caad90f63c539d320f89867b009b6a1a52cafbaf7cb1a577b04afcab7dfc49cf1e488aac46da85f30633998e1c593bce9529267b07f2c5f4374a4b6d6eb911443e3f3d11ba88fa668e261a0718ee043c5bc16c9c27902fdcbcdf3cf3759b449cb9b64e00d8f5aca6da6d377245c2974cf51ab29d4b13195524c4d7c58e7c273b1e9bf19bf9df480cb6392ab32b3cf7f3bae2c17ef7a51838f58160bf65f209782714a2fedd2178bd46671c9aa59f3ae8608e1cb1a755f7edeec267fe0e75bc39e41b042b91b2dc724a211e719887d6d27aae97e28c5771e5dc942e763f3da3ced4566389e5c1d812056b3c92770ab4c1c7cc5ca204340874abaeebadc5e5ff491f9a5a4119509a75b9f24e426bb25ab23151747e9ef4f5a32d20aae5ce971c17a2572825385fd7db141a49bbb8542399baec35e595f4fef7c8e0cf2f2701fcc314b66fa28bd16738f7cd69284da600fbbfc6e65d011aa0e45c8a4ab6e03c20861213082fc538e0563c3a085214b05323f628981bf26277d2ce8812fe4ebd4a8c66e6d202a5a79e9d36f29af9ac06162857530ceb59ee9411429cca228022d8a7fd50e8221f3da95c9490c752e017d59a6c014093d9aad2e8a61198a7f80a79f3df0c27b3a71ecd183ff0f76d45c2b417dbd06c169278e70d5d736f77bde30cbd6f09741642eb3f7b846bff66ea58bed919b26346675c1cd203fc6f3d536a40b5b9fbea478bb3d10bbc81f0f764ef1fa90430ed354e1a1e5c7e69a73bbed184af1644f3ff4a8eb6fe0b4fd10f21227f2ef75ecc106876dfa97777f8f77fc0393294dafe31de8fa2878ce31009e547fef037999394a735a48d900bd649d2b70335590c6363506c1a24086cd7c997a616c1a8408452586dced206b17e137bd734bba884c8486838b543ecab1d54fa016d1e0cf1adee5496d5cbb36904052f8e28584e15e362d87b94f65f52c79e22122949eaecc60a59e168607ebd79f348ea281ab00212e486ee4ba39aa36ddcc66f367f4b54c682f746dd0fb6707d9dd5491a1d6adb732c7ed87365d88cc1e295510d9997249b9f2730a07133a72ca3620a79a3301f6f6bbb28494b2cd79670f671b347e0b6014e01126810a5b5023705d6c48593fe134ee7b53727db68b795178aa3af0c6a9eec46aaba27afb5b943b87f56a38fde5f03260169a86a2447393ffe894410cb8587b32ce76e08f49d8307e3ec6bd1565a5758208cb3596f231e87efb089088897c0e1a9df35556a3bc32e3ad128994f651616760aa4fb1d46f5f6969fe7641c52ec4a89cf80c803a4e0de2276db1e209030bc62dd6ec9c5c55c646557fa5fd51f6eccb695b78b44cdf607c241835f73c6596abe838e11b5d19934d61fe73af7d7c732ddb08fc63a1174306a551b0ea13ae764fcbec1b6aa7aa931753fe974be1e35063de035e04648d3b0c9f35646db6425f8f17df4ceb4e65551720ce9a6a30ef20e7d3304e3a955faf05a178e0ecf5771b20da37b280304fa14c30dcfb1e304a58f02f4b208877e578be0399173b859ed708cb3eef6a2266bef98b0d9c3fa5fb1e50558db882fc0662acdddb5861b7c30244bd705c812c663ebb757f8c530fbdc7216500aefbcf77131b377550dfd4674f5f2618cc3a37f41bd31b74708a298ebec18eba1b54f63b854a93630076ec77aeedc67deab610e4ec98ce1465693128627dde221ec11bbce4a524d2c1f68327a4fc623f858c2586d9119874bd2331456545a6f68117fe0e4181f283b7811b4ed06f3c1a448d6fd8e0de68f3eab34673ae31499cc732c0229061eb0c118e9ecc79d2290486d85bae66380214ce430ca8f2b7777c3d08a77d1e872abee8e45454dc850ae7cbdfe7ba459b8d80f7e5a9677c156885d238d059a258718c6e72e377eefcadf6bd78bf2dc6e1802a1eacfdac64e9ac0cd3a4548d213f76f8fec0b8139cbb5f4f6e5e752408a29a96477576bfe59835cdf1ea79937348d4a2f11bd21a89dae6851bd1dd2d8be4ac45c3a95ea954de98aa0bcebe1dc66c9fcf9da9fb2f90356d60961fc5233c0e23579d609a3497b08efb1071ae64654c463e94df825c8e197199705bf6d80ac216d3a63c4ab2d9dbbbeae7998884fa2579cca61f5e007f8962a567ba567d8f19b3a0c712b75a308f98fa1413f41502cfc083f1fb2fe3734a98a89b66b690373791d7c0d3a7eaf8c20ddc2db934e1cb9625f0adfd377be929c74b5f3fd4af99e96d902d096e90d10976aa2132ef5cab351349941b44a3d1132fbe132f476801d5e12c10a8f24c4efdb809e25cda70d2502f6ef553a4f3f64f9bd3f6137e779f43e0fd47bbd31d199be75c8119c4294966edc68055b4ac8283d11d5c024b6ae8d4e882c9a169e02e2bdcaf02f3c02dee432efe703ca8da0fb317b73bc73d1ac53ed6e22036d682838c7676b2ce89834cdec9cfa75d9368f504fa20605deab7f07a545fd84c41e3f29f8612e9739cd86b667a35815bd399b3fe1a6bf98f1854f77d92547018a8344c19dc629b0e3aa15c8f9464559de3d29cfc02baf002a4ccb25ca68e794d2e0b33b63c5125218df9300fbeb1d753c0eeb678961ffb6e30f9e8e1f689bb80f94e2607da9902b5603e728f4b946e17617fcad1659877f46429673659bd0c05e094f5199b6e9c56308a01dd35fe41105c3c74e80d51438978f0a4e4f5d36794c75e38b96cb718f9bdd714f8cc2059668e75a5d2024534b2dd4e1ea06fae4bcd3430ca1d4a453db4fb8e6d962b32e69d5fc08ef2defef0a3f32e5f9d5ef3f50f99650a42fa91f9dc57f07070471e11a0f6af2c437daa8819a548e7ac098add3b5c35f1eb39036f870e79b87a9dc88a16528dea3a5c0b5c6f135915a524d8d7f50f290458b634a71f8fbaa3cb4e04af38bea9dbd6a5f310d14eec042c7e25d09126023188ad718a38f8cdca8035382902178169c32f5f1ded46b62d81eeeb3df8303608ac503bcbde67638c4fd56c94472655cedb8462aa35c31523269fcdf69171dbe3fd0bdf1b1b8c1d382f9c99dd8e073703881cdeb8cd68a8484470d928f52f6e81a584b9a058565ae7b0e4e49c1e2646cc1c505b0045680e0fe2114ed5d3fcd851e00ebbe468aef2631f7900df0f4f79ed93a19a28ac7ffcbcd0d290e0a3b62dcee6e0e4bfb1a318093556a8329a02d2849c7932fdea77c817c7986edd0ab97a3f0bab8301f5dab10f3800c73d5bd1492099de009b5a6a5056091460bfd58af639632bd9426dbe463cbda7d81a3e981fe36ff2df7d7f786f825b8c45e351fa4425a227517e9fbdc5d721c58a8dbf4e21a0618a79473f6bd0ad4692f68a817824b3b70c945135a57bd105c21c00f461cf2682ec0875d5ea7f5ea0d656505c95d668cd3e6e1846787ef4dfc5541b8acfa642d52542f5804d6ba1678d3c9639b1f25c51c99e7ffe6af6f22890389c471725e802662777f370cd719bb926180c0cd5433db438c8aeef8419a2e587646abb56a62f083b573544fc4f7e76d4944df76f3e1293844620e94ee4c48280bb996c0f99dcd029d60ef1cac646e702a776d9c1d7f83f13fdea2fa9ea0c79f4ec9d7ad56757022e9e21d56affba5ed5ea554f76b708710807fa9a0c352f92dd1d88ee541784a2ddce5d3dc0b11cdbc9b1d3792b3862c8620e55e0f4fd81f14c159366fa0005789694d5d4e5bd887ac975af160e471cb1a274cf1e10108075757fb1ce39dcd589db94f48b763e284ac19628960477760191fba3816680f0fc116db53c1e972c045a65a6fe5c0e22c325db0f5e21d747a6a235bc4d36a550466919f4a0de2fe01a849ee999e720c5f8d521e821da6493e8db709a54e01c1ff73e2693e703e60fe84b5a8b934d5043ce2b170ad32d01ca9de2136ddf7cba9a91ef71d19b9181fa7b1e26b545a74c79e271cd5e88017868f7750a24905b31adafcf43df4c86c507b6f611ee40c7dc154f2f755f477c11c754496eec34e47439bb9a224abee4e5c7db3231f1c5592e9c554793057f0aeafa74155a83aab48cc62553fda5577e706f09cbc77f65888fd99aa7e9c5b6ffd80f9bacbe4ec1f5d682162f1e50b089574a8d7acce702eba68ab367f9c7b7b18919c86b6b9715c07dd93e3412dbe8ed184c289e67042eaaa3c8434e424077ed63fbd6799ebd18f63d0854585b774fd0ed708ed693839234796317a3d18d2baf247094979b11615ac9fe3fb0a9e154c5309c3616a5bbd4ef5989e8be3bf0d3b0d3d2b9ec03fedbf14b14a8646e0dcb02c73db0b965cce8a8b63c781fbcf5844b35e18ce95ff9a1bb84769d930eee5ab3109647af1ef0719b71553f06faf35347d6d35c365afcc7c5ff2704ef509ef0a2b0ce1be4471a31936a1bd6a1285c4bdbc4c9fa1c00be84d217540180a442f70c5e8edf189b76de050e45f94bee13e7617674692528d2bb849f42ce9a8686708b4c306e19ea57eeca3292f370e51a0f8ae1b05a0f4933d7f2a4443b28be098c9bb53767964b2e12b87b3d65453ac50980e8f7f7be70554581080109d92d818a4751666423afeb858d4e8e6552e33a06ab8eabae415e014799bb3777efcc8084615dd69caa3ea4c5b3db46f04df0ea7ae07fd7275cb0efff5fa3e90892fe2768ee2cc7fa29817f2bfc3a47b4f7b7d7425a18bd77771530d20baa05f92c6330e08e9b9117b7b1192ac2d6883daf6be72538932628c79be4ee6480a60f3583c11810b23ff267327c290248646db38acc434d31f4cbe465f6ad7398c08ca3e11ac822cc585285fd6eac0caf64135ac766c1d09ee3fa01e88bb20ffcd1c91fa9cc05787b4e6c8c51503e2a1adc301d06191996a5e87912ee1d0c7b024d740c099522ba1d75e20c382c3a9422ebd2be880ea724eb22a083d1d69cee32c563068afffc8c9d4beb071621fe342b3b40c92fd3ba429f42268ef5137a3cfe2d6c4d2a72f966c0184071b07864a2fb9687af96c581e29faf3fe5afca88113268b802f6a8b4b97b149ee255691db303386a8c989799fa8429ad380c352267a04a98d670ac7d4a9100ebe1bcf4d713e7d90ceb15eaf82f8b4954b8b8fa0e22210f260244d9e8821fd7475c5a7ce3bbfe8e4f416d4256a5ccb825444f3640b8558285e8f93930bad6006a78cec88a2ac71a5ec714fa10096ca36f30678d167a5d2951149e46842e7065206c1784a4feca17c394710e3f4ceb56eb5ba9a9dcc957b87faf357a222a9964f2bdb2b4bf29d18e91dd400ac94a95f39e353f30b33fb0ae968b146e56ccc46013ee5e24e57623c91750d6122e1f6295a8c68bab9576a08c41b469e55748063c44b6e64a0d64636af557034667a8bb616ee67eb84e54579b5514ac050392792effc4ebbea98f8c80c025fd7316363c92bfbd7b5b4997a6460df6719442ccf7aada478c5237ecc78589498030989282e70c3262e9ce911ef6c1f99b8ba93154c357e373a781ff66744240ee02b15ce730060dacb51ce5b88d284391f9b5de29b522d71dfa7b19a633f1e7731c0</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">","site":{"data":{}},"excerpt":"这是一篇加密文章，需要密码才能继续阅读。","more":"这是一篇加密文章，需要密码才能继续阅读。","origin":"<html><head></head><body><h1 id=\"deep-learning\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#deep-learning\"></a> Deep Learning</h1>\n<h2 id=\"泛化性能\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#泛化性能\"></a> 泛化性能</h2>\n<h3 id=\"泛化性能的本质是什么样的拟合曲面是好的一定要依靠先验现实中曲面有哪些特点\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#泛化性能的本质是什么样的拟合曲面是好的一定要依靠先验现实中曲面有哪些特点\"></a> 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。</h3>\n<p>深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。</p>\n<p>在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。</p>\n<p>这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。</p>\n<p>比如，如果点A处函数值为1，那么把A翻转，函数值也为1。这是源于目标识别常识的先验。</p>\n<p>数据增广方法mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个先验。在样本之间，函数线性变换好。</p>\n<p>所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的设计。</p>\n<p>比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。</p>\n<p><strong>设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在MNIST, CIFAR-10等数据集上都达到100%准确率的函数。我们总结这些函数曲面有什么特点，光不光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变），而这种对称性，就是真实图像对应的理想函数所具有的。</strong></p>\n<p>洞察真实数据是什么样的，是提高模型泛化能力的最终途径。</p>\n<h3 id=\"neural-tangent-kernel\"><span class=\"post-title-index\">1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#neural-tangent-kernel\"></a> neural tangent kernel</h3>\n<p><strong>最新有论文表示<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值得探索。</strong></p>\n<h2 id=\"高次非线性与注意力机制\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#高次非线性与注意力机制\"></a> 高次非线性与注意力机制</h2>\n<h3 id=\"特征图乘法\"><span class=\"post-title-index\">1.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#特征图乘法\"></a> 特征图乘法</h3>\n<p>特征图乘法会带来高次非线性。如果把ResNet里面的加法改成乘法。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shortcut(x) + out</span><br><span class=\"line\"><span class=\"comment\"># 修改为</span></span><br><span class=\"line\">shortcut(x) * out</span><br></pre></td></tr></tbody></table></figure>\n<p><strong>可以从两个角度这个乘法</strong></p>\n<ol>\n<li>把 高次非线性，引入到CNN中</li>\n<li>把ResNet的分支做成一个3D的mask，形成一种无参数增加的attention module</li>\n</ol>\n<h3 id=\"和数据集有关\"><span class=\"post-title-index\">1.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#和数据集有关\"></a> 和数据集有关</h3>\n<p>在有的数据集上效果挺好，比如Cifar-100。但是即使在Cifar-10上表现都一般。</p>\n<h3 id=\"和优化有关和表达的曲面性质有关\"><span class=\"post-title-index\">1.2.3. </span><a class=\"markdownIt-Anchor\" href=\"#和优化有关和表达的曲面性质有关\"></a> 和优化有关？和表达的曲面性质有关？</h3>\n<p>原因可能有两个</p>\n<ol>\n<li>这样做乘法太粗糙，确实表达能力不行</li>\n<li>优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。</li>\n</ol>\n<p>现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。</p>\n<p>为了减少优化上的缺陷。尝试过几种方法</p>\n<ol>\n<li>\n<p>为两端加bn。<code>bn(shortcut(x)) * bn(out)</code></p>\n</li>\n<li>\n<p>把bn的bias设置为1，保证bn(shortcut(x))和bn(out)的均值都是1，这样可以产生比较稳定的梯度。这个想法是源于</p>\n<p><strong>1. 原始的shortcut(x) + out。相当于shortcut(x)乘以了一个1的因子，out也乘以了一个1的因子。</strong></p>\n<p><strong>2. 保持恒等映射。当out 是0的时候shorcut可以容易的实现恒等映射。</strong></p>\n</li>\n</ol>\n<h3 id=\"sigmoid容易饱和\"><span class=\"post-title-index\">1.2.4. </span><a class=\"markdownIt-Anchor\" href=\"#sigmoid容易饱和\"></a> sigmoid容易饱和？</h3>\n<ol start=\"3\">\n<li>像attention一样，把一边或者两边都用sigmoid函数。<code>bn(shortcut(x)) * out.sigmoid()</code>。这样的话，效果也不是很好，而且发现sigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的太快的感觉，所以陷入的局部最优点。猜想这是因为sigmoid函数太容易饱和了。</li>\n<li>soft attention经常利用sigmoid函数，是否也存在过饱和的情况。为什么它没有出现过饱和现象。1. 用的不多？ 2. 因为是2d或者1d的？就拿SE-Net举例，每个像素点其实也都是乘以了attention的。只是空间乘以的是同一个attention。</li>\n</ol>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","encrypt":true},{"title":"Shorcut on Linux","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2022-02-10T01:22:15.000Z","password":null,"summary":null,"description":"Describe the shortcuts of linux and how to set them","_content":"\n*Root in: I want to find out where the \"kill shortcut\", ctrl C, defined.\nI use `bind -P` to check the shortcuts. However, do not find ctrl C.\nThus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. \nHowever, `bind -P` lists the shortcuts of readline.*\n\nThere may be two kinds of shortcuts, in practice,\n* stty shortcuts\n* readline shortcuts\n\n# stty (set tty, set teletypewriter) #\n\nThe difference between shell, terminal and tty \n\ntty: Print the file name of the terminal connected to standard input.\n\nstty: change or print terminal characteristics, change and print terminal line settings.\n\nThey are related to terminal.\n\n* terminal = tty = text input/output environment\n* console = physical terminal\n* shell = command line interpreter\n\nThe input of terminal or tty will used by readline, but not always\nreadline.\n\n# gun readline - get a line from a user with editing #\n\n## Synopsis ##\n\n\n```c\n#include <stdio.h>\n#include <readline/readline.h>\n#include <readline/history.h>\n\nchar *\nreadline (const char *prompt)\n\n```\n\n\n## Description ##\n\n**readline will read a line from the terminal and return it, using\n*prompt* as a prompt.**\n\nIf prompt is NULL or the empty string, no prompt is issued.\nThe line returned is allocated with `malloc`; the caller must\nfree it when finished. The line returned has the final newline removed,\nso only the text of the line remains.\n\n## Return Value ##\n\nreadline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty,\nNULL is returned. If an EOF is read with a non-empty line, it is treated\nas a newline.\n\n## Initialization file ##\n\nReadline is customized by putting commands in an initialization file\n(the `inputrc` file). The name of this file is taken from the value of \nthe INPUTRC environment variable. If that variable is unset, the default\nis `~/.inputrc`. If that file does not exist or cannot be read, the\nultimate default is `/etc/inputrc`. \n\nWhen a program which uses the readline library starts up, the init\nfile is read, and the key bindings and variables are set. \n\nThere are only a few basic constructs allowed in the readline init file.\n\n1. Black lines are ignored.\n2. Lines beginning with a `#` are comments.\n3. Lines beginning with a `$` indicate conditional constructs.\n4. Other lines denote key bindings and variable settings.\n\n\n\nEach program using this library may add its own commands and bindings.\n\n\nFor example, placing\n```bash\nM-Control-u: universal-argment\n```\ninto the `inputrc` would make `M-C-u` execute the readline command\n`universal-argument`.\n\n# The difference of `help` and `man` on linux #\n\n`help` displays information about builtin shell commands.\n\n`man` is s system-wide documentation system that provides short\nreference manuals for individual commands, API functions, concepts,\nconfiguration file syntax, file formats. It is the traditional Unix\ndocumentation system.\n\nWe can get the information of `cd` by `help cd`, but not by `man cd`.\nWe can get the information of `git/nvim/stty` by `man git/nvim/stty`, but not by `help git/nvim/stty`.\n`cd` is a shell command and `git/nvim/stty` is linux projects. \n","source":"_posts/Shorcut-on-Linux.md","raw":"---\ntitle: Shorcut on Linux\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2022-02-10 09:22:15\npassword:\nsummary:\ndescription: Describe the shortcuts of linux and how to set them\ncategories:\n- Little Things\n- Linux\ntags:\n- Linux\n---\n\n*Root in: I want to find out where the \"kill shortcut\", ctrl C, defined.\nI use `bind -P` to check the shortcuts. However, do not find ctrl C.\nThus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. \nHowever, `bind -P` lists the shortcuts of readline.*\n\nThere may be two kinds of shortcuts, in practice,\n* stty shortcuts\n* readline shortcuts\n\n# stty (set tty, set teletypewriter) #\n\nThe difference between shell, terminal and tty \n\ntty: Print the file name of the terminal connected to standard input.\n\nstty: change or print terminal characteristics, change and print terminal line settings.\n\nThey are related to terminal.\n\n* terminal = tty = text input/output environment\n* console = physical terminal\n* shell = command line interpreter\n\nThe input of terminal or tty will used by readline, but not always\nreadline.\n\n# gun readline - get a line from a user with editing #\n\n## Synopsis ##\n\n\n```c\n#include <stdio.h>\n#include <readline/readline.h>\n#include <readline/history.h>\n\nchar *\nreadline (const char *prompt)\n\n```\n\n\n## Description ##\n\n**readline will read a line from the terminal and return it, using\n*prompt* as a prompt.**\n\nIf prompt is NULL or the empty string, no prompt is issued.\nThe line returned is allocated with `malloc`; the caller must\nfree it when finished. The line returned has the final newline removed,\nso only the text of the line remains.\n\n## Return Value ##\n\nreadline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty,\nNULL is returned. If an EOF is read with a non-empty line, it is treated\nas a newline.\n\n## Initialization file ##\n\nReadline is customized by putting commands in an initialization file\n(the `inputrc` file). The name of this file is taken from the value of \nthe INPUTRC environment variable. If that variable is unset, the default\nis `~/.inputrc`. If that file does not exist or cannot be read, the\nultimate default is `/etc/inputrc`. \n\nWhen a program which uses the readline library starts up, the init\nfile is read, and the key bindings and variables are set. \n\nThere are only a few basic constructs allowed in the readline init file.\n\n1. Black lines are ignored.\n2. Lines beginning with a `#` are comments.\n3. Lines beginning with a `$` indicate conditional constructs.\n4. Other lines denote key bindings and variable settings.\n\n\n\nEach program using this library may add its own commands and bindings.\n\n\nFor example, placing\n```bash\nM-Control-u: universal-argment\n```\ninto the `inputrc` would make `M-C-u` execute the readline command\n`universal-argument`.\n\n# The difference of `help` and `man` on linux #\n\n`help` displays information about builtin shell commands.\n\n`man` is s system-wide documentation system that provides short\nreference manuals for individual commands, API functions, concepts,\nconfiguration file syntax, file formats. It is the traditional Unix\ndocumentation system.\n\nWe can get the information of `cd` by `help cd`, but not by `man cd`.\nWe can get the information of `git/nvim/stty` by `man git/nvim/stty`, but not by `help git/nvim/stty`.\n`cd` is a shell command and `git/nvim/stty` is linux projects. \n","slug":"Shorcut-on-Linux","published":1,"updated":"2022-03-16T08:52:14.774Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1i4000ngqulbodtej4b","content":"<html><head></head><body><p><em>Root in: I want to find out where the “kill shortcut”, ctrl C, defined.\nI use <code>bind -P</code> to check the shortcuts. However, do not find ctrl C.\nThus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty.\nHowever, <code>bind -P</code> lists the shortcuts of readline.</em></p>\n<p>There may be two kinds of shortcuts, in practice,</p>\n<ul>\n<li>stty shortcuts</li>\n<li>readline shortcuts</li>\n</ul>\n<h1 id=\"stty-set-tty-set-teletypewriter\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#stty-set-tty-set-teletypewriter\"></a> stty (set tty, set teletypewriter)</h1>\n<p>The difference between shell, terminal and tty</p>\n<p>tty: Print the file name of the terminal connected to standard input.</p>\n<p>stty: change or print terminal characteristics, change and print terminal line settings.</p>\n<p>They are related to terminal.</p>\n<ul>\n<li>terminal = tty = text input/output environment</li>\n<li>console = physical terminal</li>\n<li>shell = command line interpreter</li>\n</ul>\n<p>The input of terminal or tty will used by readline, but not always\nreadline.</p>\n<h1 id=\"gun-readline-get-a-line-from-a-user-with-editing\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#gun-readline-get-a-line-from-a-user-with-editing\"></a> gun readline - get a line from a user with editing</h1>\n<h2 id=\"synopsis\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#synopsis\"></a> Synopsis</h2>\n<figure class=\"highlight c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/readline.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/history.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">char</span> *</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">readline</span> <span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *prompt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"description\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#description\"></a> Description</h2>\n<p><strong>readline will read a line from the terminal and return it, using\n<em>prompt</em> as a prompt.</strong></p>\n<p>If prompt is NULL or the empty string, no prompt is issued.\nThe line returned is allocated with <code>malloc</code>; the caller must\nfree it when finished. The line returned has the final newline removed,\nso only the text of the line remains.</p>\n<h2 id=\"return-value\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#return-value\"></a> Return Value</h2>\n<p>readline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty,\nNULL is returned. If an EOF is read with a non-empty line, it is treated\nas a newline.</p>\n<h2 id=\"initialization-file\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#initialization-file\"></a> Initialization file</h2>\n<p>Readline is customized by putting commands in an initialization file\n(the <code>inputrc</code> file). The name of this file is taken from the value of\nthe INPUTRC environment variable. If that variable is unset, the default\nis <code>~/.inputrc</code>. If that file does not exist or cannot be read, the\nultimate default is <code>/etc/inputrc</code>.</p>\n<p>When a program which uses the readline library starts up, the init\nfile is read, and the key bindings and variables are set.</p>\n<p>There are only a few basic constructs allowed in the readline init file.</p>\n<ol>\n<li>Black lines are ignored.</li>\n<li>Lines beginning with a <code>#</code> are comments.</li>\n<li>Lines beginning with a <code>$</code> indicate conditional constructs.</li>\n<li>Other lines denote key bindings and variable settings.</li>\n</ol>\n<p>Each program using this library may add its own commands and bindings.</p>\n<p>For example, placing</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">M-Control-u: universal-argment</span><br></pre></td></tr></tbody></table></figure>\n<p>into the <code>inputrc</code> would make <code>M-C-u</code> execute the readline command\n<code>universal-argument</code>.</p>\n<h1 id=\"the-difference-of-help-and-man-on-linux\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#the-difference-of-help-and-man-on-linux\"></a> The difference of <code>help</code> and <code>man</code> on linux</h1>\n<p><code>help</code> displays information about builtin shell commands.</p>\n<p><code>man</code> is s system-wide documentation system that provides short\nreference manuals for individual commands, API functions, concepts,\nconfiguration file syntax, file formats. It is the traditional Unix\ndocumentation system.</p>\n<p>We can get the information of <code>cd</code> by <code>help cd</code>, but not by <code>man cd</code>.\nWe can get the information of <code>git/nvim/stty</code> by <code>man git/nvim/stty</code>, but not by <code>help git/nvim/stty</code>.\n<code>cd</code> is a shell command and <code>git/nvim/stty</code> is linux projects.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p><em>Root in: I want to find out where the “kill shortcut”, ctrl C, defined.\nI use <code>bind -P</code> to check the shortcuts. However, do not find ctrl C.\nThus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty.\nHowever, <code>bind -P</code> lists the shortcuts of readline.</em></p>\n<p>There may be two kinds of shortcuts, in practice,</p>\n<ul>\n<li>stty shortcuts</li>\n<li>readline shortcuts</li>\n</ul>\n<h1 id=\"stty-set-tty-set-teletypewriter\"><a class=\"markdownIt-Anchor\" href=\"#stty-set-tty-set-teletypewriter\"></a> stty (set tty, set teletypewriter)</h1>\n<p>The difference between shell, terminal and tty</p>\n<p>tty: Print the file name of the terminal connected to standard input.</p>\n<p>stty: change or print terminal characteristics, change and print terminal line settings.</p>\n<p>They are related to terminal.</p>\n<ul>\n<li>terminal = tty = text input/output environment</li>\n<li>console = physical terminal</li>\n<li>shell = command line interpreter</li>\n</ul>\n<p>The input of terminal or tty will used by readline, but not always\nreadline.</p>\n<h1 id=\"gun-readline-get-a-line-from-a-user-with-editing\"><a class=\"markdownIt-Anchor\" href=\"#gun-readline-get-a-line-from-a-user-with-editing\"></a> gun readline - get a line from a user with editing</h1>\n<h2 id=\"synopsis\"><a class=\"markdownIt-Anchor\" href=\"#synopsis\"></a> Synopsis</h2>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/readline.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/history.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">char</span> *</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">readline</span> <span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *prompt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"description\"><a class=\"markdownIt-Anchor\" href=\"#description\"></a> Description</h2>\n<p><strong>readline will read a line from the terminal and return it, using\n<em>prompt</em> as a prompt.</strong></p>\n<p>If prompt is NULL or the empty string, no prompt is issued.\nThe line returned is allocated with <code>malloc</code>; the caller must\nfree it when finished. The line returned has the final newline removed,\nso only the text of the line remains.</p>\n<h2 id=\"return-value\"><a class=\"markdownIt-Anchor\" href=\"#return-value\"></a> Return Value</h2>\n<p>readline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty,\nNULL is returned. If an EOF is read with a non-empty line, it is treated\nas a newline.</p>\n<h2 id=\"initialization-file\"><a class=\"markdownIt-Anchor\" href=\"#initialization-file\"></a> Initialization file</h2>\n<p>Readline is customized by putting commands in an initialization file\n(the <code>inputrc</code> file). The name of this file is taken from the value of\nthe INPUTRC environment variable. If that variable is unset, the default\nis <code>~/.inputrc</code>. If that file does not exist or cannot be read, the\nultimate default is <code>/etc/inputrc</code>.</p>\n<p>When a program which uses the readline library starts up, the init\nfile is read, and the key bindings and variables are set.</p>\n<p>There are only a few basic constructs allowed in the readline init file.</p>\n<ol>\n<li>Black lines are ignored.</li>\n<li>Lines beginning with a <code>#</code> are comments.</li>\n<li>Lines beginning with a <code>$</code> indicate conditional constructs.</li>\n<li>Other lines denote key bindings and variable settings.</li>\n</ol>\n<p>Each program using this library may add its own commands and bindings.</p>\n<p>For example, placing</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">M-Control-u: universal-argment</span><br></pre></td></tr></table></figure>\n<p>into the <code>inputrc</code> would make <code>M-C-u</code> execute the readline command\n<code>universal-argument</code>.</p>\n<h1 id=\"the-difference-of-help-and-man-on-linux\"><a class=\"markdownIt-Anchor\" href=\"#the-difference-of-help-and-man-on-linux\"></a> The difference of <code>help</code> and <code>man</code> on linux</h1>\n<p><code>help</code> displays information about builtin shell commands.</p>\n<p><code>man</code> is s system-wide documentation system that provides short\nreference manuals for individual commands, API functions, concepts,\nconfiguration file syntax, file formats. It is the traditional Unix\ndocumentation system.</p>\n<p>We can get the information of <code>cd</code> by <code>help cd</code>, but not by <code>man cd</code>.\nWe can get the information of <code>git/nvim/stty</code> by <code>man git/nvim/stty</code>, but not by <code>help git/nvim/stty</code>.\n<code>cd</code> is a shell command and <code>git/nvim/stty</code> is linux projects.</p>\n"},{"title":"Tips in Papers","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-14T08:33:03.000Z","password":null,"summary":null,"description":"记录阅读论文过程中，新获取的信息。","_content":"\n# Attention\n\n## Hard and Soft Attention\n\n### Attention Mechanisms in CV: A Survey\n\n## Gumbel-Softmax Hard Attention\n\n### Categorical Reparameterization with Gumbel-Softmax\n\n#### 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。\n\n具有离散随机变量的随机神经网络\n\n#### 文章引出了一个方向，Stochastic Gradient Estimation\n\n随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased path derivative estimator。\n\n> However, no existing gradient estimator has been formulated specifically for categorical variables.\n\n## Reinforce Learnning Hard Attention\n\n### 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision\n\n#### Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。\n\n从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重要<div id=\"ap\"></div>\n\n> Our best models narrow the gap to common ImageNet baselines, achieving 75% top-1 and 91% top-5 while attending to less than one-third of the image.We further demonstrate that occluding the image patches prposed by the Saccader model highly impairs classification, thus confirming these patches strong relevance to the classification task.\n\n> Typical soft attention mechanisms rescale features at one or more stages of the network. The soft mask used for rescaling often to provide some insight into the model's decision-making process, but the model's final decision may nonetheless rely on information provided by features with small weights \\[^1]\n\n\\[^1]:2018,Learn to pay attention.\n\n#### 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。\n\n> Models that employ hard attention make decisions based on only a subset of pixel in the input image, typically in the form of a series of glimpses.\n\n#### 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。\n\n> Altough our aim in this work is to perform classification with only image-level class labels, out approach bears some resembalance to two-stage object detection models.\n\n> These models operate by generating many region proposals and then applying a classification model to each proposal.\n\n> Unlike our work, these approaches use ground-truth bounding boxes to train the classification model, and modern architectures also use bounding boxes to supervise the proposal generator.\n\n**目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域的特征，还可以挑选通道域的特征。**\n\n#### 总结构\n\n<img src=Saccader_Over.jpg width=80% height = 80%>\n\n最上面的 rep. net 以及 logits per location 之前都属于 representation network。这部分挺常规，但是使用了‘BagNet’\\[^2]的方法，该方法保持了输出特征图中每个像素的感受野大小。\n\n下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。\n\nSaccader cell 是技术关键点。\n\n**coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均。**\n\n\\[^2]:2019, Approximating CNNs with bag-of-local-features models works surprisingly well on ImageNet.\n\n#### Saccader cell\n\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n\n值得注意的几点\n\n1.  Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的 logit。这个 logit 表示该 state 预测的位置。\n\n> This cell produces a sequence of locations. Elements in the sequence correctpond to target locations.\n\n2.  需要保证 cell state 中预测之间都是不同的。$C^t$记录了 t 时刻位置探索过的所有位置。那些位置的值是 1。所以$C^{t - 1}$两次介入$C^t$的计算都乘以一个非常小的数$-10^5$ ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。\n\n> The cell includes a 2D state ($C^t$) that keeps memory of the visited locations until time t by placing 1 in the corresponding location in the cell state. We use this state to prevent the network from returning to previously seen locations.\n\n**从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的目的，其实也是为了产生 logic。**\n\n3.  在制作$C^t$的过程中，信息来源有两个 mixed feature 和$C^{t - 1}$。最后得到的$C^t$通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用了$C^{t - 1}$的信息，去除掉了已经探索的位置信息。\n\n4.  > At test time, the model extracts the logits at time $t$ from the representation network at location $argmax\\_{i,j}(\\hat{R}^t\\_{i,j})$.The final prediction is obtained by averaging the extracted logits across all times.\n\n**Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。**\n\n#### 训练策略\n\n> The goal of our training is to learn a policy that predicts a sequence of visual attentnion locations that is useful to the downsteam task (here image classification) in absence of location labels.\n>\n> We performed a three step training procedure using only the training class lables as supervision.\n\n![](Saccader_eq1.jpg)\n\n1.  预训练了 representation network\n\n这个公式增大了目标$y\\_{target}$的概率。增大的某个位置上$y\\_{target}$的概率，而且所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探索的起点。\n\n> Key to Saccader is a pretraining step that require only class lables and provides initial attention locations for policy gradient optimization.\n\n> Our pretraining procedure overcomes the sparse-reward problem that makes hard attention models difficult to optimize. It requires access to only class lables and prvides initial attention locations.These initial locations provide better rewards for the policy gradient learning.\n\n![](Saccader_eq2.jpg)\n\n2.  训练了 location network (attention network, $1 \\times 1$ mixing convolution and Sacader cell)\n\n这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。\n\n文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font>\n\n![](Saccader_eq3.jpg)\n\n3.  > we trained the whole model to maximize the expected reward, where the reward ($r \\in {0, 1}$) represents whether the model final prediction after 6 glimpses (T = 6) is correct.\n\n<font color=deeppink>这个公式并没有完全读懂。</font>\n\n用的是策略网络的方法。$l^t_s$是按 saccader cell 输出的位置概率生成的位置。公式的第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，当预测正确的时候，那么有监督的增大这 T 个预测位置在$y\\_{target}$上的准确率。<div id=\"空间\"></div>\n\n**由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点$y\\_{target}$的概率，然后不会理会，空间上其他点预测的是什么。**\n\n如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。\n\n**论文中说，[当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？](#ap)**\n\n#### 论文对比了 ordered logits policy 和 Saccader\n\n> An ordered logits policy uses the BagNet model to pick the top K locations based on the largest class logits.\n\nOrdered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作为物体类别的预测。\n\n> The ordered logits policy strats off with accuracy much higher than a random policy, suggesting that the patches it initially picks are meaningful to classification.\n>\n> However, accuracy is still lower than the learned Saccader model, and **performacne improves only slowly with additional glimpese. The ordered logits policy is able to capture some of the features relevant to classification, but it is a greedy policy that produces glimpses that cluster around a few top features (i.e., with low image coverage)**\n\nordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance 增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。\n\n#### 空间上其他位置\n\n如[上文所说](#空间)，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加 glimplese 的时候，它的性能应该会受到影响的。但是不是。\n\n> In fact, increasing the number of glimpses beyond the number used for DRAM policy training leads to drop in performane, ulike the Saccader model that generalizes to greater umbers of glimpses.\n\n<img src=Saccader_gl.jpg width=50% height = 50%>\n\n如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训练到的地方，Saccader 的预测也还可以，与[上文所说](#空间)的理解不同。<font color=deeppink>原因是什么还有待探究。</font>\n\n### Hard Attention for Scalable Image Classification\n\n#### 介绍\n\n<img src=Tnet_over.jpg width=50% height = 50%>\n\n> Muti-scale processing in the proposed TNet architecture. Starting from level 1, the image is processed in low resolution to get a coarse description of its content (red cube). Extracted features are used for (hard) selection of image regions worth processing in higher resolution. The process is repeated recursively (here to 2 additional levels). Features from all levels are combined (arrows on the right) to create the final image representation used for classificaiton (blue cube).\n\n先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader\n\n## Soft Attention\n\n### NAM, Normalization-based Attention Module\n\n#### 利用网络参数的信息，进一步处理数据（再利用）\n\n> Those methods successfully exploit the mutual information from different dimensions of feawture. However, they lack consideration on the contributing factors of weights, which is capable of furthr suppressing the insignificant channels or pixels.\n\n网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，**一次是否就已经用完了该参数的信息。它是否还有其他价值？**\n\n文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而 attention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重。**使得 bn 的权重出现重复利用的现象。**\n\n$$\n\\begin{aligned}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{aligned}\n$$\n\n```python\nclass Channel_Att(nn.Module):\n    def __init__(self, channels, t=16):\n        super(Channel_Att, self).__init__()\n        self.channels = channels\n        self.bn2 = nn.BatchNorm2d(self.channels, affine=True)\n    def forward(self, x):\n        residual = x\n        x = self.bn2(x)\n        weight_bn = self.bn2.weight.data.abs() / torch.sum(self.bn2.weight.data.abs())\n        x = x.permute(0, 2, 3, 1).contiguous()\n        x = torch.mul(weight_bn, x)\n        x = x.permute(0, 3, 1, 2).contiguous()\n        x = torch.sigmoid(x) * residual\n        return x\n```\n\n#### 关于权重稀疏性\n\n> It applies a weightsparsity penalty to the attention modules, thus, making them more computational efficient while retaining similar performance.\n>\n> To suppress the less salient weights, we add a regularization term into the loss function.\n\n$$Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)$$\n\n第一项是正常的损失函数，第二项和第三项的$g（）$是一范数，$\\gamma$是通道注意力中 bn 的权重，$\\lambda$是空间注意力中 pix normalization 的权重。加上这两项使得通道和空间注意力都有了稀疏性。\n\n<font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来 computational efficient? 文章确实有 computational efficient，但是根据实验部分的列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font>\n\n#### 启发\n\n<font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由。</font>\n\n<font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font>\n\n# Regularization\n\n## ADCM: Attentnion Dropout Convolutional Module\n\n![ADCM](ADCM.jpg)\n\n在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把它误解为 hard attention。\n","source":"_posts/Tips-in-Papers.md","raw":"---\ntitle: Tips in Papers\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-14 16:33:03\npassword:\nsummary:\ndescription: 记录阅读论文过程中，新获取的信息。\ncategories:\n  - About Papers\n\ntags:\n  - Papers\n  - Personal Thought\n---\n\n# Attention\n\n## Hard and Soft Attention\n\n### Attention Mechanisms in CV: A Survey\n\n## Gumbel-Softmax Hard Attention\n\n### Categorical Reparameterization with Gumbel-Softmax\n\n#### 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。\n\n具有离散随机变量的随机神经网络\n\n#### 文章引出了一个方向，Stochastic Gradient Estimation\n\n随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased path derivative estimator。\n\n> However, no existing gradient estimator has been formulated specifically for categorical variables.\n\n## Reinforce Learnning Hard Attention\n\n### 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision\n\n#### Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。\n\n从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重要<div id=\"ap\"></div>\n\n> Our best models narrow the gap to common ImageNet baselines, achieving 75% top-1 and 91% top-5 while attending to less than one-third of the image.We further demonstrate that occluding the image patches prposed by the Saccader model highly impairs classification, thus confirming these patches strong relevance to the classification task.\n\n> Typical soft attention mechanisms rescale features at one or more stages of the network. The soft mask used for rescaling often to provide some insight into the model's decision-making process, but the model's final decision may nonetheless rely on information provided by features with small weights \\[^1]\n\n\\[^1]:2018,Learn to pay attention.\n\n#### 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。\n\n> Models that employ hard attention make decisions based on only a subset of pixel in the input image, typically in the form of a series of glimpses.\n\n#### 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。\n\n> Altough our aim in this work is to perform classification with only image-level class labels, out approach bears some resembalance to two-stage object detection models.\n\n> These models operate by generating many region proposals and then applying a classification model to each proposal.\n\n> Unlike our work, these approaches use ground-truth bounding boxes to train the classification model, and modern architectures also use bounding boxes to supervise the proposal generator.\n\n**目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域的特征，还可以挑选通道域的特征。**\n\n#### 总结构\n\n<img src=Saccader_Over.jpg width=80% height = 80%>\n\n最上面的 rep. net 以及 logits per location 之前都属于 representation network。这部分挺常规，但是使用了‘BagNet’\\[^2]的方法，该方法保持了输出特征图中每个像素的感受野大小。\n\n下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。\n\nSaccader cell 是技术关键点。\n\n**coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均。**\n\n\\[^2]:2019, Approximating CNNs with bag-of-local-features models works surprisingly well on ImageNet.\n\n#### Saccader cell\n\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n\n值得注意的几点\n\n1.  Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的 logit。这个 logit 表示该 state 预测的位置。\n\n> This cell produces a sequence of locations. Elements in the sequence correctpond to target locations.\n\n2.  需要保证 cell state 中预测之间都是不同的。$C^t$记录了 t 时刻位置探索过的所有位置。那些位置的值是 1。所以$C^{t - 1}$两次介入$C^t$的计算都乘以一个非常小的数$-10^5$ ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。\n\n> The cell includes a 2D state ($C^t$) that keeps memory of the visited locations until time t by placing 1 in the corresponding location in the cell state. We use this state to prevent the network from returning to previously seen locations.\n\n**从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的目的，其实也是为了产生 logic。**\n\n3.  在制作$C^t$的过程中，信息来源有两个 mixed feature 和$C^{t - 1}$。最后得到的$C^t$通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用了$C^{t - 1}$的信息，去除掉了已经探索的位置信息。\n\n4.  > At test time, the model extracts the logits at time $t$ from the representation network at location $argmax\\_{i,j}(\\hat{R}^t\\_{i,j})$.The final prediction is obtained by averaging the extracted logits across all times.\n\n**Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。**\n\n#### 训练策略\n\n> The goal of our training is to learn a policy that predicts a sequence of visual attentnion locations that is useful to the downsteam task (here image classification) in absence of location labels.\n>\n> We performed a three step training procedure using only the training class lables as supervision.\n\n![](Saccader_eq1.jpg)\n\n1.  预训练了 representation network\n\n这个公式增大了目标$y\\_{target}$的概率。增大的某个位置上$y\\_{target}$的概率，而且所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探索的起点。\n\n> Key to Saccader is a pretraining step that require only class lables and provides initial attention locations for policy gradient optimization.\n\n> Our pretraining procedure overcomes the sparse-reward problem that makes hard attention models difficult to optimize. It requires access to only class lables and prvides initial attention locations.These initial locations provide better rewards for the policy gradient learning.\n\n![](Saccader_eq2.jpg)\n\n2.  训练了 location network (attention network, $1 \\times 1$ mixing convolution and Sacader cell)\n\n这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。\n\n文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font>\n\n![](Saccader_eq3.jpg)\n\n3.  > we trained the whole model to maximize the expected reward, where the reward ($r \\in {0, 1}$) represents whether the model final prediction after 6 glimpses (T = 6) is correct.\n\n<font color=deeppink>这个公式并没有完全读懂。</font>\n\n用的是策略网络的方法。$l^t_s$是按 saccader cell 输出的位置概率生成的位置。公式的第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，当预测正确的时候，那么有监督的增大这 T 个预测位置在$y\\_{target}$上的准确率。<div id=\"空间\"></div>\n\n**由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点$y\\_{target}$的概率，然后不会理会，空间上其他点预测的是什么。**\n\n如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。\n\n**论文中说，[当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？](#ap)**\n\n#### 论文对比了 ordered logits policy 和 Saccader\n\n> An ordered logits policy uses the BagNet model to pick the top K locations based on the largest class logits.\n\nOrdered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作为物体类别的预测。\n\n> The ordered logits policy strats off with accuracy much higher than a random policy, suggesting that the patches it initially picks are meaningful to classification.\n>\n> However, accuracy is still lower than the learned Saccader model, and **performacne improves only slowly with additional glimpese. The ordered logits policy is able to capture some of the features relevant to classification, but it is a greedy policy that produces glimpses that cluster around a few top features (i.e., with low image coverage)**\n\nordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance 增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。\n\n#### 空间上其他位置\n\n如[上文所说](#空间)，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加 glimplese 的时候，它的性能应该会受到影响的。但是不是。\n\n> In fact, increasing the number of glimpses beyond the number used for DRAM policy training leads to drop in performane, ulike the Saccader model that generalizes to greater umbers of glimpses.\n\n<img src=Saccader_gl.jpg width=50% height = 50%>\n\n如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训练到的地方，Saccader 的预测也还可以，与[上文所说](#空间)的理解不同。<font color=deeppink>原因是什么还有待探究。</font>\n\n### Hard Attention for Scalable Image Classification\n\n#### 介绍\n\n<img src=Tnet_over.jpg width=50% height = 50%>\n\n> Muti-scale processing in the proposed TNet architecture. Starting from level 1, the image is processed in low resolution to get a coarse description of its content (red cube). Extracted features are used for (hard) selection of image regions worth processing in higher resolution. The process is repeated recursively (here to 2 additional levels). Features from all levels are combined (arrows on the right) to create the final image representation used for classificaiton (blue cube).\n\n先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader\n\n## Soft Attention\n\n### NAM, Normalization-based Attention Module\n\n#### 利用网络参数的信息，进一步处理数据（再利用）\n\n> Those methods successfully exploit the mutual information from different dimensions of feawture. However, they lack consideration on the contributing factors of weights, which is capable of furthr suppressing the insignificant channels or pixels.\n\n网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，**一次是否就已经用完了该参数的信息。它是否还有其他价值？**\n\n文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而 attention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重。**使得 bn 的权重出现重复利用的现象。**\n\n$$\n\\begin{aligned}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{aligned}\n$$\n\n```python\nclass Channel_Att(nn.Module):\n    def __init__(self, channels, t=16):\n        super(Channel_Att, self).__init__()\n        self.channels = channels\n        self.bn2 = nn.BatchNorm2d(self.channels, affine=True)\n    def forward(self, x):\n        residual = x\n        x = self.bn2(x)\n        weight_bn = self.bn2.weight.data.abs() / torch.sum(self.bn2.weight.data.abs())\n        x = x.permute(0, 2, 3, 1).contiguous()\n        x = torch.mul(weight_bn, x)\n        x = x.permute(0, 3, 1, 2).contiguous()\n        x = torch.sigmoid(x) * residual\n        return x\n```\n\n#### 关于权重稀疏性\n\n> It applies a weightsparsity penalty to the attention modules, thus, making them more computational efficient while retaining similar performance.\n>\n> To suppress the less salient weights, we add a regularization term into the loss function.\n\n$$Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)$$\n\n第一项是正常的损失函数，第二项和第三项的$g（）$是一范数，$\\gamma$是通道注意力中 bn 的权重，$\\lambda$是空间注意力中 pix normalization 的权重。加上这两项使得通道和空间注意力都有了稀疏性。\n\n<font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来 computational efficient? 文章确实有 computational efficient，但是根据实验部分的列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font>\n\n#### 启发\n\n<font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由。</font>\n\n<font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font>\n\n# Regularization\n\n## ADCM: Attentnion Dropout Convolutional Module\n\n![ADCM](ADCM.jpg)\n\n在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把它误解为 hard attention。\n","slug":"Tips-in-Papers","published":1,"updated":"2022-03-16T11:45:02.694Z","_id":"cl0thb1i5000pgqul21aoc3us","comments":1,"layout":"post","photos":[],"link":"","content":"<html><head></head><body><h1 id=\"attention\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#attention\"></a> Attention</h1>\n<h2 id=\"hard-and-soft-attention\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#hard-and-soft-attention\"></a> Hard and Soft Attention</h2>\n<h3 id=\"attention-mechanisms-in-cv-a-survey\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#attention-mechanisms-in-cv-a-survey\"></a> Attention Mechanisms in CV: A Survey</h3>\n<h2 id=\"gumbel-softmax-hard-attention\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#gumbel-softmax-hard-attention\"></a> Gumbel-Softmax Hard Attention</h2>\n<h3 id=\"categorical-reparameterization-with-gumbel-softmax\"><span class=\"post-title-index\">1.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#categorical-reparameterization-with-gumbel-softmax\"></a> Categorical Reparameterization with Gumbel-Softmax</h3>\n<h4 id=\"文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"><span class=\"post-title-index\">1.2.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"></a> 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。</h4>\n<p>具有离散随机变量的随机神经网络</p>\n<h4 id=\"文章引出了一个方向stochastic-gradient-estimation\"><span class=\"post-title-index\">1.2.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#文章引出了一个方向stochastic-gradient-estimation\"></a> 文章引出了一个方向，Stochastic Gradient Estimation</h4>\n<p>随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased path derivative estimator。</p>\n<blockquote>\n<p>However, no existing gradient estimator has been formulated specifically for categorical variables.</p>\n</blockquote>\n<h2 id=\"reinforce-learnning-hard-attention\"><span class=\"post-title-index\">1.3. </span><a class=\"markdownIt-Anchor\" href=\"#reinforce-learnning-hard-attention\"></a> Reinforce Learnning Hard Attention</h2>\n<h3 id=\"2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"><span class=\"post-title-index\">1.3.1. </span><a class=\"markdownIt-Anchor\" href=\"#2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"></a> 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision</h3>\n<h4 id=\"hard-attention-选择相关的特征作为输入是真正具有可解释性的\"><span class=\"post-title-index\">1.3.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#hard-attention-选择相关的特征作为输入是真正具有可解释性的\"></a> Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。</h4>\n<p>从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重要</p><div id=\"ap\"></div><p></p>\n<blockquote>\n<p>Our best models narrow the gap to common ImageNet baselines, achieving 75% top-1 and 91% top-5 while attending to less than one-third of the image.We further demonstrate that occluding the image patches prposed by the Saccader model highly impairs classification, thus confirming these patches strong relevance to the classification task.</p>\n</blockquote>\n<blockquote>\n<p>Typical soft attention mechanisms rescale features at one or more stages of the network. The soft mask used for rescaling often to provide some insight into the model’s decision-making process, but the model’s final decision may nonetheless rely on information provided by features with small weights &lt;sup id=“fnref:1”&gt;<a href=\"#fn:1\" rel=\"footnote\">1</a></p>\n</blockquote>\n<p>\\</p>\n<h4 id=\"文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"><span class=\"post-title-index\">1.3.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"></a> 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。</h4>\n<blockquote>\n<p>Models that employ hard attention make decisions based on only a subset of pixel in the input image, typically in the form of a series of glimpses.</p>\n</blockquote>\n<h4 id=\"文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"><span class=\"post-title-index\">1.3.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"></a> 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。</h4>\n<blockquote>\n<p>Altough our aim in this work is to perform classification with only image-level class labels, out approach bears some resembalance to two-stage object detection models.</p>\n</blockquote>\n<blockquote>\n<p>These models operate by generating many region proposals and then applying a classification model to each proposal.</p>\n</blockquote>\n<blockquote>\n<p>Unlike our work, these approaches use ground-truth bounding boxes to train the classification model, and modern architectures also use bounding boxes to supervise the proposal generator.</p>\n</blockquote>\n<p><strong>目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域的特征，还可以挑选通道域的特征。</strong></p>\n<h4 id=\"总结构\"><span class=\"post-title-index\">1.3.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#总结构\"></a> 总结构</h4>\n<img src=\"Saccader_Over.jpg\" width=\"80%\" height=\"80%\">\n<p>最上面的 rep. net 以及 logits per location 之前都属于 representation network。这部分挺常规，但是使用了‘BagNet’&lt;sup id=“fnref:2”&gt;<a href=\"#fn:2\" rel=\"footnote\">2</a>的方法，该方法保持了输出特征图中每个像素的感受野大小。</p>\n<p>下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。</p>\n<p>Saccader cell 是技术关键点。</p>\n<p><strong>coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均。</strong></p>\n<p>\\</p>\n<h4 id=\"saccader-cell\"><span class=\"post-title-index\">1.3.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#saccader-cell\"></a> Saccader cell</h4>\n<img src=\"Saccader_Cell.jpg\" width=\"80%\" height=\"80%\">\n<p>值得注意的几点</p>\n<ol>\n<li>Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的 logit。这个 logit 表示该 state 预测的位置。</li>\n</ol>\n<blockquote>\n<p>This cell produces a sequence of locations. Elements in the sequence correctpond to target locations.</p>\n</blockquote>\n<ol start=\"2\">\n<li>需要保证 cell state 中预测之间都是不同的。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>记录了 t 时刻位置探索过的所有位置。那些位置的值是 1。所以<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>两次介入<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的计算都乘以一个非常小的数<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">-10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span> ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。</li>\n</ol>\n<blockquote>\n<p>The cell includes a 2D state (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>) that keeps memory of the visited locations until time t by placing 1 in the corresponding location in the cell state. We use this state to prevent the network from returning to previously seen locations.</p>\n</blockquote>\n<p><strong>从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的目的，其实也是为了产生 logic。</strong></p>\n<ol start=\"3\">\n<li>\n<p>在制作<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的过程中，信息来源有两个 mixed feature 和<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。最后得到的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用了<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>的信息，去除掉了已经探索的位置信息。</p>\n</li>\n<li>\n<blockquote>\n<p>At test time, the model extracts the logits at time <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> from the representation network at location <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">(</mo><msup><mover accent=\"true\"><mi>R</mi><mo>^</mo></mover><mi>t</mi></msup><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">argmax\\_{i,j}(\\hat{R}^t\\_{i,j})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.25677em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9467699999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\">^</span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mclose\">)</span></span></span></span>.The final prediction is obtained by averaging the extracted logits across all times.</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。</strong></p>\n<h4 id=\"训练策略\"><span class=\"post-title-index\">1.3.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#训练策略\"></a> 训练策略</h4>\n<blockquote>\n<p>The goal of our training is to learn a policy that predicts a sequence of visual attentnion locations that is useful to the downsteam task (here image classification) in absence of location labels.</p>\n<p>We performed a three step training procedure using only the training class lables as supervision.</p>\n</blockquote>\n<p><img src=\"Saccader_eq1.jpg\" alt=\"\"></p>\n<ol>\n<li>预训练了 representation network</li>\n</ol>\n<p>这个公式增大了目标<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率。增大的某个位置上<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，而且所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探索的起点。</p>\n<blockquote>\n<p>Key to Saccader is a pretraining step that require only class lables and provides initial attention locations for policy gradient optimization.</p>\n</blockquote>\n<blockquote>\n<p>Our pretraining procedure overcomes the sparse-reward problem that makes hard attention models difficult to optimize. It requires access to only class lables and prvides initial attention locations.These initial locations provide better rewards for the policy gradient learning.</p>\n</blockquote>\n<p><img src=\"Saccader_eq2.jpg\" alt=\"\"></p>\n<ol start=\"2\">\n<li>训练了 location network (attention network, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\times 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> mixing convolution and Sacader cell)</li>\n</ol>\n<p>这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。</p>\n<p>文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而，<font color=\"deeppink\">现在还并不能完全了解这个预训练的作用机制。 </font></p>\n<p><img src=\"Saccader_eq3.jpg\" alt=\"\"></p>\n<ol start=\"3\">\n<li>\n<blockquote>\n<p>we trained the whole model to maximize the expected reward, where the reward (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>∈</mo><mrow><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></mrow><annotation encoding=\"application/x-tex\">r \\in {0, 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span></span></span></span></span>) represents whether the model final prediction after 6 glimpses (T = 6) is correct.</p>\n</blockquote>\n</li>\n</ol>\n<p><font color=\"deeppink\">这个公式并没有完全读懂。</font></p>\n<p>用的是策略网络的方法。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mi>l</mi><mi>s</mi><mi>t</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">l^t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040556em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">s</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span>是按 saccader cell 输出的位置概率生成的位置。公式的第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，当预测正确的时候，那么有监督的增大这 T 个预测位置在<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>上的准确率。</p><div id=\"空间\"></div><p></p>\n<p><strong>由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，然后不会理会，空间上其他点预测的是什么。</strong></p>\n<p>如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。</p>\n<p><strong>论文中说，<a href=\"#ap\">当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？</a></strong></p>\n<h4 id=\"论文对比了-ordered-logits-policy-和-saccader\"><span class=\"post-title-index\">1.3.1.7. </span><a class=\"markdownIt-Anchor\" href=\"#论文对比了-ordered-logits-policy-和-saccader\"></a> 论文对比了 ordered logits policy 和 Saccader</h4>\n<blockquote>\n<p>An ordered logits policy uses the BagNet model to pick the top K locations based on the largest class logits.</p>\n</blockquote>\n<p>Ordered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作为物体类别的预测。</p>\n<blockquote>\n<p>The ordered logits policy strats off with accuracy much higher than a random policy, suggesting that the patches it initially picks are meaningful to classification.</p>\n<p>However, accuracy is still lower than the learned Saccader model, and <strong>performacne improves only slowly with additional glimpese. The ordered logits policy is able to capture some of the features relevant to classification, but it is a greedy policy that produces glimpses that cluster around a few top features (i.e., with low image coverage)</strong></p>\n</blockquote>\n<p>ordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance 增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。</p>\n<h4 id=\"空间上其他位置\"><span class=\"post-title-index\">1.3.1.8. </span><a class=\"markdownIt-Anchor\" href=\"#空间上其他位置\"></a> 空间上其他位置</h4>\n<p>如<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加 glimplese 的时候，它的性能应该会受到影响的。但是不是。</p>\n<blockquote>\n<p>In fact, increasing the number of glimpses beyond the number used for DRAM policy training leads to drop in performane, ulike the Saccader model that generalizes to greater umbers of glimpses.</p>\n</blockquote>\n<img src=\"Saccader_gl.jpg\" width=\"50%\" height=\"50%\">\n<p>如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训练到的地方，Saccader 的预测也还可以，与<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>的理解不同。<font color=\"deeppink\">原因是什么还有待探究。</font></p>\n<h3 id=\"hard-attention-for-scalable-image-classification\"><span class=\"post-title-index\">1.3.2. </span><a class=\"markdownIt-Anchor\" href=\"#hard-attention-for-scalable-image-classification\"></a> Hard Attention for Scalable Image Classification</h3>\n<h4 id=\"介绍\"><span class=\"post-title-index\">1.3.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#介绍\"></a> 介绍</h4>\n<img src=\"Tnet_over.jpg\" width=\"50%\" height=\"50%\">\n<blockquote>\n<p>Muti-scale processing in the proposed TNet architecture. Starting from level 1, the image is processed in low resolution to get a coarse description of its content (red cube). Extracted features are used for (hard) selection of image regions worth processing in higher resolution. The process is repeated recursively (here to 2 additional levels). Features from all levels are combined (arrows on the right) to create the final image representation used for classificaiton (blue cube).</p>\n</blockquote>\n<p>先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader</p>\n<h2 id=\"soft-attention\"><span class=\"post-title-index\">1.4. </span><a class=\"markdownIt-Anchor\" href=\"#soft-attention\"></a> Soft Attention</h2>\n<h3 id=\"nam-normalization-based-attention-module\"><span class=\"post-title-index\">1.4.1. </span><a class=\"markdownIt-Anchor\" href=\"#nam-normalization-based-attention-module\"></a> NAM, Normalization-based Attention Module</h3>\n<h4 id=\"利用网络参数的信息进一步处理数据再利用\"><span class=\"post-title-index\">1.4.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#利用网络参数的信息进一步处理数据再利用\"></a> 利用网络参数的信息，进一步处理数据（再利用）</h4>\n<blockquote>\n<p>Those methods successfully exploit the mutual information from different dimensions of feawture. However, they lack consideration on the contributing factors of weights, which is capable of furthr suppressing the insignificant channels or pixels.</p>\n</blockquote>\n<p>网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，<strong>一次是否就已经用完了该参数的信息。它是否还有其他价值？</strong></p>\n<p>文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而 attention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重。<strong>使得 bn 的权重出现重复利用的现象。</strong></p>\n<p class=\"katex-block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mi>γ</mi><mo>+</mo><mi>δ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mfrac><mi>γ</mi><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">)</mo><mo>×</mo><mi>x</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.84356em;vertical-align:-3.1717800000000005em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03785em;\">δ</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1075599999999999em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">.</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">d</span><span class=\"mopen\">(</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Channel_Att</span>(<span class=\"params\">nn.Module</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, channels, t=<span class=\"number\">16</span></span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Channel_Att, self).__init__()</span><br><span class=\"line\">        self.channels = channels</span><br><span class=\"line\">        self.bn2 = nn.BatchNorm2d(self.channels, affine=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">forward</span>(<span class=\"params\">self, x</span>):</span></span><br><span class=\"line\">        residual = x</span><br><span class=\"line\">        x = self.bn2(x)</span><br><span class=\"line\">        weight_bn = self.bn2.weight.data.<span class=\"built_in\">abs</span>() / torch.<span class=\"built_in\">sum</span>(self.bn2.weight.data.<span class=\"built_in\">abs</span>())</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>).contiguous()</span><br><span class=\"line\">        x = torch.mul(weight_bn, x)</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>).contiguous()</span><br><span class=\"line\">        x = torch.sigmoid(x) * residual</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"关于权重稀疏性\"><span class=\"post-title-index\">1.4.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#关于权重稀疏性\"></a> 关于权重稀疏性</h4>\n<blockquote>\n<p>It applies a weightsparsity penalty to the attention modules, thus, making them more computational efficient while retaining similar performance.</p>\n<p>To suppress the less salient weights, we add a regularization term into the loss function.</p>\n</blockquote>\n<p class=\"katex-block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></munder><mi>l</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>λ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">L</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5660100000000003em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">λ</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>第一项是正常的损失函数，第二项和第三项的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mi mathvariant=\"normal\">（</mi><mi mathvariant=\"normal\">）</mi></mrow><annotation encoding=\"application/x-tex\">g（）</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord cjk_fallback\">（</span><span class=\"mord cjk_fallback\">）</span></span></span></span>是一范数，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>是通道注意力中 bn 的权重，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span>是空间注意力中 pix normalization 的权重。加上这两项使得通道和空间注意力都有了稀疏性。</p>\n<p><font color=\"deeppink\">loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来 computational efficient? 文章确实有 computational efficient，但是根据实验部分的列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font></p>\n<h4 id=\"启发\"><span class=\"post-title-index\">1.4.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#启发\"></a> 启发</h4>\n<p><font color=\"deeppink\">这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由。</font></p>\n<p><font color=\"deeppink\">参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font></p>\n<h1 id=\"regularization\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#regularization\"></a> Regularization</h1>\n<h2 id=\"adcm-attentnion-dropout-convolutional-module\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#adcm-attentnion-dropout-convolutional-module\"></a> ADCM: Attentnion Dropout Convolutional Module</h2>\n<p><img src=\"ADCM.jpg\" alt=\"ADCM\"></p>\n<p>在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把它误解为 hard attention。</p>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">2018,Learn to pay attention.<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">2019, Approximating CNNs with bag-of-local-features models works surprisingly well on ImageNet.<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"attention\"><a class=\"markdownIt-Anchor\" href=\"#attention\"></a> Attention</h1>\n<h2 id=\"hard-and-soft-attention\"><a class=\"markdownIt-Anchor\" href=\"#hard-and-soft-attention\"></a> Hard and Soft Attention</h2>\n<h3 id=\"attention-mechanisms-in-cv-a-survey\"><a class=\"markdownIt-Anchor\" href=\"#attention-mechanisms-in-cv-a-survey\"></a> Attention Mechanisms in CV: A Survey</h3>\n<h2 id=\"gumbel-softmax-hard-attention\"><a class=\"markdownIt-Anchor\" href=\"#gumbel-softmax-hard-attention\"></a> Gumbel-Softmax Hard Attention</h2>\n<h3 id=\"categorical-reparameterization-with-gumbel-softmax\"><a class=\"markdownIt-Anchor\" href=\"#categorical-reparameterization-with-gumbel-softmax\"></a> Categorical Reparameterization with Gumbel-Softmax</h3>\n<h4 id=\"文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"><a class=\"markdownIt-Anchor\" href=\"#文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"></a> 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。</h4>\n<p>具有离散随机变量的随机神经网络</p>\n<h4 id=\"文章引出了一个方向stochastic-gradient-estimation\"><a class=\"markdownIt-Anchor\" href=\"#文章引出了一个方向stochastic-gradient-estimation\"></a> 文章引出了一个方向，Stochastic Gradient Estimation</h4>\n<p>随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased path derivative estimator。</p>\n<blockquote>\n<p>However, no existing gradient estimator has been formulated specifically for categorical variables.</p>\n</blockquote>\n<h2 id=\"reinforce-learnning-hard-attention\"><a class=\"markdownIt-Anchor\" href=\"#reinforce-learnning-hard-attention\"></a> Reinforce Learnning Hard Attention</h2>\n<h3 id=\"2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"><a class=\"markdownIt-Anchor\" href=\"#2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"></a> 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision</h3>\n<h4 id=\"hard-attention-选择相关的特征作为输入是真正具有可解释性的\"><a class=\"markdownIt-Anchor\" href=\"#hard-attention-选择相关的特征作为输入是真正具有可解释性的\"></a> Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。</h4>\n<p>从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重要<div id=\"ap\"></div></p>\n<blockquote>\n<p>Our best models narrow the gap to common ImageNet baselines, achieving 75% top-1 and 91% top-5 while attending to less than one-third of the image.We further demonstrate that occluding the image patches prposed by the Saccader model highly impairs classification, thus confirming these patches strong relevance to the classification task.</p>\n</blockquote>\n<blockquote>\n<p>Typical soft attention mechanisms rescale features at one or more stages of the network. The soft mask used for rescaling often to provide some insight into the model’s decision-making process, but the model’s final decision may nonetheless rely on information provided by features with small weights &lt;sup id=“fnref:1”&gt;<a href=\"#fn:1\" rel=\"footnote\">1</a></sup></p>\n</blockquote>\n<p>\\</p>\n<h4 id=\"文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"><a class=\"markdownIt-Anchor\" href=\"#文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"></a> 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。</h4>\n<blockquote>\n<p>Models that employ hard attention make decisions based on only a subset of pixel in the input image, typically in the form of a series of glimpses.</p>\n</blockquote>\n<h4 id=\"文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"><a class=\"markdownIt-Anchor\" href=\"#文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"></a> 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。</h4>\n<blockquote>\n<p>Altough our aim in this work is to perform classification with only image-level class labels, out approach bears some resembalance to two-stage object detection models.</p>\n</blockquote>\n<blockquote>\n<p>These models operate by generating many region proposals and then applying a classification model to each proposal.</p>\n</blockquote>\n<blockquote>\n<p>Unlike our work, these approaches use ground-truth bounding boxes to train the classification model, and modern architectures also use bounding boxes to supervise the proposal generator.</p>\n</blockquote>\n<p><strong>目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域的特征，还可以挑选通道域的特征。</strong></p>\n<h4 id=\"总结构\"><a class=\"markdownIt-Anchor\" href=\"#总结构\"></a> 总结构</h4>\n<img src=Saccader_Over.jpg width=80% height = 80%>\n<p>最上面的 rep. net 以及 logits per location 之前都属于 representation network。这部分挺常规，但是使用了‘BagNet’&lt;sup id=“fnref:2”&gt;<a href=\"#fn:2\" rel=\"footnote\">2</a></sup>的方法，该方法保持了输出特征图中每个像素的感受野大小。</p>\n<p>下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。</p>\n<p>Saccader cell 是技术关键点。</p>\n<p><strong>coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均。</strong></p>\n<p>\\</p>\n<h4 id=\"saccader-cell\"><a class=\"markdownIt-Anchor\" href=\"#saccader-cell\"></a> Saccader cell</h4>\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n<p>值得注意的几点</p>\n<ol>\n<li>Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的 logit。这个 logit 表示该 state 预测的位置。</li>\n</ol>\n<blockquote>\n<p>This cell produces a sequence of locations. Elements in the sequence correctpond to target locations.</p>\n</blockquote>\n<ol start=\"2\">\n<li>需要保证 cell state 中预测之间都是不同的。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>记录了 t 时刻位置探索过的所有位置。那些位置的值是 1。所以<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>两次介入<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的计算都乘以一个非常小的数<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">-10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span> ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。</li>\n</ol>\n<blockquote>\n<p>The cell includes a 2D state (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>) that keeps memory of the visited locations until time t by placing 1 in the corresponding location in the cell state. We use this state to prevent the network from returning to previously seen locations.</p>\n</blockquote>\n<p><strong>从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的目的，其实也是为了产生 logic。</strong></p>\n<ol start=\"3\">\n<li>\n<p>在制作<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的过程中，信息来源有两个 mixed feature 和<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。最后得到的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用了<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>的信息，去除掉了已经探索的位置信息。</p>\n</li>\n<li>\n<blockquote>\n<p>At test time, the model extracts the logits at time <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> from the representation network at location <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">(</mo><msup><mover accent=\"true\"><mi>R</mi><mo>^</mo></mover><mi>t</mi></msup><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">argmax\\_{i,j}(\\hat{R}^t\\_{i,j})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.25677em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9467699999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\">^</span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mclose\">)</span></span></span></span>.The final prediction is obtained by averaging the extracted logits across all times.</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。</strong></p>\n<h4 id=\"训练策略\"><a class=\"markdownIt-Anchor\" href=\"#训练策略\"></a> 训练策略</h4>\n<blockquote>\n<p>The goal of our training is to learn a policy that predicts a sequence of visual attentnion locations that is useful to the downsteam task (here image classification) in absence of location labels.</p>\n<p>We performed a three step training procedure using only the training class lables as supervision.</p>\n</blockquote>\n<p><img src=\"Saccader_eq1.jpg\" alt=\"\" /></p>\n<ol>\n<li>预训练了 representation network</li>\n</ol>\n<p>这个公式增大了目标<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率。增大的某个位置上<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，而且所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探索的起点。</p>\n<blockquote>\n<p>Key to Saccader is a pretraining step that require only class lables and provides initial attention locations for policy gradient optimization.</p>\n</blockquote>\n<blockquote>\n<p>Our pretraining procedure overcomes the sparse-reward problem that makes hard attention models difficult to optimize. It requires access to only class lables and prvides initial attention locations.These initial locations provide better rewards for the policy gradient learning.</p>\n</blockquote>\n<p><img src=\"Saccader_eq2.jpg\" alt=\"\" /></p>\n<ol start=\"2\">\n<li>训练了 location network (attention network, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\times 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> mixing convolution and Sacader cell)</li>\n</ol>\n<p>这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。</p>\n<p>文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font></p>\n<p><img src=\"Saccader_eq3.jpg\" alt=\"\" /></p>\n<ol start=\"3\">\n<li>\n<blockquote>\n<p>we trained the whole model to maximize the expected reward, where the reward (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>∈</mo><mrow><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></mrow><annotation encoding=\"application/x-tex\">r \\in {0, 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span></span></span></span></span>) represents whether the model final prediction after 6 glimpses (T = 6) is correct.</p>\n</blockquote>\n</li>\n</ol>\n<p><font color=deeppink>这个公式并没有完全读懂。</font></p>\n<p>用的是策略网络的方法。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mi>l</mi><mi>s</mi><mi>t</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">l^t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040556em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">s</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span>是按 saccader cell 输出的位置概率生成的位置。公式的第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，当预测正确的时候，那么有监督的增大这 T 个预测位置在<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>上的准确率。<div id=\"空间\"></div></p>\n<p><strong>由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，然后不会理会，空间上其他点预测的是什么。</strong></p>\n<p>如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。</p>\n<p><strong>论文中说，<a href=\"#ap\">当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？</a></strong></p>\n<h4 id=\"论文对比了-ordered-logits-policy-和-saccader\"><a class=\"markdownIt-Anchor\" href=\"#论文对比了-ordered-logits-policy-和-saccader\"></a> 论文对比了 ordered logits policy 和 Saccader</h4>\n<blockquote>\n<p>An ordered logits policy uses the BagNet model to pick the top K locations based on the largest class logits.</p>\n</blockquote>\n<p>Ordered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作为物体类别的预测。</p>\n<blockquote>\n<p>The ordered logits policy strats off with accuracy much higher than a random policy, suggesting that the patches it initially picks are meaningful to classification.</p>\n<p>However, accuracy is still lower than the learned Saccader model, and <strong>performacne improves only slowly with additional glimpese. The ordered logits policy is able to capture some of the features relevant to classification, but it is a greedy policy that produces glimpses that cluster around a few top features (i.e., with low image coverage)</strong></p>\n</blockquote>\n<p>ordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance 增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。</p>\n<h4 id=\"空间上其他位置\"><a class=\"markdownIt-Anchor\" href=\"#空间上其他位置\"></a> 空间上其他位置</h4>\n<p>如<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加 glimplese 的时候，它的性能应该会受到影响的。但是不是。</p>\n<blockquote>\n<p>In fact, increasing the number of glimpses beyond the number used for DRAM policy training leads to drop in performane, ulike the Saccader model that generalizes to greater umbers of glimpses.</p>\n</blockquote>\n<img src=Saccader_gl.jpg width=50% height = 50%>\n<p>如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训练到的地方，Saccader 的预测也还可以，与<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>的理解不同。<font color=deeppink>原因是什么还有待探究。</font></p>\n<h3 id=\"hard-attention-for-scalable-image-classification\"><a class=\"markdownIt-Anchor\" href=\"#hard-attention-for-scalable-image-classification\"></a> Hard Attention for Scalable Image Classification</h3>\n<h4 id=\"介绍\"><a class=\"markdownIt-Anchor\" href=\"#介绍\"></a> 介绍</h4>\n<img src=Tnet_over.jpg width=50% height = 50%>\n<blockquote>\n<p>Muti-scale processing in the proposed TNet architecture. Starting from level 1, the image is processed in low resolution to get a coarse description of its content (red cube). Extracted features are used for (hard) selection of image regions worth processing in higher resolution. The process is repeated recursively (here to 2 additional levels). Features from all levels are combined (arrows on the right) to create the final image representation used for classificaiton (blue cube).</p>\n</blockquote>\n<p>先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader</p>\n<h2 id=\"soft-attention\"><a class=\"markdownIt-Anchor\" href=\"#soft-attention\"></a> Soft Attention</h2>\n<h3 id=\"nam-normalization-based-attention-module\"><a class=\"markdownIt-Anchor\" href=\"#nam-normalization-based-attention-module\"></a> NAM, Normalization-based Attention Module</h3>\n<h4 id=\"利用网络参数的信息进一步处理数据再利用\"><a class=\"markdownIt-Anchor\" href=\"#利用网络参数的信息进一步处理数据再利用\"></a> 利用网络参数的信息，进一步处理数据（再利用）</h4>\n<blockquote>\n<p>Those methods successfully exploit the mutual information from different dimensions of feawture. However, they lack consideration on the contributing factors of weights, which is capable of furthr suppressing the insignificant channels or pixels.</p>\n</blockquote>\n<p>网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，<strong>一次是否就已经用完了该参数的信息。它是否还有其他价值？</strong></p>\n<p>文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而 attention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重。<strong>使得 bn 的权重出现重复利用的现象。</strong></p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mi>γ</mi><mo>+</mo><mi>δ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mfrac><mi>γ</mi><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">)</mo><mo>×</mo><mi>x</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.84356em;vertical-align:-3.1717800000000005em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03785em;\">δ</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1075599999999999em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">.</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">d</span><span class=\"mopen\">(</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Channel_Att</span>(<span class=\"params\">nn.Module</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, channels, t=<span class=\"number\">16</span></span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Channel_Att, self).__init__()</span><br><span class=\"line\">        self.channels = channels</span><br><span class=\"line\">        self.bn2 = nn.BatchNorm2d(self.channels, affine=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">forward</span>(<span class=\"params\">self, x</span>):</span></span><br><span class=\"line\">        residual = x</span><br><span class=\"line\">        x = self.bn2(x)</span><br><span class=\"line\">        weight_bn = self.bn2.weight.data.<span class=\"built_in\">abs</span>() / torch.<span class=\"built_in\">sum</span>(self.bn2.weight.data.<span class=\"built_in\">abs</span>())</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>).contiguous()</span><br><span class=\"line\">        x = torch.mul(weight_bn, x)</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>).contiguous()</span><br><span class=\"line\">        x = torch.sigmoid(x) * residual</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br></pre></td></tr></table></figure>\n<h4 id=\"关于权重稀疏性\"><a class=\"markdownIt-Anchor\" href=\"#关于权重稀疏性\"></a> 关于权重稀疏性</h4>\n<blockquote>\n<p>It applies a weightsparsity penalty to the attention modules, thus, making them more computational efficient while retaining similar performance.</p>\n<p>To suppress the less salient weights, we add a regularization term into the loss function.</p>\n</blockquote>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></munder><mi>l</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>λ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">L</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5660100000000003em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">λ</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>第一项是正常的损失函数，第二项和第三项的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mi mathvariant=\"normal\">（</mi><mi mathvariant=\"normal\">）</mi></mrow><annotation encoding=\"application/x-tex\">g（）</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord cjk_fallback\">（</span><span class=\"mord cjk_fallback\">）</span></span></span></span>是一范数，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>是通道注意力中 bn 的权重，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span>是空间注意力中 pix normalization 的权重。加上这两项使得通道和空间注意力都有了稀疏性。</p>\n<p><font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来 computational efficient? 文章确实有 computational efficient，但是根据实验部分的列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font></p>\n<h4 id=\"启发\"><a class=\"markdownIt-Anchor\" href=\"#启发\"></a> 启发</h4>\n<p><font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由。</font></p>\n<p><font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font></p>\n<h1 id=\"regularization\"><a class=\"markdownIt-Anchor\" href=\"#regularization\"></a> Regularization</h1>\n<h2 id=\"adcm-attentnion-dropout-convolutional-module\"><a class=\"markdownIt-Anchor\" href=\"#adcm-attentnion-dropout-convolutional-module\"></a> ADCM: Attentnion Dropout Convolutional Module</h2>\n<p><img src=\"ADCM.jpg\" alt=\"ADCM\" /></p>\n<p>在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把它误解为 hard attention。</p>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">2018,Learn to pay attention.<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">2019, Approximating CNNs with bag-of-local-features models works surprisingly well on ImageNet.<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div>"},{"title":"Transformer and BERT","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2021-12-18T02:00:56.000Z","password":null,"summary":null,"description":"作为NLP的入门，介绍Transformer和BERT.","_content":"\nI will introduce transformer and BERT according to their original papers.\n[^1] [^2]\n\n[^2]:BERT: Pre-training of Deep Bidirectional Transformer for Language Understanding\n[^1]:Attention is all you need\n\nBased on the two paper, we will also take the first step to NLP.\n\n# Transformer #\n\n\n\n# BERT #\n\n","source":"_posts/Transformer-and-BERT.md","raw":"---\ntitle: Transformer and BERT\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2021-12-18 10:00:56\npassword:\nsummary:\ndescription: 作为NLP的入门，介绍Transformer和BERT.\ncategories:\n- Natural Language Processing\ntags:\n- Natural Language Processing\n- Transformer\n- BERT\n---\n\nI will introduce transformer and BERT according to their original papers.\n[^1] [^2]\n\n[^2]:BERT: Pre-training of Deep Bidirectional Transformer for Language Understanding\n[^1]:Attention is all you need\n\nBased on the two paper, we will also take the first step to NLP.\n\n# Transformer #\n\n\n\n# BERT #\n\n","slug":"Transformer-and-BERT","published":1,"updated":"2022-03-16T08:52:14.815Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl0thb1i6000tgqul8hxt3bld","content":"<html><head></head><body><p>I will introduce transformer and BERT according to their original papers.\n<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup> <sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup></p>\n<p>Based on the two paper, we will also take the first step to NLP.</p>\n<h1 id=\"transformer\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#transformer\"></a> Transformer</h1>\n<h1 id=\"bert\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#bert\"></a> BERT</h1>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">Attention is all you need<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">BERT: Pre-training of Deep Bidirectional Transformer for Language Understanding<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p>I will introduce transformer and BERT according to their original papers.\n<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup> <sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup></p>\n<p>Based on the two paper, we will also take the first step to NLP.</p>\n<h1 id=\"transformer\"><a class=\"markdownIt-Anchor\" href=\"#transformer\"></a> Transformer</h1>\n<h1 id=\"bert\"><a class=\"markdownIt-Anchor\" href=\"#bert\"></a> BERT</h1>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">Attention is all you need<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">BERT: Pre-training of Deep Bidirectional Transformer for Language Understanding<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div>"}],"PostAsset":[{"_id":"source/_posts/An-Introduction-to-Git/git.jpg","slug":"git.jpg","post":"cl0thb1hq0003gquleqzn8k7j","modified":0,"renderable":0},{"_id":"source/_posts/First-Step-to-RL/policy_network.py","slug":"policy_network.py","post":"cl0thb1hx000cgquld3xogjs2","modified":0,"renderable":0},{"_id":"source/_posts/First-Step-to-RL/q_learning.py","slug":"q_learning.py","post":"cl0thb1hx000cgquld3xogjs2","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/ADCM.jpg","slug":"ADCM.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_Cell.jpg","slug":"Saccader_Cell.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_Over.jpg","slug":"Saccader_Over.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq1.jpg","slug":"Saccader_eq1.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq2.jpg","slug":"Saccader_eq2.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq3.jpg","slug":"Saccader_eq3.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_gl.jpg","slug":"Saccader_gl.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Tnet_over.jpg","slug":"Tnet_over.jpg","post":"cl0thb1i5000pgqul21aoc3us","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cl0thb1hm0001gqul0l6oda4w","category_id":"cl0thb1hs0004gqulbpvqfwm0","_id":"cl0thb1hz000egqulcskwatht"},{"post_id":"cl0thb1i1000hgqul1can83ic","category_id":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1i6000qgqul1k6gaf8w"},{"post_id":"cl0thb1hv0008gqul493vbdhl","category_id":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1i7000vgqul1y4ygnge"},{"post_id":"cl0thb1hw0009gqulc4uv70a4","category_id":"cl0thb1i6000rgqulfmb69b84","_id":"cl0thb1i8000ygqul5xh92ml5"},{"post_id":"cl0thb1hx000cgquld3xogjs2","category_id":"cl0thb1i7000wgqulbykt89t7","_id":"cl0thb1i90011gqul24411vzg"},{"post_id":"cl0thb1hq0003gquleqzn8k7j","category_id":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1i90015gqulflus7wfo"},{"post_id":"cl0thb1hq0003gquleqzn8k7j","category_id":"cl0thb1i8000zgqul0ndr2k3p","_id":"cl0thb1ia0019gqul6vmwglmj"},{"post_id":"cl0thb1hz000dgqul776ya2z1","category_id":"cl0thb1i90012gqulgc8s0484","_id":"cl0thb1ia001bgqul4hoqfm8x"},{"post_id":"cl0thb1hu0007gqul2ljs4cm9","category_id":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1ib001egqul5ebsci72"},{"post_id":"cl0thb1hu0007gqul2ljs4cm9","category_id":"cl0thb1ia0016gqulenq1dwuo","_id":"cl0thb1ic001hgqule3qa6gxk"},{"post_id":"cl0thb1i2000jgquldqobh02f","category_id":"cl0thb1ia001cgqulhij4h0me","_id":"cl0thb1ic001jgqul9yog6kl5"},{"post_id":"cl0thb1i4000ngqulbodtej4b","category_id":"cl0thb1hx000agqul4h2j8yl1","_id":"cl0thb1id001pgqul00z2350k"},{"post_id":"cl0thb1i4000ngqulbodtej4b","category_id":"cl0thb1ib001fgqul6oeu9tnu","_id":"cl0thb1id001sgqul9u284lr7"},{"post_id":"cl0thb1i5000pgqul21aoc3us","category_id":"cl0thb1ia001cgqulhij4h0me","_id":"cl0thb1id001ugqulgmkc7keq"},{"post_id":"cl0thb1i6000tgqul8hxt3bld","category_id":"cl0thb1id001ogqulfkkq3pr6","_id":"cl0thb1ie001xgquld1rvabeg"}],"PostTag":[{"post_id":"cl0thb1hm0001gqul0l6oda4w","tag_id":"cl0thb1ht0005gqul2ze78n6k","_id":"cl0thb1i2000igqulc7sg47bq"},{"post_id":"cl0thb1hm0001gqul0l6oda4w","tag_id":"cl0thb1hx000bgqul9iov2783","_id":"cl0thb1i3000kgqul1iysg7uv"},{"post_id":"cl0thb1hq0003gquleqzn8k7j","tag_id":"cl0thb1hz000ggqul2ncn1zgd","_id":"cl0thb1i5000ogqulbpa786ay"},{"post_id":"cl0thb1hu0007gqul2ljs4cm9","tag_id":"cl0thb1i3000mgqul7tls2wf7","_id":"cl0thb1i7000ugqul35b97t4k"},{"post_id":"cl0thb1hv0008gqul493vbdhl","tag_id":"cl0thb1i6000sgqul16ud1tcu","_id":"cl0thb1i90014gquladhubt5m"},{"post_id":"cl0thb1hv0008gqul493vbdhl","tag_id":"cl0thb1i8000xgquldg0b3stv","_id":"cl0thb1ia0017gqul2al3d9nr"},{"post_id":"cl0thb1hv0008gqul493vbdhl","tag_id":"cl0thb1i90010gqul3uzx69hk","_id":"cl0thb1ia001agqulbvld1hn8"},{"post_id":"cl0thb1hw0009gqulc4uv70a4","tag_id":"cl0thb1i90013gqul0xxegr00","_id":"cl0thb1ic001igqul6uke0hn3"},{"post_id":"cl0thb1hw0009gqulc4uv70a4","tag_id":"cl0thb1ia0018gqul56g86of8","_id":"cl0thb1ic001lgqul48kbd13e"},{"post_id":"cl0thb1hw0009gqulc4uv70a4","tag_id":"cl0thb1ib001dgqul6ynrg8k0","_id":"cl0thb1ic001ngqul5gqlckji"},{"post_id":"cl0thb1hx000cgquld3xogjs2","tag_id":"cl0thb1ib001ggqulehgnfbcq","_id":"cl0thb1id001qgqulfwuw48ba"},{"post_id":"cl0thb1hz000dgqul776ya2z1","tag_id":"cl0thb1ic001mgqulg2on6bek","_id":"cl0thb1id001tgqul3fsq7nbf"},{"post_id":"cl0thb1i1000hgqul1can83ic","tag_id":"cl0thb1id001rgqul6keqffry","_id":"cl0thb1id001wgqulakoa09es"},{"post_id":"cl0thb1i2000jgquldqobh02f","tag_id":"cl0thb1i90013gqul0xxegr00","_id":"cl0thb1ie0021gqul9q6z8qhg"},{"post_id":"cl0thb1i2000jgquldqobh02f","tag_id":"cl0thb1ie001ygqulgdsj2tp6","_id":"cl0thb1ie0022gquld2j725rs"},{"post_id":"cl0thb1i2000jgquldqobh02f","tag_id":"cl0thb1ib001dgqul6ynrg8k0","_id":"cl0thb1if0024gqul4h977ut4"},{"post_id":"cl0thb1i4000ngqulbodtej4b","tag_id":"cl0thb1ie0020gqul5auacpuu","_id":"cl0thb1if0025gqulgv9beew9"},{"post_id":"cl0thb1i5000pgqul21aoc3us","tag_id":"cl0thb1ie001ygqulgdsj2tp6","_id":"cl0thb1if0028gquldq737a9v"},{"post_id":"cl0thb1i5000pgqul21aoc3us","tag_id":"cl0thb1i90013gqul0xxegr00","_id":"cl0thb1if0029gqulfzjm0ihy"},{"post_id":"cl0thb1i6000tgqul8hxt3bld","tag_id":"cl0thb1if0027gqul45f74fo8","_id":"cl0thb1ig002cgqul7lz0g02p"},{"post_id":"cl0thb1i6000tgqul8hxt3bld","tag_id":"cl0thb1if002agqulfmbd9j8x","_id":"cl0thb1ig002dgqul7exscsw1"},{"post_id":"cl0thb1i6000tgqul8hxt3bld","tag_id":"cl0thb1ig002bgqulac5h9bmf","_id":"cl0thb1ig002egqulem4qejxs"}],"Tag":[{"name":"Algorithm","_id":"cl0thb1ht0005gqul2ze78n6k"},{"name":"Programming","_id":"cl0thb1hx000bgqul9iov2783"},{"name":"Git","_id":"cl0thb1hz000ggqul2ncn1zgd"},{"name":"Hexo","_id":"cl0thb1i3000mgqul7tls2wf7"},{"name":"vim","_id":"cl0thb1i6000sgqul16ud1tcu"},{"name":"markdown","_id":"cl0thb1i8000xgquldg0b3stv"},{"name":"vimtex","_id":"cl0thb1i90010gqul3uzx69hk"},{"name":"Personal Thought","_id":"cl0thb1i90013gqul0xxegr00"},{"name":"Experiments","_id":"cl0thb1ia0018gqul56g86of8"},{"name":"private","_id":"cl0thb1ib001dgqul6ynrg8k0"},{"name":"Reinforcement Learning","_id":"cl0thb1ib001ggqulehgnfbcq"},{"name":"Topological Data Analysis","_id":"cl0thb1ic001mgqulg2on6bek"},{"name":"Multi Task Training","_id":"cl0thb1id001rgqul6keqffry"},{"name":"Papers","_id":"cl0thb1ie001ygqulgdsj2tp6"},{"name":"Linux","_id":"cl0thb1ie0020gqul5auacpuu"},{"name":"Natural Language Processing","_id":"cl0thb1if0027gqul45f74fo8"},{"name":"Transformer","_id":"cl0thb1if002agqulfmbd9j8x"},{"name":"BERT","_id":"cl0thb1ig002bgqulac5h9bmf"}]}}